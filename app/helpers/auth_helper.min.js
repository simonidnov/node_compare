var db=require("mongoose"),config=require("../config/config"),Auth_model=require("../models/auth_model"),Apps_model=require("../models/apps_model"),machineId=require("node-machine-id"),jwt=require("jsonwebtoken"),device_uid=machineId.machineIdSync({original:!0});
module.exports={validate_from:function(a,b,c){if("undefined"===typeof a.options||"undefined"===typeof a.options.secret)return c(!1),!1;if("http://localhost:3000"===a.options.from_origin||-1!==b||a.options.from_origin===app.locals.settings.host)return c(!0),!0;Apps_model.validate(a.options.secret,b,function(a){0===a.datas.length?c(!1):c(!0)})},validate_origin:function(a,b,c){Apps_model.validate(a.options.secret,b,function(a){0===a.datas.length?c(!1):c(a.datas[0])})},validate_user:function(a,b,c){"undefined"===
typeof a.options?c({status:304,message:"UNAUTHARISED need OPTIONS"}):"undefined"===typeof a.options.user_id?c({status:304,message:"UNAUTHARISED need valid user ID"}):"undefined"===typeof a.options.user_secret?c({status:304,message:"UNAUTHARISED need valid user secret"}):"undefined"===typeof a.options.user_token?c({status:304,message:"UNAUTHARISED need valid user token"}):(a.options.device_uid=device_uid,Auth_model.check_user(a,function(a){c(a)}))},validate_session:function(a,b){"undefined"===typeof a.session.Auth?
b({status:401,message:"UNAUTHAURIZED"}):b({status:200,message:"AUTHAURIZED"})},validate_admin:function(a,b){"undefined"===typeof a.session?b({status:401,message:"UNAUTHAURIZED"}):"undefined"===typeof a.session.Auth?b({status:401,message:"UNAUTHAURIZED"}):"undefined"===typeof a.session.Auth.rights?b({status:401,message:"UNAUTHAURIZED"}):"RWO"===a.session.Auth.rights.type?b({status:200,message:"AUTHAURIZED"}):b({status:401,message:"UNAUTHAURIZED"})},check_session:function(a,b,c){Auth_model.reset_session(a,
b,c)},has_media_right:function(a,b){if("undefined"===typeof a.session.Auth||"undefined"===typeof a.session.Auth.rights)b({status:401,message:"UNAUTHAURIZED"});else switch(a.session.Auth.rights.type){case "RWO":b({status:200,message:"AUTHAURIZED"});break;case "RW":b({status:200,message:"AUTHAURIZED"});break;default:b({status:401,message:"UNAUTHAURIZED"})}}};
