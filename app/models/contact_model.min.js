var $jscomp={scope:{},findInternal:function(a,c,b){a instanceof String&&(a=String(a));for(var e=a.length,d=0;d<e;d++){var f=a[d];if(c.call(b,f,d,a))return{i:d,v:f}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,b){if(b.get||b.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[c]=b.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,c,b,e){if(c){b=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var d=a[e];d in b||(b[d]={});b=b[d]}a=a[a.length-1];e=b[a];c=c(e);c!=e&&null!=c&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:c})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6-impl","es3");
var db=require("mongoose"),config=require("../config/config"),Email_controller=require("../controllers/email_controller"),contact_datas={subject:{type:"string"},message:{type:"string"},email:{type:"string"},firstName:{type:"string"},lastName:{type:"string"},email_filter:{type:"string"},is_read:{type:"bool"},user_id:{type:"string"},created:{type:"Date","default":Date.now},updated:{type:"Date","default":Date.now}};0===db.connection.readyState&&db.connect(config.database.users,{useMongoClient:!0});
var contactSchemas=new db.Schema(contact_datas),Contacts=db.model("Contacts",contactSchemas);Contacts.collection.dropIndexes();module.exports={attributes:contact_datas};module.exports.get=function(a,c,b){Contacts.find({}).sort({updated:-1}).limit(50).exec(function(a,c){a?b({status:203,datas:a}):b({status:200,datas:c})})};
module.exports.create=function(a,c,b){"undefined"!==typeof a.body.data&&(a.body=a.body.data);"undefined"===typeof a.body&&b({status:203,datas:{message:"METHOD NOT ALLOWED"}});"undefined"===typeof a.body.subject&&b({status:203,datas:{message:"NEED_SUBJECT"}});"undefined"===typeof a.body.message&&b({status:203,datas:{message:"NEED_MESSAGE"}});"undefined"===typeof a.body.email&&b({status:203,datas:{message:"NEED_EMAIL"}});"undefined"===typeof a.body.email_filter&&b({status:203,datas:{message:"NEED_FILTER"}});
"undefined"===typeof a.body.firstName&&b({status:203,datas:{message:"NEED_FIRSTNAME"}});"undefined"===typeof a.body.lastName&&b({status:203,datas:{message:"NEED_LASTNAME"}});c={subject:a.body.subject,message:a.body.message,email:a.body.email,email_filter:a.body.email_filter,is_read:!1};"undefined"!==typeof a.body.options&&"undefined"!==typeof a.body.options.user_id&&(c.user_id=a.body.options.user_id);new_contact=new Contacts(c);new_contact.save(function(c,d){c?b({status:400,datas:{message:c}}):Email_controller.send(null,
{subject:"Votre email pour JOYVOX",title:a.body.subject,message:"Votre message \u00e0 bien \u00e9t\u00e9 envoy\u00e9 : <br><br><b>Voici votre message pour Joyvox :</b><br>"+a.body.email_filter+"<br>"+a.body.message,email:a.body.email,to:a.body.email},function(c){Email_controller.send(null,{subject:"Nouvel Email depuis Joyvox",title:a.body.subject,message:"<b>Voici le message re\u00e7u :</b><br>"+a.body.email_filter+"<br>"+a.body.message+"<br>Envoy\u00e9 par"+a.body.email+"<br>"+a.body.firstName+"<br>"+
a.body.lastName,email:config.emailing.from,to:"contact@joyvox.fr"},function(a){b({status:200,datas:d,response_display:{title:"Contact",message:"Nous avons bien re\u00e7u votre demande et nous vous recontacterons dans les plus bref d\u00e9lais"}});console.log(a)});console.log(c)})})};module.exports.update=function(a,c,b){b({status:200,message:"CURRENTLY ON DEV"})};module.exports["delete"]=function(a,c,b){b({status:200,message:"CURRENTLY ON DEV"})};
