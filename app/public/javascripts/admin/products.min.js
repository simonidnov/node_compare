$(document).ready(function(){products_page.init()});
var products_page={create_product_form:null,edit_product_form:null,init:function(){this.create_form();this.medias_form()},create_form:function(){this.search_product_form=(new formular("#searchProductForm",function(a){})).init();$("#searchlabel").on("blur",function(a){index.sdk.api.get("/products",{phonetik:$("#searchlabel").val()},function(b){$("#productList").html("");for(var a=0;a<b.length;a++)$("#productList").append('<a href="/admin/products/edit_product/'+b[a]._id+'" title="\u00e9diter le produit"><li><div class="label">'+
b[a].label+"</div></li></a>")})});this.create_product_form=new formular("#create_product",function(a){if("hitted"===a.status&&"submit"===a.action){var b={};$.each($("#create_product form").serializeArray(),function(a,c){b[c.name]=c.value});index.sdk.api.post($("#create_product form").attr("action"),b,function(a){window.location.href="/admin/products/edit_product/"+a.datas._id})}});this.create_product_form.init();this.edit_product_form=new formular("#edit_product",function(a){if("hitted"===a.status)switch(a.action){case "submit":a=
products_page.edit_product_form.get_datas();index.sdk.api.put($("#edit_product form").attr("action"),a,function(a){});break;case "delete":a={},index.sdk.api.deleting($("#edit_product form").attr("action"),{_id:$("#edit_product form").attr("data-id")},function(a){})}});this.edit_product_form.init();$(".product_media_list").sortable({update:function(a,b){function d(){index.sdk.api.put("/products/medias",{product_id:$(".product_media_list li").eq(c).attr("data-productid"),filename:$(".product_media_list li").eq(c).attr("data-filename"),
order:c},function(a){console.log("index.sdk.api.put ::: ",a);21>c&&(c++,d())})}var c=0;d()}})},medias_form:function(){$('[data-action="delete-media"]').off("click").on("click",function(a){var b=$(this).parent().parent();index.sdk.api.deleting("/products/medias",{product_id:b.attr("data-productid"),filename:b.attr("data-filename")},function(a){b.remove()})})}};
