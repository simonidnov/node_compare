function authorize(e,r){var t=e.installed.client_secret,s=e.installed.client_id,o=e.installed.redirect_uris[0],i=new googleAuth,n=new i.OAuth2(s,t,o);fs.readFile(TOKEN_PATH,function(e,t){e?getNewToken(n,r):(n.credentials=JSON.parse(t),r(n))})}function getNewToken(e,r){var t=(e.generateAuthUrl({access_type:"offline",scope:SCOPES}),readline.createInterface({input:process.stdin,output:process.stdout}));t.question("Enter the code from that page here: ",function(s){t.close(),e.getToken(s,function(t,s){t||(e.credentials=s,storeToken(s),r(e))})})}function storeToken(e){try{fs.mkdirSync(TOKEN_DIR)}catch(e){if("EEXIST"!=e.code)throw e}fs.writeFile(TOKEN_PATH,JSON.stringify(e))}function listLabels(e){google.gmail("v1").users.labels.list({auth:e,userId:"me"},function(e,r){if(!e){var t=r.labels;if(0==t.length);else for(var s=0;s<t.length;s++)t[s]}})}var express=require("express"),gmail=express.Router(),language_helper=require("../helpers/languages_helper"),uri_helper=require("../helpers/uri_helper"),auth_helper=require("../helpers/auth_helper"),lang=require("../public/languages/auth_lang"),machineId=require("node-machine-id"),Auth_model=require("../models/auth_model"),Members_model=require("../models/members_model"),Address_model=require("../models/address_model"),device_uid=machineId.machineIdSync({original:!0}),fs=require("fs"),readline=require("readline"),google=require("googleapis"),googleAuth=require("google-auth-library"),SCOPES=["https://www.googleapis.com/auth/gmail.readonly"],TOKEN_DIR=(process.env.HOME||process.env.HOMEPATH||process.env.USERPROFILE)+"/.credentials/",TOKEN_PATH=TOKEN_DIR+"gmail-nodejs-quickstart.json";gmail.use(function(e,r,t){r.setHeader("Access-Control-Allow-Origin","*"),r.setHeader("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),r.setHeader("Access-Control-Allow-Methods","GET, PUT, POST, DELETE"),r.setHeader("Content-Type","application/json");e.query;"PUT"!==e.method&&"POST"!==e.method&&"DELETE"!==e.method||e.body,t()}),gmail.get("/",function(e,r,t){fs.readFile("client_secret.json",function(e,t){if(e)return void r.status(200).send({status:"error",err:e}).end();r.status(200).send({status:"hello",content:t}).end(),authorize(JSON.parse(t),listLabels)})}),module.exports=gmail;