var express=require("express"),me=express.Router(),language_helper=require("../helpers/languages_helper"),uri_helper=require("../helpers/uri_helper"),auth_helper=require("../helpers/auth_helper"),lang=require("../public/languages/auth_lang"),machineId=require("node-machine-id"),Auth_model=require("../models/auth_model"),Members_model=require("../models/members_model"),Address_model=require("../models/address_model"),device_uid=null;me.use(function(e,t,d){t.setHeader("Access-Control-Allow-Credentials",!1),t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Methods","OPTIONS,GET,PUT,POST,DELETE"),t.setHeader("Access-Control-Allow-Headers","X-Requested-With, X-HTTP-Method-Override, Content-Type, Accept"),t.setHeader("Content-Type","application/json");var s=e.query;"PUT"!==e.method&&"POST"!==e.method&&"DELETE"!==e.method||(s=e.body),void 0!==s.device_infos?device_uid=s.device_infos.device_uid:void 0!==s.device_uid&&(device_uid=s.device_uid),auth_helper.validate_from(s,e.get("origin"),function(o){o?-1===e.url.indexOf("/from")?auth_helper.validate_user(s,e.get("host"),function(o){if(200!==o.status)return t.status(o.status).send({message:"the user token was not up to date",request:s,host:e.get("host")}),!1;void 0!==o.updated_token&&(e.query.updated_token=o.updated_token),d()}):d():t.status(401).send({message:"your server was not authorised",secret:s.options.secret,host:e.get("origin"),is_ok:""})})}),me.get("/",function(e,t,d){Auth_model.getPublicProfile(e.query.options.user_id,function(d){d.updated_token=e.query.updated_token,t.status(d.status).send(d).end()})}).post("/",function(e,t,d){t.send({message:"me post is under development redirect to /account/profile",updated_token:e.query.updated_token,host:e.get("host")}),t.end()}).put("/",function(e,t,d){t.send({message:"me put is under development redirect to /account/profile",updated_token:e.query.updated_token,host:e.get("host")}),t.end()}).delete("/",function(e,t,d){t.send({message:"me delete is under development redirect to /account/profile",updated_token:e.query.updated_token,host:e.get("host")}),t.end()}).get("/members",function(e,t,d){Members_model.get(e.query.options.user_id,null,function(d){d.updated_token=e.query.updated_token,t.status(d.status).send(d),t.end()})}).post("/members",function(e,t,d){Members_model.create(e.body.options.user_id,e.body,function(d){auth_helper.check_session(e,e.body.options.user_id,function(){d.updated_token=e.query.updated_token,t.status(d.status).send(d),t.end()})})}).put("/members",function(e,t,d){Members_model.update(e.body.options.user_id,e.body.member_id,e.body,function(d){auth_helper.check_session(e,e.body.options.user_id,function(){d.updated_token=e.query.updated_token,t.status(d.status).send(d),t.end()})})}).delete("/members",function(e,t,d){Members_model.delete(e.body.options.user_id,e.body.member_id,function(d){auth_helper.check_session(e,e.body.options.user_id,function(){d.updated_token=e.query.updated_token,t.status(d.status).send(d),t.end()})})}).get("/friends",function(e,t,d){t.send({message:"basket get is under development",updated_token:e.query.updated_token,host:e.get("host")}),t.end()}).post("/friends",function(e,t,d){t.send({message:"basket post is under development",updated_token:e.query.updated_token,host:e.get("host")}),t.end()}).put("/friends",function(e,t,d){t.send({message:"basket put is under development",updated_token:e.query.updated_token,host:e.get("host")}),t.end()}).delete("/friends",function(e,t,d){t.send({message:"basket delete is under development",updated_token:e.query.updated_token,host:e.get("host")}),t.end()}).get("/address",function(e,t,d){Address_model.get(e.query.options.user_id,null,function(d){d.updated_token=e.query.updated_token,t.status(d.status).send(d),t.end()})}).post("/address",function(e,t,d){Address_model.create(e.body.options.user_id,e.body,function(d){auth_helper.check_session(e,e.body.options.user_id,function(){d.updated_token=e.query.updated_token,t.status(d.status).send(d),t.end()})})}).put("/address",function(e,t,d){Address_model.update(e.body.options.user_id,e.body.address_id,e.body,function(d){auth_helper.check_session(e,e.body.options.user_id,function(){d.updated_token=e.query.updated_token,t.status(d.status).send(d),t.end()})})}).delete("/address",function(e,t,d){Address_model.delete(e.body.options.user_id,e.body.address_id,function(d){auth_helper.check_session(e,e.body.options.user_id,function(){d.updated_token=e.query.updated_token,t.status(d.status).send(d),t.end()})})}).get("/services",function(e,t,d){Auth_model.getServices(e.query.options.user_id,function(d){d.updated_token=e.query.updated_token,t.status(d.status).send(d),t.end()})}).post("/services",function(e,t,d){t.send({message:"services post is under development redirect to /account/profile",updated_token:e.query.updated_token,host:e.get("host")}),t.end()}).put("/services",function(e,t,d){t.send({message:"services put is under development redirect to /account/profile",updated_token:e.query.updated_token,host:e.get("host")}),t.end()}).delete("/services",function(e,t,d){t.send({message:"services delete is under development redirect to /account/profile",updated_token:e.query.updated_token,host:e.get("host")}),t.end()}).get("/basket",function(e,t,d){t.send({message:"basket get is under development",updated_token:e.query.updated_token,host:e.get("host")}),t.end()}).post("/basket",function(e,t,d){t.send({message:"basket post is under development",updated_token:e.query.updated_token,host:e.get("host")}),t.end()}).put("/basket",function(e,t,d){t.send({message:"basket put is under development",updated_token:e.query.updated_token,host:e.get("host")}),t.end()}).delete("/basket",function(e,t,d){t.send({message:"basket delete is under development",updated_token:e.query.updated_token,host:e.get("host")}),t.end()}).get("/orders",function(e,t,d){t.send({message:"basket get is under development",updated_token:e.query.updated_token,host:e.get("host")}),t.end()}).post("/orders",function(e,t,d){t.send({message:"basket post is under development",updated_token:e.query.updated_token,host:e.get("host")}),t.end()}).put("/orders",function(e,t,d){t.send({message:"basket put is under development",updated_token:e.query.updated_token,host:e.get("host")}),t.end()}).delete("/orders",function(e,t,d){t.send({message:"basket delete is under development",updated_token:e.query.updated_token,host:e.get("host")}),t.end()}).get("/notifications",function(e,t,d){t.send({message:"notifications get is under development",updated_token:e.query.updated_token,host:e.get("host")}),t.end()}).post("/notifications",function(e,t,d){t.send({message:"notifications post is under development",updated_token:e.query.updated_token,host:e.get("host")}),t.end()}).put("/notifications",function(e,t,d){t.send({message:"notifications put is under development",updated_token:e.query.updated_token,host:e.get("host")}),t.end()}).delete("/notifications",function(e,t,d){t.send({message:"notifications delete is under development",updated_token:e.query.updated_token,host:e.get("host")}),t.end()}).get("/from",function(e,t,d){t.status(200).send({status:"me from callback",origin:e.get("origin"),options:e.query.options.secret}),t.end()}),module.exports=me;