var express=require("express"),_=require("underscore"),admin=express.Router(),Auth_model=require("../models/auth_model"),Auth_helper=require("../helpers/auth_helper"),Apps_controller=require("../controllers/apps_controller"),Pages_controller=require("../controllers/pages_controller"),Products_controller=require("../controllers/products_controller"),language_helper=require("../helpers/languages_helper"),uri_helper=require("../helpers/uri_helper"),lang=require("../public/languages/auth_lang");admin.use(function(s,e,a){e.setHeader("Access-Control-Allow-Origin","*"),e.setHeader("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),e.setHeader("Access-Control-Allow-Methods","GET, PUT, POST, DELETE"),Auth_helper.validate_session(s,function(t){200===t.status?Auth_helper.validate_admin(s,function(s){200===s.status?a():e.redirect(301,'/auth?message="Vous n\'avez pas de droits administrateur sur la plateforme IDKIDS account"')}):e.redirect(301,"/auth")})}),admin.get("/",function(s,e,a){return e.render("admin/dashboard",{title:"Admin Dashboard",user:s.session.Auth,locale:language_helper.getlocale(s),lang:lang,page:"dashboard",js:["/public/javascripts/admin/dashboard.js","/public/javascripts/components/formular.js","/node_modules/qrcode/build/qrcode.min.js"],css:["/public/stylesheets/admin/admin.css","/public/stylesheets/admin/dashboard.css","/public/stylesheets/components/formular.css"]})}).get("/dashboard",function(s,e,a){e.render("admin/dashboard",{title:"Admin Dashboard",user:s.session.Auth,locale:language_helper.getlocale(s),lang:lang,page:"dashboard",js:["/public/javascripts/admin/dashboard.js","/public/javascripts/components/formular.js","/node_modules/qrcode/build/qrcode.min.js"],css:["/public/stylesheets/admin/admin.css","/public/stylesheets/admin/dashboard.css","/public/stylesheets/components/formular.css"]})}).get("/apps",function(s,e,a){var t=[];Apps_controller.get(s,e,function(a){t=a.datas,e.status(a.status).render("admin/apps",{title:"Admin Dashboard",user:s.session.Auth,locale:language_helper.getlocale(s),lang:lang,page:"apps",applications:t,js:["/public/javascripts/components/jquery-ui/jquery-ui.min.js","/public/javascripts/admin/apps.js","/node_modules/cropperjs/dist/cropper.min.js","/public/javascripts/components/formular.js","/node_modules/qrcode/build/qrcode.min.js"],css:["/public/stylesheets/admin/admin.css","/node_modules/cropperjs/dist/cropper.min.css","/public/stylesheets/admin/apps.css","/public/stylesheets/components/formular.css"]})})}).get("/apps/:page",function(s,e,a){var t=null;Apps_controller.get(s,e,function(a){t=a.datas,e.render("admin/apps",{title:"Application",user:s.session.Auth,locale:language_helper.getlocale(s),lang:lang,page:s.params.page,applications:t,js:["/public/javascripts/components/jquery-ui/jquery-ui.min.js","/public/javascripts/admin/apps.js","/node_modules/cropperjs/dist/cropper.min.js","/public/javascripts/components/formular.js","/node_modules/qrcode/build/qrcode.min.js"],css:["/public/stylesheets/admin/admin.css","/node_modules/cropperjs/dist/cropper.min.css","/public/stylesheets/admin/apps.css","/public/stylesheets/components/formular.css"]})})}).get("/apps/:page/:_id",function(s,e,a){var t=null,n=null;Apps_controller.get(s,e,function(a){t=a.datas,n=_.where(JSON.parse(JSON.stringify(t)),{_id:s.params._id})[0],e.render("admin/apps",{title:"Admin Dashboard",user:s.session.Auth,locale:language_helper.getlocale(s),lang:lang,page:s.params.page,applications:t,app_id:s.params._id,edit_application:n,_:_,js:["/public/javascripts/components/jquery-ui/jquery-ui.min.js","/public/javascripts/admin/apps.js","/node_modules/cropperjs/dist/cropper.min.js","/public/javascripts/components/formular.js","/node_modules/qrcode/build/qrcode.min.js"],css:["/public/stylesheets/admin/admin.css","/node_modules/cropperjs/dist/cropper.min.css","/public/stylesheets/admin/apps.css","/public/stylesheets/components/formular.css"]})})}).get("/users",function(s,e,a){require("../controllers/auth_controller").get(s,e,function(a){e.render("admin/users",{title:"Admin Users",user:s.session.Auth,locale:language_helper.getlocale(s),lang:lang,page:"users",users:a.users,js:["/public/javascripts/admin/users.js","/public/javascripts/components/formular.js","/node_modules/qrcode/build/qrcode.min.js","/public/javascripts/farnientejs/farnientejs.min.js"],css:["/public/stylesheets/admin/admin.css","/public/stylesheets/ui.css","/public/stylesheets/admin/users.css","/public/stylesheets/components/formular.css"]})})}).get("/notifications",function(s,e,a){e.render("admin/notifications",{title:"Admin Notifications",user:s.session.Auth,locale:language_helper.getlocale(s),lang:lang,page:"notifications",js:["/public/javascripts/admin/notifications.js","/public/javascripts/components/formular.js","/node_modules/qrcode/build/qrcode.min.js"],css:["/public/stylesheets/admin/admin.css","/public/stylesheets/admin/notifications.css","/public/stylesheets/components/formular.css"]})}).get("/settings",function(s,e,a){console.log("settings"),e.render("admin/settings",{title:"Admin Settings",user:s.session.Auth,locale:language_helper.getlocale(s),lang:lang,page:"settings",js:["/public/javascripts/admin/settings.js","/public/javascripts/components/formular.js","/node_modules/qrcode/build/qrcode.min.js"],css:["/public/stylesheets/admin/admin.css","/public/stylesheets/admin/settings.css","/public/stylesheets/components/formular.css"]})}).get("/translations",function(s,e,a){console.log("translations"),e.render("admin/translations",{title:"Admin translations",user:s.session.Auth,locale:language_helper.getlocale(s),lang:lang,page:"translations",js:["/public/javascripts/admin/translations.js","/public/javascripts/components/formular.js","/node_modules/qrcode/build/qrcode.min.js"],css:["/public/stylesheets/admin/admin.css","/public/stylesheets/admin/translations.css","/public/stylesheets/components/formular.css"]})}).get("/pages",function(s,e,a){Pages_controller.get(s,e,function(a){pages=a.datas,e.render("admin/pages",{title:"Admin Pages",user:s.session.Auth,locale:language_helper.getlocale(s),lang:lang,page:"pages",js:["/public/javascripts/admin/pages.js","/public/javascripts/components/formular.js","/node_modules/qrcode/build/qrcode.min.js"],css:["/public/stylesheets/admin/admin.css","/public/stylesheets/admin/pages.css","/public/stylesheets/components/formular.css"]})})}).get("/pages/:page",function(s,e,a){Pages_controller.get(s,e,function(a){pages=a.datas,e.render("admin/pages",{title:"Admin Pages",user:s.session.Auth,locale:language_helper.getlocale(s),lang:lang,page:s.params.page,pages:pages,js:["/public/javascripts/admin/pages.js","/public/javascripts/components/formular.js","/node_modules/qrcode/build/qrcode.min.js"],css:["/public/stylesheets/admin/admin.css","/public/stylesheets/admin/pages.css","/public/stylesheets/components/formular.css"]})})}).get("/pages/:page/:_id",function(s,e,a){var t=null;Pages_controller.get(s,e,function(a){t=a.datas,edit_page=_.where(JSON.parse(JSON.stringify(t)),{_id:s.params._id})[0],e.render("admin/pages",{title:"Admin Pages",user:s.session.Auth,locale:language_helper.getlocale(s),lang:lang,page:s.params.page,pages:t,page_id:s.params._id,edit_page:edit_page,_:_,js:["/public/javascripts/admin/pages.js","/public/javascripts/components/pager/pager.js","/node_modules/cropperjs/dist/cropper.min.js","/public/javascripts/components/formular.js","/public/javascripts/components/jquery-ui.min.js","/node_modules/qrcode/build/qrcode.min.js"],css:["/public/stylesheets/admin/admin.css","/node_modules/cropperjs/dist/cropper.min.css","/public/stylesheets/admin/pages.css","/public/stylesheets/components/formular.css","/public/stylesheets/components/pager/pager.css"]})})}).get("/products",function(s,e,a){Products_controller.get(s,e,function(a){products=a.datas,e.render("admin/products",{title:"Admin Products",user:s.session.Auth,locale:language_helper.getlocale(s),lang:lang,page:"products",products:products,js:["/public/javascripts/admin/products.js","/public/javascripts/components/formular.js","/node_modules/qrcode/build/qrcode.min.js"],css:["/public/stylesheets/admin/admin.css","/public/stylesheets/admin/products.css","/public/stylesheets/components/formular.css"]})})}).get("/products/:page",function(s,e,a){Products_controller.get(s,e,function(a){products=a.datas,e.render("admin/products",{title:"Admin Products",user:s.session.Auth,locale:language_helper.getlocale(s),lang:lang,page:s.params.page,products:products,js:["/public/javascripts/admin/products.js","/public/javascripts/components/formular.js","/node_modules/qrcode/build/qrcode.min.js"],css:["/public/stylesheets/admin/admin.css","/public/stylesheets/admin/products.css","/public/stylesheets/components/formular.css"]})})}).get("/products/:page/:_id",function(s,e,a){Products_controller.get(s,e,function(a){products=a.datas,s.body={_id:s.params._id},Products_controller.get(s,e,function(a){product_datas=a.datas[0],e.render("admin/products",{title:"Admin Products",user:s.session.Auth,locale:language_helper.getlocale(s),lang:lang,page:s.params.page,products:products,edit_product:product_datas,js:["/public/javascripts/admin/products.js","/public/javascripts/components/formular.js","/node_modules/cropperjs/dist/cropper.min.js","/node_modules/qrcode/build/qrcode.min.js"],css:["/public/stylesheets/admin/admin.css","/public/stylesheets/admin/products.css","/node_modules/cropperjs/dist/cropper.min.css","/public/stylesheets/components/formular.css"]})})})}),module.exports=admin;