var idkids_jssdk=function(a,b){this.options=a;this.callback=b;this.inited=false;this.api={user:null,options:null,get:function(c,d,e){this.call("GET",c,d,e)},post:function(c,d,e){this.call("POST",c,d,e)},put:function(c,d,e){this.call("PUT",c,d,e)},deleting:function(c,d,e){this.call("DELETE",c,d,e)},call:function(f,c,d,e){this.show_loader();this.add_params(d,$.proxy(function(g){d=g;dataType="json";if(f==="POST"||f==="PUT"||f==="DELETE"){dataType="json";d=JSON.stringify(d)}jQuery.ajax(c,{method:f,contentType:"application/json",dataType:dataType,data:d}).done($.proxy(function(h){if(typeof h.updated_token!=="undefined"){this.user.token=h.updated_token;this.store("idkids_local_user",this.user)}e(h)},this)).fail(function(h){console.log("fail ",h)}).always($.proxy(function(i){this.hide_loader();if(typeof i.response_display!=="undefined"){i.response_display.type="modal";var h=new popeye($("body"),i.response_display,function(j){}).init()}},this))},this))},get_user_status:function(){this.set_user();if(this.user===null){return{status:"not_connected",infos:"call api.get('me')"}}else{if(typeof Unity!=="undefined"){Unity.call('{"status":"logged", "user":"'+JSON.stringify(this.user)+'", "token":"'+this.user.token+'", "id":"'+this.user.id+'", "device":"'+this.user.device+'"}')}return{status:"logged",user:this.user,token:this.user.token,id:this.user.id,device:this.user.device}}},get_params:function(){},show_loader:function(){if($(".idkids_jssdk.loader").length===0){$("body").append('<div class="idkids_jssdk loader"><div class="centered"><svg version="1.1" id="Calque_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"	 viewBox="0 0 256 256" style="enable-background:new 0 0 256 256;" xml:space="preserve"><style type="text/css">	.st0{fill:none;stroke:#4F555A;stroke-width:28;stroke-miterlimit:10;}	.st1{fill:#C93632;}</style><circle class="st0" cx="128" cy="128" r="53"/><circle class="st1" cx="128" cy="128" r="26"/></svg></div></div>')}setTimeout(function(){$(".idkids_jssdk.loader").addClass("showed")},200)},hide_loader:function(){$(".idkids_jssdk.loader").remove()},add_params:function(c,d){c.options=this.options;c.options.from_origin=window.location.origin;if(this.user){c.options.user_token=this.user.token;c.options.user_id=this.user._id;c.options.user_secret=this.user.secret;c.options.user_device=this.user.current_device}this.get_device_uid(function(f){if(f.status!==200){c.need_fingerprint=true}delete f.status;c.device_infos=f;d(c)})},reset_user:function(g){var e=new URL(window.location.href),f=e.searchParams.get("idkids-token");if(f!==null){var d={token:e.searchParams.get("idkids-token"),_id:e.searchParams.get("idkids-id"),secret:e.searchParams.get("idkids-secret"),device:e.searchParams.get("idkids-device")};this.store("idkids_local_user",d);this.set_user();g(d)}},set_user:function(){this.getStore("idkids_local_user")},store:function(d,c){try{window.localStorage.setItem(d,JSON.stringify(c))}catch(f){console.log("error ::: ",f)}},getStore:function(c){try{this.user=JSON.parse(window.localStorage.getItem(c))}catch(d){console.log("error ::: ",d)}},get_device_uid:function(c){$('[name="appCodeName"]').val(navigator.appCodeName);$('[name="appName"]').val(navigator.appName);$('[name="appVersion"]').val(navigator.appVersion);$('[name="userAgent"]').val(navigator.userAgent);$('[name="vendor"]').val(navigator.vendor);if(typeof Fingerprint2!=="undefined"){new Fingerprint2().get(function(d,e){$('[name="device_uid"]').val(d);c({status:200,device_uid:d,platform:navigator.platform,appCodeName:navigator.appCodeName,appName:navigator.appName,appVersion:navigator.appVersion,userAgent:navigator.userAgent,vendor:navigator.vendor})})}else{c({status:404,platform:navigator.platform,appCodeName:navigator.appCodeName,appName:navigator.appName,appVersion:navigator.appVersion,userAgent:navigator.userAgent,vendor:navigator.vendor})}}};this.logout=function(){this.api.store("idkids_local_user","")};this.api.options=a;this.init=function(c){if(typeof(Unity)==="undefined"){Unity={call:function(e){var d=document.createElement("IFRAME");d.setAttribute("src","unity:"+e);document.documentElement.appendChild(d);document.documentElement.removeChild(d)},}}this.api.get_device_uid(function(d){console.log("device uid ",d)});this.api.reset_user(function(d){});this.api.get("/me/from",{},function(d){c(d)})};this.isLogged=function(c){c(this.api.get_user_status())};this.template=function(d,c,e){$.get("/templating/"+d,c,function(f){e(f)})};this.createAuthbutton=function(c,d){console.log("createAuthbutton");if(document.getElementById(c)===null){d({status:"error",message:"TARGET_ID_TAG_ELEMENT_NOT_FOUND"})}else{document.getElementById(c).innerHTML='<div class="idkids-sdk"><a href="'+window.location.origin+"/auth?from="+window.location.origin.replace(new RegExp("/","g"),"R|")+"&redirect="+this.options.callback_url.replace(new RegExp("/","g"),"|")+"&secret="+this.options.secret+'" class="auth_button" data-action="login"><div class="avatar"></div><div class="label">CONNEXION</div></a></div>'}};b({status:"sdk instance created"},this.options)};