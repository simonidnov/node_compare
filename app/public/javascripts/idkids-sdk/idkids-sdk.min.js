var idkids_jssdk=function(d,e){this.options=d;this.callback=e;this.inited=!1;-1===window.location.origin.indexOf("127.0.0.1")?d.is_debug=!1:d.is_debug=!0;this.logout=function(){this.api.store("idkids_local_user","");window.history.pushState({pageTitle:document.title},document.title,window.location.origin+window.location.pathname)};$("html, body, *").off("click").on("click",function(a){});this.api={user:null,parent:null,options:null,config:{url:"https://auth.joyvox.fr",debug_url:"http://127.0.0.1:3000"},
get:function(a,b,c,h,d){this.call("GET",a,b,c,h,d)},post:function(a,b,c,h,d){this.options.is_debug&&(this.config.url=this.config.debug_url);this.add_params(b,$.proxy(function(b){$.post(this.config.url+a,{Accept:"text/plain; charset=utf-8",method:"POST",xhrFields:{withCredentials:!1},contentType:"application/jsonp; charset=utf-8",dataType:"json",data:b}).done($.proxy(function(a){c(a)},this)).fail(function(a){"undefined"!==typeof h&&null!==h&&h(a)}).always($.proxy(function(a){"undefined"!==typeof d&&
null!==d&&d(a);this.hide_loader();this.check_response(a)},this))},this))},put:function(a,b,c,h,d){this.call("PUT",a,b,c,h,d)},deleting:function(a,b,c,d,f){this.call("DELETE",a,b,c,d,f)},call:function(a,b,c,d,f,g){this.options.is_debug&&(this.config.url=this.config.debug_url);this.show_loader();this.add_params(c,$.proxy(function(h){c=h;dataType="json";if("POST"===a||"PUT"===a||"DELETE"===a)dataType="json",c=JSON.stringify(c);jQuery.ajax(this.config.url+b,{method:a,contentType:"application/json",dataType:dataType,
data:c}).done($.proxy(function(a){"undefined"!==typeof a.updated_token&&(this.user.token=a.updated_token,this.store("idkids_local_user",this.user));d(a)},this)).fail(function(a){"undefined"!==typeof f&&null!==f&&f(a)}).always($.proxy(function(a){this.hide_loader();"undefined"!==typeof g&&null!==g&&g(a);this.check_response(a)},this))},this))},check_response:function(a){"undefined"!==typeof a.responseJSON&&(a=a.responseJSON);"undefined"!==typeof a.idkids_user&&this.store("idkids_local_user",{token:a.idkids_user.datas.token,
_id:a.idkids_user.datas._id,secret:a.idkids_user.datas.secret,device:a.idkids_user.datas.current_device});"undefined"!==typeof a.response_display&&(203===a.status?(e("logout"),this.store("idkids_local_user",""),this.get("/auth/logout",{},function(){}),"undefined"===typeof a.response_display.buttons&&(a.response_display.buttons=[{"class":"btn-success",label:"Me connecter",value:0,href:("undefined"!==typeof this.config.url?this.config.url:"")+"/auth?secret="+this.options.secret},{"class":"",label:"Cr\u00e9er un compte",
value:1,href:("undefined"!==typeof this.config.url?this.config.url:"")+"/auth/subscribe?secret="+this.options.secret}])):401===a.status&&(this.get("/auth/logout",{},function(){}),a.response_display.buttons=[{"class":"btn-success",label:"Me connecter",value:0,href:("undefined"!==typeof this.config.url?this.config.url:"")+"/auth?secret="+this.options.secret},{"class":"btn-warning",label:"Cr\u00e9er un compte",value:1,href:("undefined"!==typeof this.config.url?this.config.url:"")+"/auth/subscribe?secret="+
this.options.secret}]),a.response_display.type="modal",(new ($("body"),a.response_display,function(a){})).init())},get_user_status:function(){this.set_user();if(null===this.user||"undefined"===typeof this.user._id)return{status:"not_connected",infos:"call api.get('me')"};"undefined"!==typeof Unity&&Unity.call('{"status":"logged", "user":"'+JSON.stringify(this.user)+'", "token":"'+this.user.token+'", "id":"'+this.user.id+'", "device":"'+this.user.device+'"}');return{status:"logged",user:this.user,
token:this.user.token,id:this.user.id,device:this.user.device}},get_params:function(){},show_loader:function(){0===$(".idkids_jssdk.loader").length&&$("body").append('<div class="idkids_jssdk loader"><div class="centered"><svg version="1.1" id="Calque_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\t viewBox="0 0 256 256" style="enable-background:new 0 0 256 256;" xml:space="preserve"><style type="text/css">\t.st0{fill:none;stroke:#4F555A;stroke-width:28;stroke-miterlimit:10;}\t.st1{fill:#C93632;}</style><circle class="st0" cx="128" cy="128" r="53"/><circle class="st1" cx="128" cy="128" r="26"/></svg><span>Chargement</span></div></div>');
$(".idkids_jssdk.loader").addClass("showed").addClass("visible")},hide_loader:function(){setTimeout(function(){$(".idkids_jssdk.loader").removeClass("showed");setTimeout(function(){$(".idkids_jssdk.loader").removeClass("visible");$(".idkids_jssdk.loader").remove()},200)},100)},add_params:function(a,b){a.options=this.options;a.options.from_origin=window.location.origin;this.user&&(a.options.user_token=this.user.token,a.options.user_id=this.user._id,a.options.user_secret=this.user.secret,a.options.user_device=
this.user.current_device);this.get_device_uid(function(c){200!==c.status&&(a.need_fingerprint=!0);delete c.status;a.device_infos=c;b(a)})},reset_user:function(a){var b=new URL(window.location.href);if("undefined"!==typeof b.searchParams){var c=b.searchParams.get("idkids-token");null!==c&&""!==c&&"undefined"!==typeof c&&(c={token:b.searchParams.get("idkids-token"),_id:b.searchParams.get("idkids-id"),secret:b.searchParams.get("idkids-secret"),device:b.searchParams.get("idkids-device")},this.store("idkids_local_user",
c),this.set_user(),window.history.pushState({pageTitle:document.title},document.title,window.location.origin+window.location.pathname),a(c))}else b=getLocationParameters(window.location,"both"),c=b["idkids-token"],"undefined"!==typeof c&&null!==c&&"undefined"!==c&&(c={token:b["idkids-token"],_id:b["idkids-id"],secret:b["idkids-secret"],device:b["idkids-device"]},this.store("idkids_local_user",c),this.set_user(),window.history.pushState({pageTitle:document.title},document.title,window.location.origin+
window.location.pathname),a(c))},set_user:function(){this.getStore("idkids_local_user")},store:function(a,b){try{window.localStorage.setItem(a,JSON.stringify(b))}catch(c){Cookies.set(a,JSON.stringify(b),{expires:7})}},getStore:function(a){try{return"idkids_local_user"===a&&(this.user=JSON.parse(window.localStorage.getItem(a))),JSON.parse(window.localStorage.getItem(a))}catch(b){return"idkids_local_user"===a&&(this.user=JSON.parse(Cookies.get(a))),JSON.parse(JSON.parse(Cookies.get(a)))}},get_device_uid:function(a){$('[name="appCodeName"]').val(navigator.appCodeName);
$('[name="appName"]').val(navigator.appName);$('[name="appVersion"]').val(navigator.appVersion);$('[name="userAgent"]').val(navigator.userAgent);$('[name="vendor"]').val(navigator.vendor);"undefined"!==typeof Fingerprint2?(new Fingerprint2).get(function(b,c){$('[name="device_uid"]').val(b);a({status:200,device_uid:b})}):a({status:404,platform:navigator.platform,appCodeName:navigator.appCodeName,appName:navigator.appName,appVersion:navigator.appVersion,userAgent:navigator.userAgent,vendor:navigator.vendor})}};
this.api.parent=this;this.api.options=d;this.init=function(a){this.check_cookies();window.matchMedia("(display-mode: standalone)");"undefined"===typeof Unity&&(Unity={call:function(a){var c=document.createElement("IFRAME");c.setAttribute("src","unity:"+a);document.documentElement.appendChild(c);document.documentElement.removeChild(c)}});this.api.get_device_uid(function(a){});this.api.reset_user(function(a){});this.api.get("/me/from",{secret:{}},function(c){a(c)});var b=new URL(window.location.href);
switch("undefined"!==typeof b.searchParams?b.searchParams.get("idkids-sdk-action"):getLocationParameters(window.location,"both")["idkids-sdk-action"]){case "logout":this.logout();break;default:console.log("IDKIDS SDK TOOLKIT has returned an action not defined in your javascript sdk version. please upgrade the latest version of idkids-js-sdk on your server then try again.")}this.reset_listeners()};this.isLogged=function(a){a(this.api.get_user_status())};this.getPage=function(a,b,c){this.api.get(a,
b,c,null,function(a){c(a)})};this.template=function(a,b,c){$.get(this.api.config.url+"/templating/"+a,b,function(a){c(a)})};this.createAuthbutton=function(a,b){null===document.getElementById(a)?b({status:"error",message:"TARGET_ID_TAG_ELEMENT_NOT_FOUND"}):this.template("auth_button",{user:this.api.user,options:this.options},function(c){document.getElementById(a).innerHTML=c;b({status:"success",message:"AUTH_BUTTON_CREATED"})})};this.createNotificationButton=function(a,b){null===document.getElementById(a)?
b({status:"error",message:"TARGET_ID_TAG_ELEMENT_NOT_FOUND"}):this.template("notif_button",{user:this.api.user,options:this.options},function(c){document.getElementById(a).innerHTML=c;b({status:"success",message:"AUTH_BUTTON_CREATED"})})};this.validInitedApp=function(a){this.api.get(this.api.config.url+"/api/apps/validate",{secret:this.options.secret},function(b){a(b)})};this.reset_listeners=function(){var a=this;$("[data-idkidssdk]").off("click").on("click",function(b){switch($(this).attr("data-idkidssdk")){case "add_basket":a.api.post("/basket",
{product_id:$(this).attr("data-productid"),quantity:$(this).attr("data-quantity"),url:window.location.href},function(c){200===c.status&&(c=parseInt($("#notifications .indice").html())+1,$("#notifications .indice").html(c),$("#total_basket").html("("+c+")"));a.callback({status:"ADD_BASKET"})});break;case "delete_basket_product":a.api.deleting("/basket",{basket_id:$(this).attr("data-basketid"),product_id:$(this).attr("data-productid")},function(a){200===a.status&&window.location.reload()});break;default:console.log("action not reconized by idkids sdk, please upgrade your sdk version")}})};
this.check_cookies=function(){null===this.api.getStore("accept_cookies")&&($("body").append('<div class="idkids_cookies" id="idkids_cookies"><p>En poursuivant votre navigation sur ce site, vous acceptez l\u2019utilisation de cookies \u00e0 des fins de partage sur les r\u00e9seaux sociaux et de statistiques de visites, afin de b\u00e9n\u00e9ficier d\'une navigation et d\'offres personnalis\u00e9es \u00e0 vos besoins. Pour en savoir plus cliquez ici et pour param\u00e9trer les cookies <a href="https://auth.joyvox.fr/uses-of-cookies">cliquez ici.</a></p><div class="btn btn-danger centered" id="accept_cookies">J\'accepte</div></div>'),
$("#accept_cookies").on("click",$.proxy(function(a){this.api.store("accept_cookies",{status:"checked"});$("#idkids_cookies").remove()},this)))};this.connect=function(){window.location.href=this.api.config.url+"/auth?secret="+this.options.secret};this.downloadFile=function(a,b,c){var d=new XMLHttpRequest,f=a.split("/")[a.split("/").length-1],g=this;g.createProgressBar("T\u00e9l\u00e9chargement de "+f,b);d.responseType="blob";d.open("GET",a);d.addEventListener("error",function(b){c({status:"error",
message:"request file error, unable to find this file "+a})});d.addEventListener("progress",function(a){var b=(a.loaded/1E6).toFixed(2),d=(a.total/1E6).toFixed(2);a=(a.loaded/a.total*100).toFixed(2);c({status:"progress",loaded:b,total:d,percent:a});g.updateProgressBar(a,b+" / "+d+" Mb | "+Math.round(a)+"%")});d.addEventListener("load",function(b){g.deleteProgressBar();c({status:"completed",message:"file will be saved locally in few seconds, becareful with iOS and Android."});4==d.readyState&&200==
d.status&&(b=new Blob([d.response],{type:"application/zip"}),saveAs(b,f),c({status:"saved",message:"save was called, please wait a second, if it doesn't work use the link",link:a}))});d.send()};this.createProgressBar=function(a,b){b.prepend('<div class="idkids_progressbar"><div class="content_panel"><h3>'+a+'</h3><div class="progress"><div class="infos">En attente d\'information</div><div class="bar"><div class="infos">En attente d\'information</div></div></div></div></div>');setTimeout(function(){$(".idkids_progressbar .content_panel").css("top",
0)},200)};this.updateProgressBar=function(a,b){$(".idkids_progressbar .bar").css("width",a+"%");$(".idkids_progressbar .infos").html(b)};this.deleteProgressBar=function(){setTimeout(function(){$(".idkids_progressbar .content_panel").css("top","150%");setTimeout(function(){$(".idkids_progressbar").remove()},400)},1E3)}};function decodeUriComponentWithSpace(d){return decodeURIComponent(d.replace(/\+/g,"%20"))}
function getLocationParameters(d,e){if("hash"!==e&&"search"!==e&&"both"!==e)throw'getLocationParameters expect argument 2 "type" to be "hash", "search" or "both"';var a="undefined"===typeof d.search?"":d.search.substr(1),b="undefined"===typeof d.hash?"":d.hash.substr(1),c=[];if("search"===e||"both"===e)c=c.concat(a.split("&"));if("hash"===e||"both"===e)c=c.concat(b.split("&"));for(var a={},h=0;h<c.length;h++)""!==c[h]&&(b=c[h].split("="),a[this.decodeUriComponentWithSpace(b[0])]=this.decodeUriComponentWithSpace(b[1]));
return a}
(function(d){var e=!1;"function"===typeof define&&define.amd&&(define(d),e=!0);"object"===typeof exports&&(module.exports=d(),e=!0);if(!e){var a=window.Cookies,b=window.Cookies=d();b.noConflict=function(){window.Cookies=a;return b}}})(function(){function d(){for(var a=0,b={};a<arguments.length;a++){var c=arguments[a],d;for(d in c)b[d]=c[d]}return b}function e(a){function b(c,h,f){var g;if("undefined"!==typeof document){if(1<arguments.length){f=d({path:"/"},b.defaults,f);if("number"===typeof f.expires){var e=new Date;
e.setMilliseconds(e.getMilliseconds()+864E5*f.expires);f.expires=e}f.expires=f.expires?f.expires.toUTCString():"";try{g=JSON.stringify(h),/^[\{\[]/.test(g)&&(h=g)}catch(m){}h=a.write?a.write(h,c):encodeURIComponent(String(h)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent);c=encodeURIComponent(String(c));c=c.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent);c=c.replace(/[\(\)]/g,escape);g="";for(var k in f)f[k]&&(g+="; "+k,!0!==f[k]&&(g+="="+f[k]));return document.cookie=
c+"="+h+g}c||(g={});k=document.cookie?document.cookie.split("; "):[];for(var l=/(%[0-9A-Z]{2})+/g,n=0;n<k.length;n++){var q=k[n].split("="),p=q.slice(1).join("=");this.json||'"'!==p.charAt(0)||(p=p.slice(1,-1));try{e=q[0].replace(l,decodeURIComponent);p=a.read?a.read(p,e):a(p,e)||p.replace(l,decodeURIComponent);if(this.json)try{p=JSON.parse(p)}catch(m){}if(c===e){g=p;break}c||(g[e]=p)}catch(m){}}return g}}b.set=b;b.get=function(a){return b.call(b,a)};b.getJSON=function(){return b.apply({json:!0},
[].slice.call(arguments))};b.defaults={};b.remove=function(a,h){b(a,"",d(h,{expires:-1}))};b.withConverter=e;return b}return e(function(){})});
(function(d){d.URL=d.URL||d.webkitURL;if(d.Blob&&d.URL)try{new Blob;return}catch(a){}var e=d.BlobBuilder||d.WebKitBlobBuilder||d.MozBlobBuilder||function(a){var b=function(a){return Object.prototype.toString.call(a).match(/^\[object\s(.*)\]$/)[1]},c=function(){this.data=[]},d=function(a,b,c){this.data=a;this.size=a.length;this.type=b;this.encoding=c},e=c.prototype,g=d.prototype,t=a.FileReaderSync,k=function(a){this.code=this[this.name=a]},l="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),
n=l.length,q=a.URL||a.webkitURL||a,p=q.createObjectURL,m=q.revokeObjectURL,u=q,w=a.btoa,r=a.atob,y=a.ArrayBuffer,v=a.Uint8Array,z=/^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/;for(d.fake=g.fake=!0;n--;)k.prototype[l[n]]=n+1;q.createObjectURL||(u=a.URL=function(a){var b=document.createElementNS("http://www.w3.org/1999/xhtml","a");b.href=a;"origin"in b||("data:"===b.protocol.toLowerCase()?b.origin=null:(a=a.match(z),b.origin=a&&a[1]));return b});u.createObjectURL=function(a){var b=a.type;null===b&&(b="application/octet-stream");
if(a instanceof d)return b="data:"+b,"base64"===a.encoding?b+";base64,"+a.data:"URI"===a.encoding?b+","+decodeURIComponent(a.data):w?b+";base64,"+w(a.data):b+","+encodeURIComponent(a.data);if(p)return p.call(q,a)};u.revokeObjectURL=function(a){"data:"!==a.substring(0,5)&&m&&m.call(q,a)};e.append=function(a){var c=this.data;if(v&&(a instanceof y||a instanceof v)){var e="";a=new v(a);for(var n=0,h=a.length;n<h;n++)e+=String.fromCharCode(a[n]);c.push(e)}else if("Blob"===b(a)||"File"===b(a))if(t)e=new t,
c.push(e.readAsBinaryString(a));else throw new k("NOT_READABLE_ERR");else a instanceof d?"base64"===a.encoding&&r?c.push(r(a.data)):"URI"===a.encoding?c.push(decodeURIComponent(a.data)):"raw"===a.encoding&&c.push(a.data):("string"!==typeof a&&(a+=""),c.push(unescape(encodeURIComponent(a))))};e.getBlob=function(a){arguments.length||(a=null);return new d(this.data.join(""),a,"raw")};e.toString=function(){return"[object BlobBuilder]"};g.slice=function(a,b,c){var e=arguments.length;3>e&&(c=null);return new d(this.data.slice(a,
1<e?b:this.data.length),c,this.encoding)};g.toString=function(){return"[object Blob]"};g.close=function(){this.size=0;delete this.data};return c}(d);d.Blob=function(a,b){var c=b?b.type||"":"",d=new e;if(a)for(var f=0,g=a.length;f<g;f++)Uint8Array&&a[f]instanceof Uint8Array?d.append(a[f].buffer):d.append(a[f]);c=d.getBlob(c);!c.slice&&c.webkitSlice&&(c.slice=c.webkitSlice);return c};d.Blob.prototype=(Object.getPrototypeOf||function(a){return a.__proto__})(new d.Blob)})("undefined"!==typeof self&&self||
"undefined"!==typeof window&&window||this);
var saveAs=saveAs||function(d){if(!("undefined"===typeof d||"undefined"!==typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var e=d.document.createElementNS("http://www.w3.org/1999/xhtml","a"),a="download"in e,b=/constructor/i.test(d.HTMLElement)||d.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent),h=d.setImmediate||d.setTimeout,f=function(a){h(function(){throw a;},0)},g=function(a){setTimeout(function(){"string"===typeof a?(d.URL||d.webkitURL||d).revokeObjectURL(a):a.remove()},4E4)},t=
function(a){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob([String.fromCharCode(65279),a],{type:a.type}):a},k=function(n,l,p){p||(n=t(n));var m=this,q="application/octet-stream"===n.type,k,r=function(){for(var a=["writestart","progress","write","writeend"],a=[].concat(a),b=a.length;b--;){var c=m["on"+a[b]];if("function"===typeof c)try{c.call(m,m)}catch(x){f(x)}}};m.readyState=m.INIT;a?(k=(d.URL||d.webkitURL||d).createObjectURL(n),h(function(){e.href=
k;e.download=l;var a=new MouseEvent("click");e.dispatchEvent(a);r();g(k);m.readyState=m.DONE},0)):function(){if((c||q&&b)&&d.FileReader){var a=new FileReader;a.onloadend=function(){var b=c?a.result:a.result.replace(/^data:[^;]*;/,"data:attachment/file;");d.open(b,"_blank")||(d.location.href=b);m.readyState=m.DONE;r()};a.readAsDataURL(n);m.readyState=m.INIT}else k||(k=(d.URL||d.webkitURL||d).createObjectURL(n)),q?d.location.href=k:d.open(k,"_blank")||(d.location.href=k),m.readyState=m.DONE,r(),g(k)}()},
l=k.prototype;if("undefined"!==typeof navigator&&navigator.msSaveOrOpenBlob)return function(a,b,c){b=b||a.name||"download";c||(a=t(a));return navigator.msSaveOrOpenBlob(a,b)};l.abort=function(){};l.readyState=l.INIT=0;l.WRITING=1;l.DONE=2;l.error=l.onwritestart=l.onprogress=l.onwrite=l.onabort=l.onerror=l.onwriteend=null;return function(a,b,c){return new k(a,b||a.name||"download",c)}}}("undefined"!==typeof self&&self||"undefined"!==typeof window&&window||this);
