var express=require("express"),basket=express.Router(),Basket_controller=require("../controllers/basket_controller"),Userproducts_controller=require("../controllers/userproducts_controller");Auth_helper=require("../helpers/auth_helper");language_helper=require("../helpers/languages_helper");uri_helper=require("../helpers/uri_helper");lang=require("../public/languages/auth_lang");
basket.use(function(a,c,d){c.setHeader("Access-Control-Allow-Origin","*");c.setHeader("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept");c.setHeader("Access-Control-Allow-Methods","GET, PUT, POST, DELETE");Auth_helper.validate_admin(a,function(b){200===b.status?(a.body.isAdmin=!0,a.query.isAdmin=!0):(a.body.isAdmin=!1,a.query.isAdmin=!1)});var b=a.query;if("PUT"===a.method||"POST"===a.method||"DELETE"===a.method)b=a.body;Auth_helper.validate_user(b,a.get("host"),function(a){200===
a.status?d():c.status(a.status).send(a)})});
basket.get("/",function(a,c,d){Basket_controller.get(a,c,function(b){c.status(b.status).send(Auth_helper.addParams(b.datas,a))})}).get("/amount",function(a,c,d){Basket_controller.getAmount(a,c,function(b){c.status(b.status).send(Auth_helper.addParams(b.datas,a))})}).post("/",function(a,c,d){"undefined"!==typeof a.body.data&&(a.body=a.body.data);Userproducts_controller.allreadyBuy(a.body.options.user_id,a.body.product_id,function(b){200===b.status?c.status(b.status).send(Auth_helper.addParams({status:b.status,response_display:{title:"PLAYLIST",
message:"Vous avez d\u00e9j\u00e0 achet\u00e9 ce produit, rendez-vous sur votre playlist pour l'\u00e9couter !",type:"modal",motion:{color:"blue",src:app.locals.settings.host+"/public/images/assets/account_1.svg"},buttons:[{"class":"btn-success centered",label:"MON COMPTE",href:app.locals.settings.host+"/account/orders",target:"_blank",value:"/account/orders"}]}},a)):d()})},function(a,c,d){Basket_controller.create(a.body,c,function(b){c.status(b.status).send(Auth_helper.addParams({status:b.status,
response_display:{title:"Ajout\u00e9",illus:{src:app.locals.settings.host+"/public/images/assets/basket.svg",color:"lightseagreen"},message:"Votre produit a bien \u00e9t\u00e9 ajout\u00e9 dans votre panier.",buttons:[{"class":"btn-success centered",label:"MON PANIER",href:app.locals.settings.host+"/account/basket",target:"_blank",value:"/account/basket"}]}},a))})}).put("/",function(a,c,d){Basket_controller.update(a.body.data,c,function(b){c.status(b.status).send(Auth_helper.addParams({status:b.status,
infos:b.datas},a))})})["delete"]("/",function(a,c,d){Basket_controller["delete"](a,c,function(b){c.status(b.status).send(Auth_helper.addParams({status:b.status,infos:b.datas},a))})});module.exports=basket;
