const db=require("mongoose"),config=require("../config/config"),Auth_model=require("../models/auth_model"),Apps_model=require("../models/apps_model"),machineId=require("node-machine-id"),jwt=require("jsonwebtoken"),device_uid=machineId.machineIdSync({original:!0});module.exports={validate_from:function(e,s,o){return void 0===e.options?(o(!1),!1):void 0===e.options.secret?(o(!1),!1):"http://localhost:3000"===e.options.from_origin||-1!==s||e.options.from_origin===app.locals.settings.host?(o(!0),!0):void Apps_model.validate(e.options.secret,s,function(e){o(0===e.datas.length?!1:!0)})},validate_origin:function(e,s,o){Apps_model.validate(e.options.secret,s,function(e){o(0===e.datas.length?!1:e.datas[0])})},validate_user:function(e,s,o){return void 0===e.options.user_id?(o({status:401,message:"UNAUTHARISED need valid user ID"}),!1):void 0===e.options.user_secret?(o({status:401,message:"UNAUTHARISED need valid user secret"}),!1):void 0===e.options.user_token?(o({status:401,message:"UNAUTHARISED need valid user token"}),!1):(db.connect(config.database.users,{useMongoClient:!0}),e.options.device_uid=device_uid,void Auth_model.check_user(e,function(e){return o(e),!0}))},validate_session:function(e,s){s(void 0===e.session.Auth?{status:401,message:"UNAUTHAURIZED"}:{status:200,message:"AUTHAURIZED"})},validate_admin:function(e,s){s(void 0===e.session.Auth.rights?{status:401,message:"UNAUTHAURIZED"}:"RWO"===e.session.Auth.rights.type?{status:200,message:"AUTHAURIZED"}:{status:301,message:"UNAUTHAURIZED"})},check_session:function(e,s,o){Auth_model.reset_session(e,s,o)}};