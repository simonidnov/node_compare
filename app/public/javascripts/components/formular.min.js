function formular(e,t){this.target=e,this.callback=t,this.email_tester=/^[-!#$%&'*+\/0-9=?A-Z^_a-z{|}~](\.?[-!#$%&'*+\/0-9=?A-Z^_a-z`{|}~])*@[a-zA-Z0-9](-?\.?[a-zA-Z0-9])*\.[a-zA-Z](-?[a-zA-Z0-9])+$/,this.init=function(){this.callback({status:"inited"}),this.setListeners()},this.setListeners=function(){var t=this;$(e).find(".delete_input_array_button").off("click").on("click",function(){$(this).parent().remove()}),$(e).find(".add_input_array_button").off("click").on("click",function(){var t=$(this).parent().parent().attr("data-name")+""+$(this).parent().parent().find("input").length;$(this).parent().parent().find(".array_list_inputs").append('<li class="form-group material_input"><input minlength="5" type="text" name="'+t+'" value=""/><label>Entrez une valeur</label><div class="delete_input_array_button">Supprimer</div></li>'),$(e).find(".delete_input_array_button").off("click").on("click",function(){$(this).parent().remove()})}),$(e).find("[data-file]").off("change").on("change",function(t){var a=$(this).attr("id"),n=new FormData;n.append("avatar",$(this)[0].files[0]),$.ajax({url:"/media",type:"POST",method:"POST",data:n,contentType:!1,processData:!1,success:function(t){$(e).find('[for="'+a+'"] img').attr("src","/"+t.path),$(e).find("#"+a.replace("_file","")).val("/"+t.path)}})}),$(e).find(".image_cropper").change(function(){console.log("cropper");var t=document.getElementById($(this).attr("id")+"_preview"),s=new FileReader,a=$(this);s.readAsDataURL(this.files[0]),s.onload=function(s){console.log("image loaded"),t.src=this.result,a.parent().append('<div class="btn btn-success valid_crop">Valider</div>');var n=new Cropper(t,{aspectRatio:a.attr("data-width")/a.attr("data-height"),crop:function(e){}});a.parent().find(".valid_crop").off("click").on("click",function(){a.parent().find(".valid_crop").remove(),t.src=n.getCroppedCanvas().toDataURL(),n.destroy();var r=($("#image-id").attr("src"),t.src.replace(/^data:image\/(png|jpg);base64,/,"")),d=base64ToBlob(r,"image/png"),i=new FormData;i.append("base64",d),$.ajax({url:"/media/base64",type:"POST",method:"POST",data:i,contentType:!1,processData:!1,success:function(t){$(e).find("#"+a.attr("data-target")).val(t.path)}})})}}),$(e).find("[data-action]").off("click").on("click",function(e){e.preventDefault();var s=$(this).attr("data-action");switch(s){case"switch_tab":break;case"submit":}return t.callback({status:"hitted",action:s}),!1}),$(e).find(".material_input input").off("focus").on("focus",function(){if("date"===$(this).attr("type")){new datepicker($(this),function(e){console.log(e)})}$(this).parent().addClass("focused"),t.callback({status:"focus",value:$(this)})}),$(e).find(".material_input input").off("blur").on("blur",function(){t.inputCheck($(this)),$(this).parent().removeClass("focused"),t.callback({status:"blur",value:$(this)})}),$(e).find(".material_input input").off("input").on("input",function(){t.inputCheck($(this))}),console.log("set input checkbox change"),$(e).find('input[type="checkbox"]').off("change").on("change",function(){console.log("checkbox change"),t.inputCheck($(this)),t.checkInputs(),t.callback({status:"checkbox",name:$(this).attr("name"),value:$(this).is(":checked")})}),$(e).find("[data-tab]").off("click").on("click",function(){var e=$(this).attr("data-tab");$.each($(this).parent().find("[data-tab]"),function(t,s){$(this).attr("data-tab")===e?($("#"+$(this).attr("data-tab")).css("display","block"),$('[data-tab="'+$(this).attr("data-tab")+'"]').addClass("selected")):($("#"+$(this).attr("data-tab")).css("display","none"),$('[data-tab="'+$(this).attr("data-tab")+'"]').removeClass("selected"))}),t.callback({status:"tab_change",value:$(this).attr("data-tab")})})},this.checkInputs=function(){var t=this;$.each($(e).find(".material_input input"),function(e,s){t.inputCheck($(this))})},this.inputCheck=function(e){var t=this;if("checkbox"===e.attr("type"))return this.validform(),e.is(":checked")?($('[data-checkboxrelative="'+e.attr("id")+'"]').css("display","block"),!0):($('[data-checkboxrelative="'+e.attr("id")+'"]').css("display","none"),!1);if(""==e.val())return e.parent().removeClass("invalid"),e.parent().removeClass("valid"),e.parent().removeClass("notempty"),void e.parent().find(".input_error").remove();var s=e.attr("type");switch(s){case"email":return this.validateEmail(e.val())?(e.parent().addClass("valid"),e.parent().removeClass("invalid"),e.parent().find(".input_error").remove()):(e.parent().addClass("invalid"),e.parent().removeClass("valid"),"undefined"!=typeof e.attr("data-errormessage")&&0==e.parent().find(".input_error").length&&e.parent().append('<div class="input_error">'+e.attr("data-errormessage")+"</div>")),void t.validform();case"date":return e.parent().addClass("valid"),void t.validform();case"radio":t.validform();break;case"checkbox":t.validform()}if(e.parent().addClass("notempty"),"undefined"!=typeof e.attr("data-regex")){if("same"===e.attr("data-regex"))return e.val()===$("#"+e.attr("data-target")).val()?(e.parent().addClass("valid"),e.parent().removeClass("invalid"),e.parent().find(".input_error").remove()):(e.parent().addClass("invalid"),e.parent().removeClass("valid"),"undefined"!=typeof e.attr("data-errormessage")&&0==e.parent().find(".input_error").length&&e.parent().append('<div class="input_error">'+e.attr("data-errormessage")+"</div>")),!1;var a=new RegExp(e.attr("data-regex").toString());if(a.test(e.val())?(e.parent().removeClass("invalid"),e.parent().addClass("valid"),e.parent().find(".input_error").length>0&&e.parent().find(".input_error").remove(),$('[data-checkinput="'+e.attr("id")+'"]').length>0&&$('[data-checkinput="'+e.attr("id")+'"] .check').addClass("checked")):("undefined"!=typeof e.attr("data-errormessage")&&0==e.parent().find(".input_error").length&&e.parent().append('<div class="input_error">'+e.attr("data-errormessage")+"</div>"),e.parent().addClass("invalid"),e.parent().removeClass("valid")),$('[data-checkinput="'+e.attr("id")+'"]').length>0){if($('[data-checkinput="'+e.attr("id")+'"] .check').removeClass("checked"),$('[data-checkinput="'+e.attr("id")+'"] .check_length').length>0&&e.val().length>=e.attr("minlength")?$('[data-checkinput="'+e.attr("id")+'"] .check_length').addClass("checked"):$('[data-checkinput="'+e.attr("id")+'"] .check_length').removeClass("checked"),$('[data-checkinput="'+e.attr("id")+'"] .check_capital').length>0){var n=new RegExp("[A-Z]+","g");n.test(e.val())?$('[data-checkinput="'+e.attr("id")+'"] .check_capital').addClass("checked"):$('[data-checkinput="'+e.attr("id")+'"] .check_capital').removeClass("checked")}if($('[data-checkinput="'+e.attr("id")+'"] .check_number').length>0){var o=new RegExp("[0-9]+","g");o.test(e.val())?$('[data-checkinput="'+e.attr("id")+'"] .check_number').addClass("checked"):$('[data-checkinput="'+e.attr("id")+'"] .check_number').removeClass("checked")}}}else if("undefined"!=typeof e.attr("minlength")){var r=e.attr("minlength");e.val().length<r?(e.parent().addClass("invalid"),e.parent().removeClass("valid")):(e.parent().addClass("valid"),e.parent().removeClass("invalid"))}else e.parent().addClass("valid"),e.parent().removeClass("invalid");t.validform()},this.validform=function(e){$.each($(this.target).find("form"),function(e,s){var a=!0,n=$(this);$.each(n.find("input"),function(e,t){$(this).attr("required")&&("checkbox"===$(this).attr("type")?$(this).is(":checked")?$('[data-checkboxrelative="'+$(this).attr("id")+'"]').css("display","block"):($('[data-checkboxrelative="'+$(this).attr("id")+'"]').css("display","none"),a=!1):"radio"===$(this).attr("type")||!$(this).parent().hasClass("valid")&&$(this).attr("required")&&(a=!1))}),a?(n.find('button[type="submit"], [data-action="submit"]').removeClass("btn-disabled"),t({form:n.attr("id"),status:"validated"})):(n.find('button[type="submit"], [data-action="submit"]').addClass("btn-disabled"),t({form:n.attr("id"),status:"invalid"}))})},this.validateEmail=function(e){return this.email_tester.test(e)?!0:!1},this.get_datas=function(){var t={};return $.each($(e).find("form").serializeArray(),function(e,s){t[s.name]=s.value}),$.each($(e).find(".array_list_inputs"),function(e,s){var s={};$.each($(this).find("input"),function(e,t){console.log();var a=$(this).attr("name"),n=$(this).val();("checkbox"===$(this).attr("type")||"radio"===$(this).attr("type"))&&(n=$(this).is(":checked")),s[a]=n}),t[$(this).attr("data-name")]=s}),t}}function datepicker(e,t){this.years=[],this.month=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],this.days=[31,29,31,30,31,30,31,31,30,31,30,31],e.append(),$("#idkids_calendar").remove(),$("body").append('<div id="idkids_calendar" class="calendar"><div class="content"><div class="top_header">'+$('label[for="'+e.attr("id")+'"]').html()+'</div><div class="choices"><div class="selector"></div><div class="wrapper days"><ul class=""></ul></div><div class="wrapper months"><ul class=""></ul></div><div class="wrapper years"><ul class=""></ul></div></div><div class="bottom_footer"><div class="btn btn-lg btn-success" id="validate_and_close_calendar">Valider</div></div></div></div>'),$(".calendar .content").css({left:e.offset().left,top:e.offset().top-$("html, body").scrollTop()+40,width:e.width()}),parseInt($(".calendar .content").css("top").replace("px",""))+$(".calendar .content").outerHeight()>window.innerHeight&&$(".calendar .content").css("top",window.innerHeight-$(".calendar .content").outerHeight()),$("body").css("overflow","hidden");var s=0,a=this,n=2018,o=1890;e.attr("min")&&(o=new Date(e.attr("min")).getFullYear()),e.attr("max")&&(n=new Date(e.attr("max")).getFullYear());for(var r=n;r>o;r--)$(".calendar .years ul").append('<li data-index="'+s+'" data-value="'+r+'" class="'+(0==s?"selected":"")+'">'+r+"</li>"),s++;for(var r=0;r<this.month.length;r++)$(".calendar .months ul").append('<li data-index="'+r+'" data-value="'+(10>r+1?"0"+(r+1):r+1)+'" class="'+(0==r?"selected":"")+'">'+this.month[r]+"</li>");for(var r=1;32>r;r++)$(".calendar .days ul").append('<li data-index="'+(r-1)+'" data-value="'+(10>r?"0"+r:r)+'" class="'+(1==r?"selected":"")+'">'+(10>r?"0"+r:r)+"</li>");if(""!==e.val()){var d=new Date(e.val()),i=d.getFullYear(),l=d.getMonth(),u=d.getDate(),c=$('.calendar .wrapper.years [data-value="'+i+'"]').attr("data-index");$(".calendar .wrapper.days").scrollTop(40*(u-1)),$(".calendar .wrapper.months").scrollTop(40*l),$(".calendar .wrapper.years").scrollTop(40*c)}$.fn.scrollEnd=function(e,t){$(this).scroll(function(){var s=$(this);s.data("scrollTimeout")&&clearTimeout(s.data("scrollTimeout")),s.data("scrollTimeout",setTimeout(e,t))})},$(".calendar .wrapper.days").scrollEnd(function(e){var t=$(".calendar .wrapper.days"),s=Math.round(t.scrollTop()/40),n=40*s;t.find("li").removeClass("selected"),t.find("li").eq(s).addClass("selected"),t.animate({scrollTop:n},200),a.setDate()},500),$(".calendar .wrapper.months").scrollEnd(function(e){var t=$(".calendar .wrapper.months"),s=Math.round(t.scrollTop()/40),n=40*s;t.find("li").removeClass("selected"),t.find("li").eq(s).addClass("selected"),t.animate({scrollTop:n},200),a.setDate()},500),$(".calendar .wrapper.years").scrollEnd(function(e){var t=$(".calendar .wrapper.years"),s=Math.round(t.scrollTop()/40),n=40*s;t.find("li").removeClass("selected"),t.find("li").eq(s).addClass("selected"),t.animate({scrollTop:n},200),a.setDate()},500),$(".calendar .wrapper li").off("click").on("click",function(){$(this).parent().parent().animate({scrollTop:40*$(this).attr("data-index")},200)}),$("#validate_and_close_calendar").off("click").on("click",function(){a.setDate(),$("#idkids_calendar").remove(),$("body").css("overflow","scroll")}),this.setDate=function(){var t=$(".calendar .wrapper.days .selected").attr("data-value"),s=$(".calendar .wrapper.months .selected").attr("data-value"),n=$(".calendar .wrapper.years .selected").attr("data-value");console.log(a.days[parseInt(s)-1]),30===a.days[parseInt(s)-1]?($(".calendar .wrapper.days li").eq(30).addClass("disabled"),$(".calendar .wrapper.days li").eq(29).removeClass("disabled")):29===a.days[parseInt(s)-1]?($(".calendar .wrapper.days li").eq(29).addClass("disabled"),$(".calendar .wrapper.days li").eq(30).addClass("disabled")):$(".calendar .wrapper.days li").removeClass("disabled"),e.val(n+"-"+s+"-"+t),e.blur()}}function base64ToBlob(e,t){t=t||"";for(var s=1024,a=window.atob(e),n=[],o=0,r=a.length;r>o;o+=s){for(var d=a.slice(o,o+s),i=new Array(d.length),l=0;l<d.length;l++)i[l]=d.charCodeAt(l);var u=new Uint8Array(i);n.push(u)}return new Blob(n,{type:t})}