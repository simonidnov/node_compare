var db=require("mongoose"),config=require("../config/config"),Auth_model=require("../models/auth_model"),Apps_model=require("../models/apps_model"),machineId=require("node-machine-id"),jwt=require("jsonwebtoken"),device_uid=machineId.machineIdSync({original:!0});
module.exports={validate_from:function(a,b,c){"undefined"===typeof a.options&&"undefined"!==typeof a.data&&"undefined"!==typeof a.data.options&&(a.options=a.data.options);if("http://localhost:3000"===a.options.from_origin||-1!==b||a.options.from_origin===app.locals.settings.host)return c(!0),!0;if("undefined"===typeof a.options||"undefined"===typeof a.options.secret)return c(!1),!1;Apps_model.validate(a.options.secret,b,function(a){0===a.datas.length?c(!1):c(!0)})},validate_origin:function(a,b,c){Apps_model.validate(a.options.secret,
b,function(a){0===a.datas.length?c(!1):c(a.datas[0])})},validate_user:function(a,b,c){"undefined"===typeof a.options&&"undefined"!==typeof a.data&&"undefined"!==typeof a.data.options&&(a.options=a.data.options);"undefined"===typeof a.options?c({status:401,message:"UNAUTHARISED_NEED_LOGIN",response_display:{title:"Connexion",message:"Vous devez \u00eatre connect\u00e9 pour effectuer cette action."}}):Auth_model.check_user(a,function(a){c(a)})},addParams:function(a,b){"undefined"===typeof a.updated_token&&
"undefined"!==typeof b.updated_token&&(a.updated_token=b.updated_token);return a},validate_session:function(a,b){"undefined"===typeof a.session.Auth?b({status:401,message:"UNAUTHAURIZED"}):b({status:200,message:"AUTHAURIZED"})},validate_admin:function(a,b){"undefined"===typeof a.session?b({status:401,message:"UNAUTHAURIZED"}):"undefined"===typeof a.session.Auth?b({status:401,message:"UNAUTHAURIZED"}):"undefined"===typeof a.session.Auth.rights?b({status:401,message:"UNAUTHAURIZED"}):"RWO"===a.session.Auth.rights.type?
b({status:200,message:"AUTHAURIZED"}):b({status:401,message:"UNAUTHAURIZED"})},check_session:function(a,b,c){Auth_model.reset_session(a,b,c)},has_media_right:function(a,b){if("undefined"===typeof a.session.Auth||"undefined"===typeof a.session.Auth.rights)b({status:401,message:"UNAUTHAURIZED"});else switch(a.session.Auth.rights.type){case "RWO":b({status:200,message:"AUTHAURIZED"});break;case "RW":b({status:200,message:"AUTHAURIZED"});break;default:b({status:401,message:"UNAUTHAURIZED"})}}};
