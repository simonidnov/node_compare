const db=require("mongoose"),config=require("../config/config"),products_datas={label:{type:"string",unique:!0},description:{type:"string"},keywords:{type:"string"},thumb:{type:"string"},picture:{type:"string"},details:{type:"string"},medias:{type:"Array"},price:{type:"number"},devise:{type:"string",enum:["€","£","$"]},type:{type:"string",enum:["physical","demateralized"]},attributs:{type:"Object"},medias:{type:"Object"},created:{type:"Date",default:Date.now},updated:{type:"Date",default:Date.now}};0===db.connection.readyState&&db.connect(config.database.users,{useMongoClient:!0});const productsSchemas=new db.Schema(products_datas),Products=db.model("Products",productsSchemas);module.exports={attributes:products_datas},module.exports.get=function(e,t,s){Products.find(t,function(e,t){s(e?{status:304,datas:{title:"PRODUCT_GET_ERROR",message:"PRODUCT_GET_ERROR_MESSAGE",media:"PRODUCT_GET_ERROR_MEDIA",code:e.code,errmsg:e.errmsg}}:{status:200,datas:t})})},module.exports.create=function(e,t,s){delete t.options,delete t.device_infos,new_product=new Products(t),new_product.save(function(e,t){s(e?{status:304,datas:{title:"PRODUCT_CREATED_ERROR",message:"PRODUCT_CREATED_ERROR_MESSAGE",media:"PRODUCT_CREATED_ERROR_MEDIA",code:e.code,errmsg:e.errmsg}}:{status:200,datas:{infos:t,title:"PRODUCT_CREATED",message:"PRODUCT_CREATED_MESSAGE",media:"PRODUCT_CREATED_MEDIA"}})})},module.exports.update=function(e,t,s,d){delete s.options,delete s._id,s.updated=Date.now(),Products.updateOne({_id:t},{$set:s},function(e,t){d(e?{status:304,datas:{title:"PRODUCT_UPDATED_ERROR",message:"PRODUCT_UPDATED_ERROR_MESSAGE",media:"PRODUCT_UPDATED_ERROR_MEDIA",code:e.code,errmsg:e.errmsg}}:{status:200,datas:{infos:t,title:"PRODUCT_UPDATED",message:"PRODUCT_UPDATED_MESSAGE",media:"PRODUCT_UPDATED_MEDIA"}})})},module.exports.deleting=function(e,t,s){Products.deleteOne({_id:t},function(e,t){s(e?{status:304,datas:{title:"PRODUCT_DELETED_ERROR",message:"PRODUCT_DELETED_ERROR_MESSAGE",media:"PRODUCT_DELETED_ERROR_MEDIA",code:e.code,errmsg:e.errmsg}}:{status:200,datas:{infos:t,title:"PRODUCT_DELETED",message:"PRODUCT_DELETED_MESSAGE",media:"PRODUCT_DELETED_MEDIA"}})})};