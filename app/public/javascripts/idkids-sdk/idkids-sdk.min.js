var idkids_jssdk=function(t,e){this.options=t,this.callback=e,this.inited=!1,this.api={user:null,options:null,get:function(t,e,s){this.call("GET",t,e,s)},post:function(t,e,s){this.call("POST",t,e,s)},put:function(t,e,s){this.call("PUT",t,e,s)},"delete":function(t,e,s){this.call("DELETE",t,e,s)},call:function(t,e,s,i){this.show_loader(),s=this.add_params(s),dataType="json",("POST"===t||"PUT"===t||"DELETE"===t)&&(dataType="json",s=JSON.stringify(s)),jQuery.ajax(e,{method:t,contentType:"application/json",dataType:dataType,data:s}).done($.proxy(function(t){"undefined"!=typeof t.updated_token&&(this.user.token=t.updated_token,this.store("idkids_local_user",this.user)),i(t)},this)).fail(function(t){console.log("fail ",t)}).always($.proxy(function(t){if(this.hide_loader(),"undefined"!=typeof t.message&&"undefined"!=typeof popeye){switch(t.type="",t.status){case 200:t.type="toast";break;default:t.type="modal"}new popeye($("body"),t,function(t){console.log(t)}).init()}console.log("always ",t)},this))},get_user_status:function(){return this.set_user(),null===this.user?{status:"not_connected",infos:"call api.get('me')"}:{status:"logged",user:this.user,token:this.user.token,id:this.user.id,device:this.user.device}},get_params:function(){},show_loader:function(){0===$(".idkids_jssdk.loader").length&&$("body").append('<div class="idkids_jssdk loader"><div class="centered"><svg version="1.1" id="Calque_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"	 viewBox="0 0 256 256" style="enable-background:new 0 0 256 256;" xml:space="preserve"><style type="text/css">	.st0{fill:none;stroke:#4F555A;stroke-width:28;stroke-miterlimit:10;}	.st1{fill:#C93632;}</style><circle class="st0" cx="128" cy="128" r="53"/><circle class="st1" cx="128" cy="128" r="26"/></svg></div></div>'),setTimeout(function(){$(".idkids_jssdk.loader").addClass("showed")},200)},hide_loader:function(){$(".idkids_jssdk.loader").remove()},add_params:function(t){return t.options=this.options,t.options.from_origin=window.location.origin,this.user&&(t.options.user_token=this.user.token,t.options.user_id=this.user._id,t.options.user_secret=this.user.secret,t.options.user_device=this.user.current_device),t},reset_user:function(t){var e=new URL(window.location.href),s=e.searchParams.get("idkids-token");if(null!==s){var i={token:e.searchParams.get("idkids-token"),_id:e.searchParams.get("idkids-id"),secret:e.searchParams.get("idkids-secret"),device:e.searchParams.get("idkids-device")};this.store("idkids_local_user",i),this.set_user(),t(i)}},set_user:function(){this.getStore("idkids_local_user")},store:function(t,e){try{window.localStorage.setItem(t,JSON.stringify(e))}catch(s){console.log("error ::: ",s)}},getStore:function(t){try{this.user=JSON.parse(window.localStorage.getItem(t))}catch(e){console.log("error ::: ",e)}}},this.logout=function(){this.api.store("idkids_local_user","")},this.api.options=t,this.init=function(t){this.api.reset_user(function(t){}),this.api.get("/me/from",{},function(e){t(e)})},this.isLogged=function(t){t(this.api.get_user_status())},this.template=function(t,e,s){$.get("/templating/"+t,e,function(t){s(t)})},this.createAuthbutton=function(t,e){null===document.getElementById(t)?e({status:"error",message:"TARGET_ID_TAG_ELEMENT_NOT_FOUND"}):document.getElementById(t).innerHTML='<div class="idkids-sdk"><a href="'+window.location.origin+"/auth?from="+window.location.origin.replace(new RegExp("/","g"),"R|")+"&redirect="+this.options.callback_url.replace(new RegExp("/","g"),"|")+"&secret="+this.options.secret+'" class="auth_button" data-action="login"><div class="avatar"></div><div class="label">CONNEXION</div></a></div>'},e({status:"sdk instance created"},this.options)};