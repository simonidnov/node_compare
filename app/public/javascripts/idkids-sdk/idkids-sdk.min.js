var idkids_jssdk=function(e,s){this.options=e,this.callback=s,this.inited=!1,this.api={user:null,options:null,get:function(e,s,t){this.call("GET",e,s,t)},post:function(e,s,t){this.call("POST",e,s,t)},put:function(e,s,t){this.call("PUT",e,s,t)},"delete":function(e,s,t){this.call("DELETE",e,s,t)},call:function(e,s,t,i){this.show_loader(),this.add_params(t,$.proxy(function(o){t=o,dataType="json",("POST"===e||"PUT"===e||"DELETE"===e)&&(dataType="json",t=JSON.stringify(t)),jQuery.ajax(s,{method:e,contentType:"application/json",dataType:dataType,data:t}).done($.proxy(function(e){"undefined"!=typeof e.updated_token&&(this.user.token=e.updated_token,this.store("idkids_local_user",this.user)),i(e)},this)).fail(function(e){console.log("fail ",e)}).always($.proxy(function(e){if(this.hide_loader(),"undefined"!=typeof e.message&&"undefined"!=typeof popeye){switch(e.type="",e.status){case 200:e.type="toast";break;default:e.type="modal"}new popeye($("body"),e,function(e){console.log(e)}).init()}console.log("always ",e)},this))},this))},get_user_status:function(){return this.set_user(),null===this.user?{status:"not_connected",infos:"call api.get('me')"}:{status:"logged",user:this.user,token:this.user.token,id:this.user.id,device:this.user.device}},get_params:function(){},show_loader:function(){0===$(".idkids_jssdk.loader").length&&$("body").append('<div class="idkids_jssdk loader"><div class="centered"><svg version="1.1" id="Calque_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"	 viewBox="0 0 256 256" style="enable-background:new 0 0 256 256;" xml:space="preserve"><style type="text/css">	.st0{fill:none;stroke:#4F555A;stroke-width:28;stroke-miterlimit:10;}	.st1{fill:#C93632;}</style><circle class="st0" cx="128" cy="128" r="53"/><circle class="st1" cx="128" cy="128" r="26"/></svg></div></div>'),setTimeout(function(){$(".idkids_jssdk.loader").addClass("showed")},200)},hide_loader:function(){$(".idkids_jssdk.loader").remove()},add_params:function(e,s){e.options=this.options,e.options.from_origin=window.location.origin,this.user&&(e.options.user_token=this.user.token,e.options.user_id=this.user._id,e.options.user_secret=this.user.secret,e.options.user_device=this.user.current_device),this.get_device_uid(function(t){e.device_uid=t,s(e)})},reset_user:function(e){var s=new URL(window.location.href),t=s.searchParams.get("idkids-token");if(null!==t){var i={token:s.searchParams.get("idkids-token"),_id:s.searchParams.get("idkids-id"),secret:s.searchParams.get("idkids-secret"),device:s.searchParams.get("idkids-device")};this.store("idkids_local_user",i),this.set_user(),e(i)}},set_user:function(){this.getStore("idkids_local_user")},store:function(e,s){try{window.localStorage.setItem(e,JSON.stringify(s))}catch(t){console.log("error ::: ",t)}},getStore:function(e){try{this.user=JSON.parse(window.localStorage.getItem(e))}catch(s){console.log("error ::: ",s)}},get_device_uid:function(e){"undefined"!=typeof Fingerprint2&&(new Fingerprint2).get(function(s,t){$('[name="device_uid"]').val(s),e(s),console.log(s,t)})}},this.logout=function(){this.api.store("idkids_local_user","")},this.api.options=e,this.init=function(e){this.api.get_device_uid(function(e){console.log("device uid ",e)}),this.api.reset_user(function(e){}),this.api.get("/me/from",{},function(s){e(s)})},this.isLogged=function(e){e(this.api.get_user_status())},this.template=function(e,s,t){$.get("/templating/"+e,s,function(e){t(e)})},this.createAuthbutton=function(e,s){null===document.getElementById(e)?s({status:"error",message:"TARGET_ID_TAG_ELEMENT_NOT_FOUND"}):document.getElementById(e).innerHTML='<div class="idkids-sdk"><a href="'+window.location.origin+"/auth?from="+window.location.origin.replace(new RegExp("/","g"),"R|")+"&redirect="+this.options.callback_url.replace(new RegExp("/","g"),"|")+"&secret="+this.options.secret+'" class="auth_button" data-action="login"><div class="avatar"></div><div class="label">CONNEXION</div></a></div>'},s({status:"sdk instance created"},this.options)};