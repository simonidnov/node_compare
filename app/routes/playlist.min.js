var express=require("express"),_=require("underscore"),playlist=express.Router(),Auth_helper=require("../helpers/auth_helper"),language_helper=require("../helpers/languages_helper"),uri_helper=require("../helpers/uri_helper"),userproducts_controller=require("../controllers/userproducts_controller"),products_controller=require("../controllers/products_controller"),lang=require("../public/languages/auth_lang"),request=require("request");
playlist.use(function(a,b,c){b.setHeader("Access-Control-Allow-Origin","*");b.setHeader("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept");b.setHeader("Access-Control-Allow-Methods","GET, PUT, POST, DELETE");c()});
playlist.get(["/","/:product_id"],function(a,b,c){products_controller.get({extra_category:"LIVRECD"},a,function(b){a.products=b.datas;c()})},function(a,b,c){request("https://www.joyvox.fr/api/albums/album",function(b,e,d){"undefined"!==typeof d&&(a.joyvox_albums=JSON.parse(d),c())})},function(a,b,c){"undefined"!==typeof a.params.product_id?products_controller.get({product_id:a.params.product_id},a,function(b){a.product=200===b.status&&1===b.datas.length?b.datas[0]:null;c()}):(a.product=null,c())},
function(a,b,c){b.render("audio_player",{title:a.params.playlist_name,user:a.session.Auth,locale:language_helper.getlocale(a),lang:lang,page:"playlist",params:a.query,fs:require("fs"),product:a.product,albums:a.products,userproducts:[],joyvox_albums:a.joyvox_albums,js:["/node_modules/swiper/dist/js/swiper.min.js","/public/javascripts/components/formular.min.js"],css:["/public/stylesheets/components/formular.min.css"]})});module.exports=playlist;
