"use strict";$(function(){login.init()});var login={form:null,init:function(){if(response.status==="error"&&response.code==11){$("#email").parent().addClass("invalid")}else{if(response.status==="error"&&response.code==13){$("#email").parent().addClass("valid");$("#password").parent().addClass("invalid")}}this.add_account();this.form=new formular("#auth_form",function(a){$(".formular.auth").css({height:($(".displayblock").height()+140)+"px"})}).init();window.addEventListener("popstate",this.navigate);this.set_listeners();if(this.parse_url(window.location.pathname.replace("/auth")).length===0){this.sdk.api.get_device_uid(function(a){if(a.status===200){window.location.href="/auth/fingerprint/"+a.device_uid}})}setTimeout(function(){login.initFB()},1500)},initFB:function(){FB.getLoginStatus(function(a){$("#facebook_login").addClass("enabled").off("click").on("click",function(){login.loginFB()})})},loginFB:function(){FB.login(function(a){console.log("facebook response ",a);FB.api("/me?fields=email,name,friends,likes",function(b){console.log("Welcome, ",b)});FB.api("/me/friends",function(b){console.log("friends, ",b.name)});FB.api("/me/likes",function(b){console.log("likes, ",b.name)})},{scope:"public_profile,user_friends,email,user_birthday",return_scopes:true})},parse_url:function(c){var b=[],a=c.split("/");for(var d=1;d<a.length;d+=2){b.push({});b[a[d]]=a[d+1]}return b},set_listeners:function(){$("[data-action]").off("click").on("click",function(b){b.preventDefault();var a=$(this).attr("data-action");switch(a){case"page_reload":window.history.pushState({pageTitle:$(this).attr("title")},"",login.add_params($(this).attr("href")));login.navigate();break;default:console.log("default ",a);break}})},add_account:function(){this.sdk=new idkids_jssdk({secret:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzZWNyZXQiOiI1YTMwZGViZmYzNjViMzBhZmQ3ODY4OWMiLCJpYXQiOjE1MTMxNTgxODV9.8e9JhLtcpzf8hO2CguRuUINBpLWOOClx_-3GfFoVqcM",callback_url:window.location.origin+"/redirect/",authorisation:{email:true,mobile:true,friends:true,profile:true,members:true,address:true,services:true,wallet:true,basket:true,orders:true,loyalty_card:true}},function(b,c){});var a=this;this.sdk.init($.proxy(function(b){this.sdk.isLogged($.proxy(function(c){this.sdk.api.get("/me",{},$.proxy(function(d){if($('[data-userid="'+d.datas._id+'"]').length==0){$(".account_list").prepend('<a href="/auth/login/email/'+d.datas.email+'" data-action="page_reload"><li data-userid="'+d.datas._id+'"><div class="avatar" style="background-image:url('+d.datas.avatar+')"></div><div class="option_infos"><div class="label">'+d.datas.pseudo+'</div><div class="email">'+d.datas.email+'</div><div class="status">connected</div></div></li></a>')}this.set_listeners();this.navigate()},this))},this))},this))},navigate:function(){var a=login.parse_url(window.location.pathname);if(typeof a.auth!=="undefined"){switch(a.auth){case"login":$("#account_selection").addClass("displaynone").removeClass("displayblock");$("#account_forms").removeClass("displaynone").addClass("displayblock");if(typeof a.email!=="undefined"){$("#email").val(a.email)}else{$("#email").val("")}break;case"subscribe":$("#account_selection").addClass("displaynone").removeClass("displayblock");$("#account_forms").removeClass("displaynone").addClass("displayblock");$("#email").val("");break;default:$("#account_selection").removeClass("displaynone").addClass("displayblock");$("#account_forms").addClass("displaynone").removeClass("displayblock");break}}else{$("#account_selection").removeClass("displaynone").addClass("displayblock");$("#account_forms").addClass("displaynone").removeClass("displayblock")}$(".formular.auth").css({height:($(".displayblock").height()+140)+"px"})},add_params:function(a){if(typeof uri_params.from!=="undefined"){a+="/from/"+uri_params.from}if(typeof uri_params.device_uid!=="undefined"){a+="/device_uid/"+uri_params.device_uid}return a},parse_url:function(c){var b=[],a=c.split("/");for(var d=1;d<a.length;d+=2){b.push({});b[a[d]]=a[d+1]}return b}};