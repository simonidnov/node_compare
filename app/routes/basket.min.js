var express=require("express"),basket=express.Router(),Basket_controller=require("../controllers/basket_controller"),Userproducts_controller=require("../controllers/userproducts_controller");Auth_helper=require("../helpers/auth_helper"),language_helper=require("../helpers/languages_helper"),uri_helper=require("../helpers/uri_helper"),lang=require("../public/languages/auth_lang"),basket.use(function(e,t,s){t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),t.setHeader("Access-Control-Allow-Methods","GET, PUT, POST, DELETE"),Auth_helper.validate_admin(e,function(t){200===t.status?(e.body.isAdmin=!0,e.query.isAdmin=!0):(e.body.isAdmin=!1,e.query.isAdmin=!1)});var o=e.query;"PUT"!==e.method&&"POST"!==e.method&&"DELETE"!==e.method||(o=e.body),Auth_helper.validate_user(o,e.get("host"),function(e){200===e.status?s():t.status(e.status).send(e)})}),basket.get("/",function(e,t,s){Basket_controller.get(e,t,function(e){t.status(e.status).send(e.datas)})}).get("/amount",function(e,t,s){Basket_controller.getAmount(e,t,function(e){t.status(e.status).send(e.datas)})}).post("/",function(e,t,s){Userproducts_controller.allreadyBuy(e.body.options.user_id,e.body.product_id,function(e){console.log("Userproducts_controller.allreadyBuy ::::: ",e),200===e.status?t.status(e.status).send({status:e.status,response_display:{title:"OUPS",message:"Vous avez déjà acheté ce produit, rendez-vous sur votre compte client pour le télécharger !",type:"modal",motion:{color:"blue",src:app.locals.settings.host+"/public/images/assets/account_1.svg"},buttons:[{class:"btn-success centered",label:"MON COMPTE",href:app.locals.settings.host+"/account/orders",target:"_blank",value:"/account/orders"}]}}):s()})},function(e,t,s){console.log("ADD BASKET ",e.body),Basket_controller.create(e.body.data,t,function(e){console.log("BASKET CREATE ",e),t.status(e.status).send({status:e.status,response_display:{title:"Ajouté",illus:{src:app.locals.settings.host+"/public/images/assets/basket.svg",color:"lightseagreen"},message:"Votre produit a bien été ajouté dans votre panier.",buttons:[{class:"btn-success centered",label:"MON PANIER",href:app.locals.settings.host+"/account/basket",target:"_blank",value:"/account/basket"}]}})})}).put("/",function(e,t,s){Basket_controller.update(e.body.data,t,function(e){t.status(e.status).send({status:e.status,infos:e.datas})})}).delete("/",function(e,t,s){Basket_controller.delete(e,t,function(e){t.status(e.status).send({status:e.status,infos:e.datas})})}),module.exports=basket;