var express=require("express"),auth=express.Router(),Auth_controller=require("../controllers/auth_controller"),language_helper=require("../helpers/languages_helper"),uri_helper=require("../helpers/uri_helper"),lang=require("../public/languages/auth_lang"),machineId=require("node-machine-id"),device_uid=machineId.machineIdSync({original:!0});auth.get("/",function(e,t,s){e.query.device_uid=device_uid,Auth_controller.login(e.query,function(s){console.log("callback log ::::::::::::",s);var a={title:"Mon compte",datas:e.query,locale:language_helper.getlocale(),lang:lang,uri_params:uri_helper.get_params(e),response:s,js:["/public/javascripts/login.js","/public/javascripts/components/formular.js"],css:["/public/stylesheets/components/formular.css","/public/stylesheets/auth.css"]};"undefined"!=typeof s.user&&t.redirect(307,"auth/account"+e.path),t.render("auth/login",a)})}).post("/login",function(e,t,s){Auth_controller.register(e,function(e){console.log(e),t.send("login post params")})}).put("/login",function(e,t,s){Auth_controller.update(e,t,function(){t.send("login put params")})})["delete"]("/login",function(e,t,s){Auth_controller.unregister(e,t,function(){t.send("login delete params")})}).get("/:form_name/*",function(e,t,s){e.query.device_uid=device_uid,Auth_controller.login(e.query,function(s){console.log("callback log ::::::::::::",s);var a={title:"Mon compte",datas:e.query,response:s,locale:language_helper.getlocale(),lang:lang,uri_params:uri_helper.get_params(e),form:e.params.form_name,js:["/public/javascripts/login.js","/public/javascripts/components/formular.js"],css:["/public/stylesheets/components/formular.css","/public/stylesheets/auth.css"]};if("undefined"!=typeof s.idkids_user){if("undefined"==typeof localStorage||null===localStorage){var r=require("node-localstorage").LocalStorage;localStorage=new r("./idkids")}localStorage.setItem("idkids_user_infos",JSON.stringify(s.idkids_user)),t.redirect(307,"/account")}t.render("auth/login",a)})}),auth.get("/logout",function(e,t,s){Auth_controller.logout(e.query,function(e,s){t.render("auth/logout",{title:"logout auth page"})})}),auth.get("/account",function(e,t,s){t.render("account",{title:"account auth page"})}),module.exports=auth;