var express=require("express"),router=express.Router(),language_helper=require("../helpers/languages_helper"),Page_controller=require("../controllers/pages_controller"),Apps_controller=require("../controllers/apps_controller"),uri_helper=require("../helpers/uri_helper"),lang=require("../public/languages/auth_lang"),apps=Apps_controller.getApps();
router.use(function(a,b,c){b.setHeader("Access-Control-Allow-Origin","*");b.setHeader("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept");b.setHeader("Access-Control-Allow-Methods","GET, PUT, POST, DELETE");b=(a.headers["x-forwarded-proto"]||"").toLowerCase();console.log("HAS HTTPS ",b);console.log("req ",a);console.log("req.get('X-Forwarded-Host') >>>>> ",a.get("X-Forwarded-Host"));console.log("req.get('host') ",a.get("host"));console.log("req.get('origin') ",a.get("origin"));
c()});router.get("/",function(a,b,c){b.render("offline",{title:"IDKIDS.community WELCOME"});b.end()});
router.get("/:page_url",function(a,b,c){Page_controller.get(a.params,b,function(c){1===c.datas.length?b.render("index",{title:"Welcome",user:a.session.Auth,locale:language_helper.getlocale(a),lang:lang,page:a.params.page_name,page_datas:c.datas,js:[],css:[]}):b.render("404",{title:"404",user:a.session.Auth,locale:language_helper.getlocale(a),lang:lang,page:a.params.page_name,page_datas:c.datas,js:[],css:[]});b.end()})});module.exports=router;
