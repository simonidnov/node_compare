"use strict";$(function(){account.init()});var account={user:null,sdk:null,init:function(){this.create_forms(),this.set_listeners()},set_listeners:function(){$("#request_validation_code").off("click").on("click",function(){index.sdk.api.post("/api/request_validation_code",{user_id:$(this).attr("data-userid"),user_email:$(this).attr("data-useremail")},function(e){console.log(e)})}),$(".account_validation .cross_button").off("click").on("click",function(){$("#account_validation").remove()}),$("[data-action]").on("click",function(){switch($(this).attr("data-action")){case"delete":var e={};e[$(this).attr("data-type")]=$(this).attr("data-value"),index.sdk.api.call("DELETE",$(this).attr("data-post"),e,function(e){window.location.reload()});break;case"edit":$("#"+$(this).attr("data-edittemplate")).length>0&&$("#"+$(this).attr("data-edittemplate")).remove(),$(".editable").removeClass("editable");var s=$(this).parent().parent();index.sdk.template($(this).attr("data-edittemplate"),{member_id:$(this).attr("data-value")},function(e){s.append(e),account.member_edit_form=new formular("#member_edit_form",function(e){if("undefined"!=typeof e.action)switch(e.action){case"cancel":s.removeClass("editable"),$("#member_edit_form").remove();break;case"save":var t={member_id:$("#member_edit_form").attr("data-memberid")};$.each($("#member_edit_form form").serializeArray(),function(e,s){t[s.name]=s.value}),"undefined"!=typeof $("#member_edit_form #child_avatar").attr("data-path")&&(t.avatar=$("#member_edit_form #child_avatar").attr("data-path")),index.sdk.api.put("/me/members",t,function(e){console.log(e)})}}).init(),s.addClass("editable")})}}),this.init_map()},init_map:function(){var e={lat:40,lng:1},s=this,t=new google.maps.Map(document.getElementById("map_preview"),{zoom:1,center:e});new google.maps.Geocoder,new google.maps.InfoWindow;$("#postalCode, #city, #address, #addressCountry").off("blur").on("blur",function(){return"undefined"!=typeof s.marker&&s.marker.setMap(null),""===$("#address").val()&&""===$("#city").val()&&""===$("#postalCode").val()?!1:void $.get("https://maps.googleapis.com/maps/api/geocode/json?address="+$("#address").val()+"+"+$("#city").val()+"+"+$("#postalCode").val()+"+"+$("#addressCountry").val()+"&key=AIzaSyB_MlYEDlRnNWYtrn-y63pbjrWecYaocqs",function(e){s.marker=new google.maps.Marker({position:e.results[0].geometry.location,map:t}),t.setZoom(16),t.setCenter(s.marker.getPosition())})})},create_forms:function(){this.public_form=new formular("#public_datas",function(e){}).init(),this.public_form=new formular("#add_kid",function(e){if("hitted"===e.status&&"submit"===e.action){var s={};$.each($("#add_kid form").serializeArray(),function(e,t){s[t.name]=t.value}),index.sdk.api.post("/me/members",s,function(e){window.location.reload()})}}).init(),this.security_form=new formular("#security_form",function(e){"hitted"===e.status&&"submit"===e.action&&(console.log("call update password XHTTP"),index.sdk.api.put("/api/change_password/",{user_id:$("#security_form #user_id").val(),password:$("#security_form #change_password_old").val(),new_password:$("#security_form #change_password_new").val(),retype_new_password:$("#security_form #retype_change_password_new").val()},function(e){console.log(e)}))}).init(),this.address_form=new formular("#address_form",function(e){if("validated"===e.status){$("#addressLine1").val()+"+"+$("#postalCode").val()+"+"+$("#city").val()+"+"+$("#addressCountry").val()}}).init(),this.private_form=new formular("#private_datas",function(e){}).init(),this.services_form=new formular("#services_form",function(e){if("hitted"===e.status&&"submit"===e.action){var s=account.services_form.get_datas();index.sdk.api.put("/account/profile/",s,function(e){})}}),this.services_form.init(),$("#member_datas").length>0&&(this.member_form=new formular("#member_datas",function(e){if("undefined"!=typeof e.action)switch(e.action){case"save":var s={member_id:$("#member_datas").attr("data-memberid")};$.each($("#member_datas form").serializeArray(),function(e,t){s[t.name]=t.value}),index.sdk.api.put("/me/members",s,function(e){window.location.reload()})}}).init()),$(".delete_device").off("click").on("click",function(){var e=$(this);index.sdk.api.call("DELETE","/auth/device",{uid:$(this).attr("data-device_uid")},function(s){console.log(s),e.parent().parent().remove()})})}};