"use strict";$(function(){account.init()});var account={user:null,sdk:null,init:function(){$(".hor_nav").animate({scrollLeft:$(".hor_nav li.selected").position().left+$(".hor_nav").scrollLeft()-50},500),this.sdk=new idkids_jssdk({secret:"000-000-000",callback_url:"http://localhost:3000/account/",authorisation:{basket:!0,friends:!0,profile:!0,members:!0,email:!0,mobile:!0,address:!0,badges:!0,newsletter:!0,wallet:!0,loyalty_card:!0}},function(e,t){console.log(e,t)});var e=this;e.sdk.init(function(t){console.log("init status :::::: ",t),e.sdk.isLogged(function(t){e.sdk.api.get("/me",{},function(e){console.log("/me :::: ",e)})})}),$("[data-action]").off("click").on("click",function(e){e.preventDefault();var t=$(this).attr("data-action");switch(t){case"page_reload":window.history.pushState({pageTitle:$(this).attr("title")},"",account.add_params($(this).attr("href"))),account.navigate();break;default:console.log("default ",t)}}),this.create_forms(),window.addEventListener("popstate",this.navigate)},create_forms:function(){this.public_form=new formular("#public_datas",function(e){}).init(),this.public_form=new formular("#add_kid",function(e){}).init(),this.private_form=new formular("#private_datas",function(e){}).init()},navigate:function(){var e=this.parse_url(window.location.pathname);$("[data-for]").removeClass("selected"),$('[data-for="'+e.account+'"]').addClass("selected"),$.each($("[data-for]"),function(e,t){$("#"+$(this).attr("data-for")).css("display","none")}),$("#"+e.account).css("display","block"),$(".hor_nav").animate({scrollLeft:$(".hor_nav li.selected").position().left+$(".hor_nav").scrollLeft()-50},500)},parse_url:function(e){for(var t=[],a=e.split("/"),i=1;i<a.length;i+=2)t.push({}),t[a[i]]=a[i+1];return t},add_params:function(e){return e}},idkids_jssdk=function(e,t){this.options=e,this.callback=t,this.inited=!1,this.api={user:null,options:null,get:function(e,t,a){this.call("GET",e,t,a)},post:function(e,t,a){this.call("POST",e,t,a)},put:function(e,t,a){this.call("PUT",e,t,a)},"delete":function(e,t,a){this.call("DELETE",e,t,a)},call:function(e,t,a,i){a=this.add_params(a),console.log("call ",e,t,a,i),jQuery.ajax(t,{method:e,contentType:"application/json",data:a}).done(function(e){i(e)}).fail(function(){}).always(function(){})},get_user_status:function(){return this.set_user(),null===this.user?{status:"not_connected",infos:"call api.get('me')"}:{status:"logged",token:this.user.token,id:this.user.id,device:this.user.device}},get_params:function(){},add_params:function(e){return e.options=this.options,e.options.from_origin=window.location.origin,this.user&&(console.log("this.user ::: ",this.user),e.options.user_token=this.user.token,e.options.user_id=this.user._id,e.options.user_secret=this.user.secret,e.options.user_device=this.user.current_device),e},reset_user:function(e){var t=new URL(window.location.href),a=t.searchParams.get("idkids-token");if(null!==a){var i={token:t.searchParams.get("idkids-token"),_id:t.searchParams.get("idkids-id"),secret:t.searchParams.get("idkids-secret"),device:t.searchParams.get("idkids-device")};this.store("idkids_local_user",i),this.set_user(),e(i),window.location.href=window.location.pathname}},set_user:function(){this.getStore("idkids_local_user")},store:function(e,t){try{window.localStorage.setItem(e,JSON.stringify(t))}catch(a){console.log("error ::: ",a)}},getStore:function(e){try{this.user=JSON.parse(window.localStorage.getItem(e))}catch(t){console.log("error ::: ",t)}}},this.api.options=e,this.init=function(e){this.api.reset_user(function(e){console.log("reset user ",e)}),this.api.get("/me/from",{},function(t){e(t)})},this.isLogged=function(e){e(this.api.get_user_status())},this.createAuthbutton=function(e,t){null===document.getElementById(e)?t({status:"error",message:"TARGET_ID_TAG_ELEMENT_NOT_FOUND"}):document.getElementById(e).innerHTML='<div class="idkids-sdk"><a href="http://localhost:3000/auth?from='+window.location.origin.replace(new RegExp("/","g"),"R|")+"&redirect="+this.options.callback_url.replace(new RegExp("/","g"),"|")+"&secret="+this.options.secret+'" class="auth_button" data-action="login"><div class="avatar"></div><div class="label">CONNEXION</div></a></div>'},t({status:"sdk instance created"},this.options)};