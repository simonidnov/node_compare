div.col.col-md-7
  div.formular.basket
    h2 Détails de mon panier
    hr
    if (typeof basket === "undefined" || basket.length === 0)
      p Votre panier est vide
    else
      if (typeof basket[0].products === "undefined" || basket[0].products.length === 0)
        p Votre panier est vide
      else
        ul.products_list
          each product in basket[0].products
            li
              div.col
                if(product.infos.thumb !== "" && typeof product.infos.thumb !== "undefined")
                  div.preview(style="background-image:url("+product.infos.thumb+")")
                else
                  div.preview
              div.infos
                div.label= product.infos.label
                //-div.label= _.where(app.locals.applications, {_id:product.infos.app_id})
                //-div.label= "Ajouté le : "+product.infos.created
                div.brand
                  img(src=product.infos.app_icon, width="24", height="24")
                  div.label= product.infos.app_label
                //$a.hyperlink(href="" target="_blank") Voir le produit
                div.cat= product.infos.category+" | "+product.infos.sub_category+" | "+product.infos.extra_category
              div.details
                div.price= (product.price/100)+"€"
                //-input.quantity#quantity(name="quantity" type="number" value=product.quantity)
                div.options
                  div.btn.btn-warning.btn-sm(data-basketid=basket[0]._id, data-productid=product.product_id, data-idkidssdk="delete_basket_product")
                    span.icon.idkids-icons.icon-trash
                    span.label Supprimer

div.col.col-md-5.first_order
  div.basket.formular
    h2 Résumé du panier
    hr
    if(typeof basket === "undefined" || basket.length === 0)
      p Votre panier est vide
    else
      div.formular.fullscreen#checkout_form
        form.form_content(method="POST", action="/orders/transaction")
          div.total_products= "Votre panier contient "+basket[0].products.length+" produit"+ ((basket[0].products.length > 1)? "s" : "")
          div.total= "Total "+(basket[0].total_amount/100)+"€"
          hr
          input.phantom_input#user_id(type="text", name="user_id", value=user._id)
          input.phantom_input#basket_id(type="text", name="basket_id", value=basket[0]._id)
          input.phantom_input#coupons_code(type="text", name="coupons_code", value="")
          div.material_input.form-group.minlength
            input.form-control#coupon_code(type="text", minlength="3", name="coupon_code", data-errormessage="Ce code est invalide.")
            label(for="coupon_code") Code de réduction
          hr
          ul.coupons_list#coupons_list
          hr
          div.coupons_infos
            div.message
            div.amount
          script(src="https://js.stripe.com/v3/")
          script(src="https://checkout.stripe.com/v2/checkout.js")
          button.btn.btn-success.btn-lg.centered#order_transaction(
            data-action="submit",
            data-basketid=basket[0]._id, 
            data-value="Valider mon panier", 
            data-key=keyPublishable, 
            data-amount=basket[0].total_amount, 
            data-currency="eur", 
            data-email=user.email, 
            data-locale="fr-FR",
            data-firstname=user.firstname,
            data-lastname=user.lastname,
            data-image="/public/images/assets/icon_brand.svg",
            data-name=app.locals.settings.label,
            data-source='tok_visa',
            data-description="Finaliser ma commande") Finaliser ma commande
          
          //-hr.separator
          //-button.btn.btn-warning.centered#apple-pay-button APPLE PAY
          
          div.wallet_infos
            div.message
            div.amount
          hr
          div.payment_methods.centered
            img.centered(src="/public/images/assets/payment_methods_stripe.png" width="140")
