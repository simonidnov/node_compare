function decodeUriComponentWithSpace(e){return decodeURIComponent(e.replace(/\+/g,"%20"))}function getLocationParameters(e,t){if("hash"!==t&&"search"!==t&&"both"!==t)throw'getLocationParameters expect argument 2 "type" to be "hash", "search" or "both"';var i=void 0===e.search?"":e.search.substr(1),n=void 0===e.hash?"":e.hash.substr(1),o=[];"search"!==t&&"both"!==t||(o=o.concat(i.split("&"))),"hash"!==t&&"both"!==t||(o=o.concat(n.split("&")));for(var s,a={},r=0;r<o.length;r++)""!==o[r]&&(s=o[r].split("="),a[this.decodeUriComponentWithSpace(s[0])]=this.decodeUriComponentWithSpace(s[1]));return a}var idkids_jssdk=function(e,t){this.options=e,this.callback=t,this.inited=!1,-1===window.location.origin.indexOf("127.0.0.1")?e.is_debug=!1:e.is_debug=!0,this.logout=function(){this.api.store("idkids_local_user",""),window.history.pushState({pageTitle:document.title},document.title,window.location.origin+window.location.pathname)},$("html, body, *").off("click").on("click",function(e){}),this.api={user:null,parent:null,options:null,config:{url:"https://auth.joyvox.fr",debug_url:"http://127.0.0.1:3000"},get:function(e,t,i,n,o){this.call("GET",e,t,i,n,o)},post:function(e,t,i,n,o){this.options.is_debug&&(this.config.url=this.config.debug_url),this.add_params(t,$.proxy(function(t){$.post(this.config.url+e,{Accept:"text/plain; charset=utf-8",method:"POST",xhrFields:{withCredentials:!1},contentType:"application/jsonp; charset=utf-8",dataType:"json",data:t}).done($.proxy(function(e){i(e)},this)).fail(function(e){void 0!==n&&null!==n&&n(e)}).always($.proxy(function(e){void 0!==o&&null!==o&&o(e),this.hide_loader(),this.check_response(e)},this))},this))},put:function(e,t,i,n,o){this.call("PUT",e,t,i,n,o)},deleting:function(e,t,i,n,o){this.call("DELETE",e,t,i,n,o)},call:function(e,t,i,n,o,s){this.options.is_debug&&(this.config.url=this.config.debug_url),this.show_loader(),this.add_params(i,$.proxy(function(a){i=a,dataType="json","POST"!==e&&"PUT"!==e&&"DELETE"!==e||(dataType="json",i=JSON.stringify(i)),jQuery.ajax(this.config.url+t,{method:e,contentType:"application/json",dataType:dataType,data:i}).done($.proxy(function(e){void 0!==e.updated_token&&(this.user.token=e.updated_token,this.store("idkids_local_user",this.user)),n(e)},this)).fail(function(e){void 0!==o&&null!==o&&o(e)}).always($.proxy(function(e){this.hide_loader(),void 0!==s&&null!==s&&s(e),this.check_response(e)},this))},this))},check_response:function(e){if(void 0!==e.responseJSON&&(e=e.responseJSON),void 0!==e.idkids_user){var i={token:e.idkids_user.datas.token,_id:e.idkids_user.datas._id,secret:e.idkids_user.datas.secret,device:e.idkids_user.datas.current_device};this.store("idkids_local_user",i)}if(void 0!==e.response_display){203===e.status?(t("logout"),this.store("idkids_local_user",""),this.get("/auth/logout",{},function(){}),void 0===e.response_display.buttons&&(e.response_display.buttons=[{class:"btn-success",label:"Me connecter",value:0,href:(void 0!==this.config.url?this.config.url:"")+"/auth?secret="+this.options.secret},{class:"",label:"Créer un compte",value:1,href:(void 0!==this.config.url?this.config.url:"")+"/auth/subscribe?secret="+this.options.secret}])):401===e.status&&(this.get("/auth/logout",{},function(){}),e.response_display.buttons=[{class:"btn-success",label:"Me connecter",value:0,href:(void 0!==this.config.url?this.config.url:"")+"/auth?secret="+this.options.secret},{class:"btn-warning",label:"Créer un compte",value:1,href:(void 0!==this.config.url?this.config.url:"")+"/auth/subscribe?secret="+this.options.secret}]),e.response_display.type="modal";new popeye($("body"),e.response_display,function(e){}).init()}},get_user_status:function(){return this.set_user(),null===this.user?{status:"not_connected",infos:"call api.get('me')"}:void 0===this.user._id?{status:"not_connected",infos:"call api.get('me')"}:("undefined"!=typeof Unity&&Unity.call('{"status":"logged", "user":"'+JSON.stringify(this.user)+'", "token":"'+this.user.token+'", "id":"'+this.user.id+'", "device":"'+this.user.device+'"}'),{status:"logged",user:this.user,token:this.user.token,id:this.user.id,device:this.user.device})},get_params:function(){},show_loader:function(){0===$(".idkids_jssdk.loader").length&&$("body").append('<div class="idkids_jssdk loader"><div class="centered"><svg version="1.1" id="Calque_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\t viewBox="0 0 256 256" style="enable-background:new 0 0 256 256;" xml:space="preserve"><style type="text/css">\t.st0{fill:none;stroke:#4F555A;stroke-width:28;stroke-miterlimit:10;}\t.st1{fill:#C93632;}</style><circle class="st0" cx="128" cy="128" r="53"/><circle class="st1" cx="128" cy="128" r="26"/></svg><span>Chargement</span></div></div>'),$(".idkids_jssdk.loader").addClass("showed").addClass("visible")},hide_loader:function(){setTimeout(function(){$(".idkids_jssdk.loader").removeClass("showed"),setTimeout(function(){$(".idkids_jssdk.loader").removeClass("visible"),$(".idkids_jssdk.loader").remove()},200)},100)},add_params:function(e,t){e.options=this.options,e.options.from_origin=window.location.origin,this.user&&(e.options.user_token=this.user.token,e.options.user_id=this.user._id,e.options.user_secret=this.user.secret,e.options.user_device=this.user.current_device),this.get_device_uid(function(i){200!==i.status&&(e.need_fingerprint=!0),delete i.status,e.device_infos=i,t(e)})},reset_user:function(e){var t=new URL(window.location.href);if(void 0!==t.searchParams){var i=t.searchParams.get("idkids-token");if(null!==i&&""!==i&&void 0!==i){var n={token:t.searchParams.get("idkids-token"),_id:t.searchParams.get("idkids-id"),secret:t.searchParams.get("idkids-secret"),device:t.searchParams.get("idkids-device")};this.store("idkids_local_user",n),this.set_user(),window.history.pushState({pageTitle:document.title},document.title,window.location.origin+window.location.pathname),e(n)}}else{var o=getLocationParameters(window.location,"both"),i=o["idkids-token"];if(void 0!==i&&null!==i&&"undefined"!==i){var n={token:o["idkids-token"],_id:o["idkids-id"],secret:o["idkids-secret"],device:o["idkids-device"]};this.store("idkids_local_user",n),this.set_user(),window.history.pushState({pageTitle:document.title},document.title,window.location.origin+window.location.pathname),e(n)}}},set_user:function(){this.getStore("idkids_local_user")},store:function(e,t){try{window.localStorage.setItem(e,JSON.stringify(t))}catch(i){Cookies.set(e,JSON.stringify(t),{expires:7})}},getStore:function(e){try{return"idkids_local_user"===e&&(this.user=JSON.parse(window.localStorage.getItem(e))),JSON.parse(window.localStorage.getItem(e))}catch(t){return"idkids_local_user"===e&&(this.user=JSON.parse(Cookies.get(e))),JSON.parse(JSON.parse(Cookies.get(e)))}},get_device_uid:function(e){$('[name="appCodeName"]').val(navigator.appCodeName),$('[name="appName"]').val(navigator.appName),$('[name="appVersion"]').val(navigator.appVersion),$('[name="userAgent"]').val(navigator.userAgent),$('[name="vendor"]').val(navigator.vendor),"undefined"!=typeof Fingerprint2?(new Fingerprint2).get(function(t,i){$('[name="device_uid"]').val(t),e({status:200,device_uid:t})}):e({status:404,platform:navigator.platform,appCodeName:navigator.appCodeName,appName:navigator.appName,appVersion:navigator.appVersion,userAgent:navigator.userAgent,vendor:navigator.vendor})}},this.api.parent=this,this.api.options=e,this.init=function(e){this.check_cookies(),window.matchMedia("(display-mode: standalone)").matches,"undefined"==typeof Unity&&(Unity={call:function(e){var t=document.createElement("IFRAME");t.setAttribute("src","unity:"+e),document.documentElement.appendChild(t),document.documentElement.removeChild(t)}}),this.api.get_device_uid(function(e){}),this.api.reset_user(function(e){}),this.api.get("/me/from",{secret:{}},function(t){e(t)});var t=new URL(window.location.href);if(void 0!==t.searchParams)var i=t.searchParams.get("idkids-sdk-action");else var n=getLocationParameters(window.location,"both"),i=n["idkids-sdk-action"];switch(i){case"logout":this.logout();break;default:console.log("IDKIDS SDK TOOLKIT has returned an action not defined in your javascript sdk version. please upgrade the latest version of idkids-js-sdk on your server then try again.")}this.reset_listeners()},this.isLogged=function(e){e(this.api.get_user_status())},this.getPage=function(e,t,i){this.api.get(e,t,i,null,function(e){i(e)})},this.template=function(e,t,i){$.get(this.api.config.url+"/templating/"+e,t,function(e){i(e)})},this.createAuthbutton=function(e,t){if(null===document.getElementById(e))t({status:"error",message:"TARGET_ID_TAG_ELEMENT_NOT_FOUND"});else{this.template("auth_button",{user:this.api.user,options:this.options},function(i){document.getElementById(e).innerHTML=i,t({status:"success",message:"AUTH_BUTTON_CREATED"})})}},this.createNotificationButton=function(e,t){if(null===document.getElementById(e))t({status:"error",message:"TARGET_ID_TAG_ELEMENT_NOT_FOUND"});else{this.template("notif_button",{user:this.api.user,options:this.options},function(i){document.getElementById(e).innerHTML=i,t({status:"success",message:"AUTH_BUTTON_CREATED"})})}},this.validInitedApp=function(e){this.api.get(this.api.config.url+"/api/apps/validate",{secret:this.options.secret},function(t){e(t)})},this.reset_listeners=function(){var e=this;$("[data-idkidssdk]").off("click").on("click",function(t){switch($(this).attr("data-idkidssdk")){case"add_basket":e.api.post("/basket",{product_id:$(this).attr("data-productid"),quantity:$(this).attr("data-quantity"),url:window.location.href},function(t){if(200===t.status){var i=parseInt($("#notifications .indice").html())+1;$("#notifications .indice").html(i),$("#total_basket").html("("+i+")")}e.callback({status:"ADD_BASKET"})});break;case"delete_basket_product":e.api.deleting("/basket",{basket_id:$(this).attr("data-basketid"),product_id:$(this).attr("data-productid")},function(e){200===e.status&&window.location.reload()});break;default:console.log("action not reconized by idkids sdk, please upgrade your sdk version")}})},this.check_cookies=function(){if(null===this.api.getStore("accept_cookies")){var e='<div class="idkids_cookies" id="idkids_cookies">';e+="<p>En poursuivant votre navigation sur ce site, vous acceptez l’utilisation de cookies à des fins de partage sur les réseaux sociaux et de statistiques de visites, afin de bénéficier d'une navigation et d'offres personnalisées à vos besoins. Pour en savoir plus cliquez ici et pour paramétrer les cookies <a href=\"https://auth.joyvox.fr/uses-of-cookies\">cliquez ici.</a></p>",e+='<div class="btn btn-danger centered" id="accept_cookies">J\'accepte</div>',e+="</div>",$("body").append(e),$("#accept_cookies").on("click",$.proxy(function(e){this.api.store("accept_cookies",{status:"checked"}),$("#idkids_cookies").remove()},this))}},this.connect=function(){window.location.href=this.api.config.url+"/auth?secret="+this.options.secret},this.downloadFile=function(e){var t=new XMLHttpRequest,i=e.split("/")[e.split("/").length-1];index.sdk.createProgressBar("Téléchargement de "+i,$("body")),t.responseType="blob",t.open("GET",e),t.addEventListener("error",function(e){console.log("error "+t)}),t.addEventListener("progress",function(e){var t=(e.loaded/1e6).toFixed(2),i=(e.total/1e6).toFixed(2),n=(e.loaded/e.total*100).toFixed(2);index.sdk.updateProgressBar(n,t+" / "+i+" Mb | "+Math.round(n)+"%")}),t.addEventListener("load",function(e){if(index.sdk.deleteProgressBar(),4==t.readyState&&200==t.status){var n=new Blob([t.response],{type:"application/zip"});saveAs(n,i)}}),t.send()},this.createProgressBar=function(e,t){t.prepend('<div class="idkids_progressbar"><div class="content_panel"><h3>'+e+'</h3><div class="progress"><div class="infos">En attente d\'information</div><div class="bar"><div class="infos">En attente d\'information</div></div></div></div></div>'),setTimeout(function(){$(".idkids_progressbar .content_panel").css("top",0)},200)},this.updateProgressBar=function(e,t){$(".idkids_progressbar .bar").css("width",e+"%"),$(".idkids_progressbar .infos").html(t)},this.deleteProgressBar=function(){setTimeout(function(){$(".idkids_progressbar .content_panel").css("top","150%"),setTimeout(function(){$(".idkids_progressbar").remove()},400)},1e3)}};!function(e){var t=!1;if("function"==typeof define&&define.amd&&(define(e),t=!0),"object"==typeof exports&&(module.exports=e(),t=!0),!t){var i=window.Cookies,n=window.Cookies=e();n.noConflict=function(){return window.Cookies=i,n}}}(function(){function e(){for(var e=0,t={};e<arguments.length;e++){var i=arguments[e];for(var n in i)t[n]=i[n]}return t}function t(i){function n(t,o,s){var a;if("undefined"!=typeof document){if(arguments.length>1){if(s=e({path:"/"},n.defaults,s),"number"==typeof s.expires){var r=new Date;r.setMilliseconds(r.getMilliseconds()+864e5*s.expires),s.expires=r}s.expires=s.expires?s.expires.toUTCString():"";try{a=JSON.stringify(o),/^[\{\[]/.test(a)&&(o=a)}catch(e){}o=i.write?i.write(o,t):encodeURIComponent(String(o)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)),t=t.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent),t=t.replace(/[\(\)]/g,escape);var d="";for(var c in s)s[c]&&(d+="; "+c,!0!==s[c]&&(d+="="+s[c]));return document.cookie=t+"="+o+d}t||(a={});for(var u=document.cookie?document.cookie.split("; "):[],l=/(%[0-9A-Z]{2})+/g,p=0;p<u.length;p++){var h=u[p].split("="),f=h.slice(1).join("=");this.json||'"'!==f.charAt(0)||(f=f.slice(1,-1));try{var g=h[0].replace(l,decodeURIComponent);if(f=i.read?i.read(f,g):i(f,g)||f.replace(l,decodeURIComponent),this.json)try{f=JSON.parse(f)}catch(e){}if(t===g){a=f;break}t||(a[g]=f)}catch(e){}}return a}}return n.set=n,n.get=function(e){return n.call(n,e)},n.getJSON=function(){return n.apply({json:!0},[].slice.call(arguments))},n.defaults={},n.remove=function(t,i){n(t,"",e(i,{expires:-1}))},n.withConverter=t,n}return t(function(){})}),function(e){"use strict";if(e.URL=e.URL||e.webkitURL,e.Blob&&e.URL)try{return void new Blob}catch(e){}var t=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||function(e){var t=function(e){return Object.prototype.toString.call(e).match(/^\[object\s(.*)\]$/)[1]},i=function(){this.data=[]},n=function(e,t,i){this.data=e,this.size=e.length,this.type=t,this.encoding=i},o=i.prototype,s=n.prototype,a=e.FileReaderSync,r=function(e){this.code=this[this.name=e]},d="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),c=d.length,u=e.URL||e.webkitURL||e,l=u.createObjectURL,p=u.revokeObjectURL,h=u,f=e.btoa,g=e.atob,v=e.ArrayBuffer,_=e.Uint8Array,m=/^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/;for(n.fake=s.fake=!0;c--;)r.prototype[d[c]]=c+1;return u.createObjectURL||(h=e.URL=function(e){var t,i=document.createElementNS("http://www.w3.org/1999/xhtml","a");return i.href=e,"origin"in i||("data:"===i.protocol.toLowerCase()?i.origin=null:(t=e.match(m),i.origin=t&&t[1])),i}),h.createObjectURL=function(e){var t,i=e.type;return null===i&&(i="application/octet-stream"),e instanceof n?(t="data:"+i,"base64"===e.encoding?t+";base64,"+e.data:"URI"===e.encoding?t+","+decodeURIComponent(e.data):f?t+";base64,"+f(e.data):t+","+encodeURIComponent(e.data)):l?l.call(u,e):void 0},h.revokeObjectURL=function(e){"data:"!==e.substring(0,5)&&p&&p.call(u,e)},o.append=function(e){var i=this.data;if(_&&(e instanceof v||e instanceof _)){for(var o="",s=new _(e),d=0,c=s.length;d<c;d++)o+=String.fromCharCode(s[d]);i.push(o)}else if("Blob"===t(e)||"File"===t(e)){if(!a)throw new r("NOT_READABLE_ERR");var u=new a;i.push(u.readAsBinaryString(e))}else e instanceof n?"base64"===e.encoding&&g?i.push(g(e.data)):"URI"===e.encoding?i.push(decodeURIComponent(e.data)):"raw"===e.encoding&&i.push(e.data):("string"!=typeof e&&(e+=""),i.push(unescape(encodeURIComponent(e))))},o.getBlob=function(e){return arguments.length||(e=null),new n(this.data.join(""),e,"raw")},o.toString=function(){return"[object BlobBuilder]"},s.slice=function(e,t,i){var o=arguments.length;return o<3&&(i=null),new n(this.data.slice(e,o>1?t:this.data.length),i,this.encoding)},s.toString=function(){return"[object Blob]"},s.close=function(){this.size=0,delete this.data},i}(e);e.Blob=function(e,i){var n=i?i.type||"":"",o=new t;if(e)for(var s=0,a=e.length;s<a;s++)Uint8Array&&e[s]instanceof Uint8Array?o.append(e[s].buffer):o.append(e[s]);var r=o.getBlob(n);return!r.slice&&r.webkitSlice&&(r.slice=r.webkitSlice),r};var i=Object.getPrototypeOf||function(e){return e.__proto__};e.Blob.prototype=i(new e.Blob)}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this);var saveAs=saveAs||function(e){"use strict";if(!(void 0===e||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t=e.document,i=function(){return e.URL||e.webkitURL||e},n=t.createElementNS("http://www.w3.org/1999/xhtml","a"),o="download"in n,s=function(e){var t=new MouseEvent("click");e.dispatchEvent(t)},a=/constructor/i.test(e.HTMLElement)||e.safari,r=/CriOS\/[\d]+/.test(navigator.userAgent),d=e.setImmediate||e.setTimeout,c=function(e){d(function(){throw e},0)},u=function(e){var t=function(){"string"==typeof e?i().revokeObjectURL(e):e.remove()};setTimeout(t,4e4)},l=function(e,t,i){t=[].concat(t);for(var n=t.length;n--;){var o=e["on"+t[n]];if("function"==typeof o)try{o.call(e,i||e)}catch(e){c(e)}}},p=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},h=function(t,c,h){h||(t=p(t));var f,g=this,v=t.type,_="application/octet-stream"===v,m=function(){l(g,"writestart progress write writeend".split(" "))};if(g.readyState=g.INIT,o)return f=i().createObjectURL(t),void d(function(){n.href=f,n.download=c,s(n),m(),u(f),g.readyState=g.DONE},0);!function(){if((r||_&&a)&&e.FileReader){var n=new FileReader;return n.onloadend=function(){var t=r?n.result:n.result.replace(/^data:[^;]*;/,"data:attachment/file;");e.open(t,"_blank")||(e.location.href=t),t=void 0,g.readyState=g.DONE,m()},n.readAsDataURL(t),void(g.readyState=g.INIT)}if(f||(f=i().createObjectURL(t)),_)e.location.href=f;else{e.open(f,"_blank")||(e.location.href=f)}g.readyState=g.DONE,m(),u(f)}()},f=h.prototype,g=function(e,t,i){return new h(e,t||e.name||"download",i)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,i){return t=t||e.name||"download",i||(e=p(e)),navigator.msSaveOrOpenBlob(e,t)}:(f.abort=function(){},f.readyState=f.INIT=0,f.WRITING=1,f.DONE=2,f.error=f.onwritestart=f.onprogress=f.onwrite=f.onabort=f.onerror=f.onwriteend=null,g)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this);