var express=require("express"),path=require("path"),compression=require("compression"),config=require("./config/config"),favicon=require("serve-favicon"),cp=require("childprocess").spawn,logger=require("morgan"),cookieParser=require("cookie-parser"),bodyParser=require("body-parser"),index=require("./routes/index"),stripe_test=require("./routes/stripe_test"),basket=require("./routes/basket"),orders=require("./routes/orders"),comments=require("./routes/comments"),users=require("./routes/users"),media=
require("./routes/media"),gmail=require("./routes/gmail"),admin=require("./routes/admin"),products=require("./routes/products"),redirect=require("./routes/redirect"),validation=require("./routes/validation"),api=require("./routes/api"),templating=require("./routes/templating"),auth=require("./routes/auth"),checking_session=require("./routes/checking_session"),me=require("./routes/me"),coupon_code=require("./routes/coupon_code"),address=require("./routes/address"),account=require("./routes/account"),
settings=require("./routes/settings"),session=require("express-session"),Apps_controller=require("./controllers/apps_controller");Settings_model=require("./models/settings_model");router=express.Router();app=module.exports=express();Apps_controller.get(null,{},function(a){app.locals.applications=a.datas});Settings_model.get(null,{},function(a){app.locals.settings=a});app.locals.auth_lang=require("./public/languages/auth_lang");app.locals.api_lang=require("./public/languages/api_lang");
app.locals.admin_lang=require("./public/languages/admin_lang");app.locals._=require("underscore");app.listen(9E3);app.use(session({secret:"secret",cookie:{secure:!1,httpOnly:!1,maxAge:864E5},name:"Auth",proxy:!0,resave:!0,saveUninitialized:!0}));app.use(bodyParser.json({limit:"50mb"}));app.use(bodyParser.urlencoded({limit:"50mb",extended:!0}));app.use(compression());app.set("views",path.join(__dirname,"views"));app.set("view engine","pug");
app.use("/uploads",express["static"](path.join(__dirname,"uploads")));app.use("/public",express["static"](path.join(__dirname,"public")));app.use("/node_modules",express["static"](path.join(__dirname,"node_modules")));app.use(logger("dev"));app.use(bodyParser.json());app.use(bodyParser.urlencoded({extended:!0}));app.use(cookieParser());app.use(express["static"](path.join(__dirname,"public")));
app.use(function(a,c,b){var d=(a.headers["x-forwarded-proto"]||"").toLowerCase();"https"===d?(console.log("HAS HTTPS ",d),b()):(console.log("DOESNT HAVE HTTPS ",d),console.log("NEED HTTPS ",a.headers.host),-1===a.headers.host.indexOf("127.0.0.1")?c.redirect("https://"+a.headers.host+a.url):b())});router.use("/admin",admin);router.use("/admin/:any",admin);router.use("/users",users);router.use("/me",me);router.use("/account",account);router.use("/account/:any",account);router.use("/api",api);
router.use("/media",media);router.use("/gmail",gmail);router.use("/address",address);router.use("/validation",validation);router.use("/templating",templating);router.use("/redirect",redirect);router.use("/auth",auth);router.use("/checking_session",checking_session);router.use("/products",products);router.use("/settings",settings);router.use("/basket",basket);router.use("/orders",orders);router.use("/comments",comments);router.use("/stripe_test",stripe_test);router.use("/coupon_code",coupon_code);
router.use("/coupon_code/:any",coupon_code);router.use("/",index);app.use("/",router);app.use(function(a,c,b){a=Error("Not Found");a.status=404;b(a)});app.use(function(a,c,b,d){b.locals.message=a.message;b.locals.error="development"===c.app.get("env")?a:{};b.status(a.status||500);b.render("error")});
