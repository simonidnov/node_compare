var express=require("express"),media=express.Router(),Mime=require("mime"),mkdirp=require("mkdirp"),crypto=require("crypto"),multer=require("multer"),storage=multer.diskStorage({destination:function(a,b,c){a=new Date;b=a.getUTCMonth()+1;var d=a.getUTCDate();a="public/uploads/"+a.getUTCFullYear()+"-"+b+"-"+d;mkdirp.sync(a);c(null,a)},filename:function(a,b,c){a=new Date;var d=a.getUTCMonth()+1,e=a.getUTCDate(),f=a.getUTCFullYear();crypto.pseudoRandomBytes(16,function(a,g){c(null,f+"-"+d+"-"+e+"-"+g.toString("hex")+
"."+Mime.getExtension(b.mimetype))})}}),upload=multer({storage:storage,dest:"public/uploads/",inMemory:!0,includeEmptyFields:!0});
media.get("/",function(a,b,c){b.send({message:"media upload GET is on development"})}).post("/",upload.single("avatar"),function(a,b,c){b.status(200).send({status:200,message:"file upload success",path:a.file.path,file:a.file})}).put("/",function(a,b,c){b.send({message:"media upload PUT is on development"})}).post("/base64",upload.single("base64"),function(a,b,c){b.status(200).send({status:200,message:"file upload success",path:"/"+a.file.path,file:a.file})});module.exports=media;
