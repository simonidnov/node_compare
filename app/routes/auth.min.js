var express=require("express"),auth=express.Router(),Auth_controller=require("../controllers/auth_controller"),language_helper=require("../helpers/languages_helper"),uri_helper=require("../helpers/uri_helper"),lang=require("../public/languages/auth_lang"),machineId=require("node-machine-id"),device_uid=machineId.machineIdSync({original:true}),Fb=require("fb");auth.get("/",function(c,a,b){console.log("TRY FA facebook INIT API app id 143900369638121 SECRET 393fec1031105f7144748d3d569b7896");Fb.api("oauth/access_token",{client_id:"143900369638121",client_secret:"393fec1031105f7144748d3d569b7896",redirect_uri:"http://idkids-app.com/auth/facebook",code:"code"},function(f){if(!f||f.error){console.log(!f?"error occurred":f.error);return}var e=f.access_token;var d=f.expires?f.expires:0});Auth_controller.login(c,c.query,function(f){var d={title:"Mon compte",datas:c.query,locale:language_helper.getlocale(),lang:lang,uri_params:uri_helper.get_params(c),response:f,js:["/public/javascripts/login.js","/public/javascripts/components/formular.js"],css:["/public/stylesheets/components/formular.css","/public/stylesheets/auth.css",]};d.user_session=c.session.Auth;if(typeof f.user!=="undefined"){a.redirect(307,"/account?idkids-token="+f.user.token+"&idkids-id="+f.user._id+"&idkids-device="+f.user.current_device)}a.render("auth/login",d)})}).get("/fingerprint/:device_uid",function(c,a,b){Auth_controller.get_user_from_device(c.params.device_uid,function(d){Auth_controller.login(c,c.query,function(g){var f={title:"Mon compte",datas:c.query,locale:language_helper.getlocale(),lang:lang,uri_params:uri_helper.get_params(c),users_device:d.users_device,response:g,js:["/public/javascripts/login.js","/public/javascripts/components/formular.js"],css:["/public/stylesheets/components/formular.css","/public/stylesheets/auth.css",]};f.user_session=c.session.Auth;if(typeof g.user!=="undefined"){a.redirect(307,"/account?idkids-token="+g.user.token+"&idkids-id="+g.user._id+"&idkids-device="+g.user.current_device)}a.render("auth/login",f)})})}).get("/google/callback",function(c,a,b){}).get("/facebook/callback",function(c,a,b){}).get("/twitter/callback",function(c,a,b){}).post("/login",function(c,a,b){Auth_controller.register(c,function(g){if(typeof g.user!=="undefined"){a.redirect(307,"/account/?idkids-token="+g.user.token+"&idkids-id="+g.user._id+"&idkids-device="+g.user.current_device)}var f=[];var d={title:"Mon compte",datas:c.query,locale:language_helper.getlocale(),lang:lang,uri_params:uri_helper.get_params(c),response:g,js:["/public/javascripts/login.js","/public/javascripts/components/formular.js"],css:["/public/stylesheets/components/formular.css","/public/stylesheets/auth.css",]};a.render("auth/login",d)})}).put("/login",function(c,a,b){Auth_controller.update(c,a,function(){a.send("login put params")})}).deleting("/login",function(c,a,b){Auth_controller.unregister(c,a,function(){a.send("login delete params")})}).get("/:form_name/*",function(c,a,b){Auth_controller.login(c,c.query,function(f){var d={title:"Mon compte",datas:c.query,response:f,locale:language_helper.getlocale(),lang:lang,uri_params:uri_helper.get_params(c),form:c.params.form_name,js:["/public/javascripts/login.js","/public/javascripts/components/formular.js"],css:["/public/stylesheets/components/formular.css","/public/stylesheets/auth.css",]};if(typeof f.idkids_user!=="undefined"){a.redirect(307,"/account?idkids-token="+f.idkids_user.datas.token+"&idkids-id="+f.idkids_user.datas._id+"&idkids-device="+f.idkids_user.datas.current_device+"&idkids-secret="+f.idkids_user.datas.secret)}a.render("auth/login",d)})}).deleting("/device",function(c,a,b){Auth_controller.delete_device(c,a,function(d){a.send(d)})}).get("/logout",function(c,a,b){Auth_controller.logout(c,a,function(d,e){a.redirect(307,c.headers.referer)})}).get("/account",function(c,a,b){a.render("account",{title:"account auth page"})});module.exports=auth;