const db=require("mongoose"),emailing=require("express")(),path=require("path"),config=require("../config/config"),mailer=require("express-mailer"),email_datas={user_id:{type:"string"},email:{type:"string"},created:{type:"Date","default":Date.now},sended:{type:"Date","default":Date.now},updated:{type:"Date","default":Date.now},content:{type:"string"}};mailer.extend(emailing,config.emailing),emailing.set("views",path.join(__dirname,"../views")),emailing.set("view engine","pug"),0===db.connection.readyState&&db.connect(config.database.users,{useMongoClient:!0});const emailSchemas=new db.Schema(email_datas),Email=db.model("Emails",emailSchemas);module.exports={attributes:email_datas},module.exports.send=function(e,t,s,a){data={user_id:t,email:s.email,content:e},new_email=new Email(data),new_email.save(function(e,t){e?a({status:405,message:"error email sending impossible"}):console.log("success entry")}),emailing.mailer.send(e,s,function(e,t){return e?void a({status:405,message:"Email ERROR",datas:s}):void a({status:200,message:"Email SENDED",datas:s,infos:t})})};