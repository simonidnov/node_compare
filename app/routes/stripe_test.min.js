var keyPublishable="",keySecret="",express=require("express"),stripe_test=express.Router();stripe=require("stripe"),Coupon_controller=require("../controllers/coupon_controller"),stripe_test.use(function(e,t,r){t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),t.setHeader("Access-Control-Allow-Methods","GET, PUT, POST, DELETE"),app.locals.settings.StripeMode?(keyPublishable=app.locals.settings.StripekeyPublishable,keySecret=app.locals.settings.StripekeySecret):(keyPublishable=app.locals.settings.StripekeyPublishableTest,keySecret=app.locals.settings.StripekeySecretTest),stripe=require("stripe")(keySecret),r()}),stripe_test.get("/",function(e,t,r){Coupon_controller.get(e,t,function(e){t.render("stripe_test",{title:"Stripe",keyPublishable:keyPublishable,coupon:e,js:[],css:[]}).end()})}).get("/charge",function(e,t){console.log("req.query ::::: ",e.query)}).post("/charge",function(e,t){console.log("req.body ::::: ",e.body),console.log(JSON.stringify(e.body,null,2));var r=e.body.token;stripe.charges.create({amount:5,currency:"eur",card:r,description:e.body.stripeEmail},function(e,r){console.log("ERROR ? ",e),e&&"StripeCardError"===e.type&&console.log(JSON.stringify(e,null,2)),console.log("charge :::: ",r),t.send("completed payment!")})}),module.exports=stripe_test;