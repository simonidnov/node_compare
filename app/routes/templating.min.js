const express=require("express"),_und=require("underscore"),templating=express.Router(),Auth_controller=require("../controllers/auth_controller"),Basket_controller=require("../controllers/basket_controller"),Basket_model=require("../models/basket_model"),language_helper=require("../helpers/languages_helper"),uri_helper=require("../helpers/uri_helper"),lang=require("../public/languages/auth_lang"),machineId=require("node-machine-id");var device_uid=machineId.machineIdSync({original:!0});templating.use(function(e,r,t){r.setHeader("Access-Control-Allow-Origin","*"),r.setHeader("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept, authorization"),r.setHeader("Access-Control-Allow-Methods","GET,POST,DELETE,PUT,OPTIONS");e.query;"PUT"!==e.method&&"POST"!==e.method&&"DELETE"!==e.method||e.body,t()}),templating.get("/:template",function(e,r,t){switch(e.datas_set={locale:language_helper.getlocale(e),lang:lang,query:e.query,_:_und},e.params.template){case"notif_button":void 0!==e.query.user?(console.log("HAS USER ? ",e.query.user),Basket_model.get({user_id:e.query.user._id},e,function(r){console.log("GET BASKET USER FROM TEMPLATING ",r),e.datas_set.basket=r.datas,t()})):t();break;default:void 0!==e.session.Auth&&(e.datas_set.user=e.session.Auth,void 0!==e.query.member_id&&(e.datas_set.member=_und.where(e.datas_set.user.members,{_id:e.query.member_id})[0])),t()}},function(e,r,t){r.render("templates/"+e.params.template,e.datas_set),r.end()}),module.exports=templating;