function formular(a,t){this.target=a,this.callback=t,this.email_tester=/^[-!#$%&'*+\/0-9=?A-Z^_a-z{|}~](\.?[-!#$%&'*+\/0-9=?A-Z^_a-z`{|}~])*@[a-zA-Z0-9](-?\.?[a-zA-Z0-9])*\.[a-zA-Z](-?[a-zA-Z0-9])+$/,this.init=function(){this.callback({status:"inited"}),this.setListeners()},this.setListeners=function(){var t=this;$(a).find(".delete_input_array_button").off("click").on("click",function(){$(this).parent().remove()}),$(a).find(".add_input_array_button").off("click").on("click",function(){var t=$(this).parent().parent().attr("data-name")+""+$(this).parent().parent().find("input").length;$(this).parent().parent().find(".array_list_inputs").append('<li class="form-group material_input"><input minlength="5" type="text" name="'+t+'" value=""/><label>Entrez une valeur</label><div class="delete_input_array_button">Supprimer</div></li>'),$(a).find(".delete_input_array_button").off("click").on("click",function(){$(this).parent().remove()})}),$(a).find("[data-file]").off("change").on("change",function(t){var e=$(this).attr("id"),i=new FormData;i.append("avatar",$(this)[0].files[0]),$.ajax({url:"/media",type:"POST",method:"POST",data:i,contentType:!1,processData:!1,success:function(t){$(a).find('[for="'+e+'"] img').attr("src","/"+t.path),$(a).find("#"+e.replace("_file","")).val("/"+t.path)}})}),$(a).find(".image_cropper").change(function(){var t=document.getElementById($(this).attr("id")+"_preview"),e=new FileReader,i=$(this);e.readAsDataURL(this.files[0]),e.onload=function(e){t.src=this.result,i.parent().append('<div class="btn btn-success valid_crop">Valider</div>');var n=new Cropper(t,{aspectRatio:i.attr("data-width")/i.attr("data-height"),crop:function(a){}});i.parent().find(".valid_crop").off("click").on("click",function(){i.parent().find(".valid_crop").remove(),t.src=n.getCroppedCanvas().toDataURL(),n.destroy();var e=($("#image-id").attr("src"),t.src.replace(/^data:image\/(png|jpg);base64,/,"")),r=base64ToBlob(e,"image/png"),s=new FormData;s.append("base64",r),$.ajax({url:"/media/base64",type:"POST",method:"POST",data:s,contentType:!1,processData:!1,success:function(t){$(a).find("#"+i.attr("data-target")).val(t.path)}})})}}),$(a).find("[data-action]").off("click").on("click",function(a){a.preventDefault();var e=$(this).attr("data-action");return t.callback({status:"hitted",action:e}),!1}),$(a).find(".material_input input").off("focus").on("focus",function(){if($(this).parent().addClass("focused"),t.callback({status:"focus",value:$(this)}),"date"===$(this).attr("type")){var a=navigator.userAgent||navigator.vendor||window.opera;if(/windows phone/i.test(a))return!1;if(/android/i.test(a))return!1;if(/iPad|iPhone|iPod/.test(a)&&!window.MSStream)return!1;new datepicker($(this),function(a){console.log(a)})}}),t.check_min_max(),$(a).find(".material_input input, .material_input textarea").off("keypress").on("keypress",function(){t.check_min_max()}),$(a).find(".material_input input").off("blur").on("blur",function(){t.check_min_max(),t.inputCheck($(this),!0),$(this).parent().removeClass("focused"),t.callback({status:"blur",value:$(this)})}),$(a).find(".material_input input").off("input").on("input",function(){t.inputCheck($(this),!1)}),$(a).find('input[type="checkbox"]').off("change").on("change",function(){t.inputCheck($(this)),t.checkInputs(!1),t.callback({status:"checkbox",name:$(this).attr("name"),value:$(this).is(":checked")})}),t.checkInputs(!1),$(a).find("[data-tab]").off("click").on("click",function(){var a=$(this).attr("data-tab");$.each($(this).parent().find("[data-tab]"),function(t,e){$(this).attr("data-tab")===a?($("#"+$(this).attr("data-tab")).css("display","block"),$('[data-tab="'+$(this).attr("data-tab")+'"]').addClass("selected")):($("#"+$(this).attr("data-tab")).css("display","none"),$('[data-tab="'+$(this).attr("data-tab")+'"]').removeClass("selected"))}),t.callback({status:"tab_change",value:$(this).attr("data-tab")})})},this.check_min_max=function(){$.each($(a).find(".minlength"),function(a,t){var t=null,e="";if($(this).find("input").length>0)t=$(this).find("input"),e=t.val();else{if(!($(this).find("textarea").length>0))return!1;t=$(this).find("textarea"),e=t.val()}0===$(this).find(".number").length&&$(this).append('<span class="number"></span>'),e.length>=parseInt(t.attr("minlength"))?$(this).find(".number").html('<span class="icon idkids-icon icon-check"></span>'):$(this).find(".number").html(e.length+"/"+t.attr("minlength"))})},this.checkInputs=function(t){var e=this;$.each($(a).find(".material_input input"),function(a,i){e.inputCheck($(this),t)})},this.inputCheck=function(a,t){var e=this;if("checkbox"===a.attr("type"))return this.validform(),a.is(":checked")?($('[data-checkboxrelative="'+a.attr("id")+'"]').css("display","block"),!0):($('[data-checkboxrelative="'+a.attr("id")+'"]').css("display","none"),!1);if(""==a.val())return a.parent().removeClass("invalid"),a.parent().removeClass("valid"),a.parent().removeClass("notempty"),void a.parent().find(".input_error").remove();switch(a.attr("type")){case"email":return this.validateEmail(a.val())?(a.parent().addClass("valid"),a.parent().removeClass("invalid"),a.parent().find(".input_error").remove()):(a.parent().addClass("invalid"),a.parent().removeClass("valid"),void 0!==a.attr("data-errormessage")&&0==a.parent().find(".input_error").length&&t&&a.parent().append('<div class="input_error">'+a.attr("data-errormessage")+"</div>")),void e.validform();case"date":return a.parent().addClass("valid"),void e.validform();case"radio":case"checkbox":e.validform()}if(a.parent().addClass("notempty"),void 0!==a.attr("data-regex")){if("same"===a.attr("data-regex"))return a.val()===$("#"+a.attr("data-target")).val()?(a.parent().addClass("valid"),a.parent().removeClass("invalid"),a.parent().find(".input_error").remove()):(a.parent().addClass("invalid"),a.parent().removeClass("valid"),void 0!==a.attr("data-errormessage")&&0==a.parent().find(".input_error").length&&t&&a.parent().append('<div class="input_error">'+a.attr("data-errormessage")+"</div>")),!1;if(new RegExp(a.attr("data-regex").toString()).test(a.val())?(a.parent().removeClass("invalid"),a.parent().addClass("valid"),a.parent().find(".input_error").length>0&&a.parent().find(".input_error").remove(),$('[data-checkinput="'+a.attr("id")+'"]').length>0&&$('[data-checkinput="'+a.attr("id")+'"] .check').addClass("checked")):(void 0!==a.attr("data-errormessage")&&0==a.parent().find(".input_error").length&&t&&a.parent().append('<div class="input_error">'+a.attr("data-errormessage")+"</div>"),a.parent().addClass("invalid"),a.parent().removeClass("valid")),$('[data-checkinput="'+a.attr("id")+'"]').length>0){if($('[data-checkinput="'+a.attr("id")+'"] .check').removeClass("checked"),$('[data-checkinput="'+a.attr("id")+'"] .check_hash').length>0&&-1!==a.val().indexOf("#")?$('[data-checkinput="'+a.attr("id")+'"] .check_hash').addClass("checked"):$('[data-checkinput="'+a.attr("id")+'"] .check_hash').removeClass("checked"),$('[data-checkinput="'+a.attr("id")+'"] .check_arobase').length>0&&-1!==a.val().indexOf("@")?$('[data-checkinput="'+a.attr("id")+'"] .check_arobase').addClass("checked"):$('[data-checkinput="'+a.attr("id")+'"] .check_arobase').removeClass("checked"),$('[data-checkinput="'+a.attr("id")+'"] .check_dot').length>0&&-1!==a.val().indexOf(".")?$('[data-checkinput="'+a.attr("id")+'"] .check_dot').addClass("checked"):$('[data-checkinput="'+a.attr("id")+'"] .check_dot').removeClass("checked"),$('[data-checkinput="'+a.attr("id")+'"] .check_length').length>0&&a.val().length>=a.attr("minlength")?$('[data-checkinput="'+a.attr("id")+'"] .check_length').addClass("checked"):$('[data-checkinput="'+a.attr("id")+'"] .check_length').removeClass("checked"),$('[data-checkinput="'+a.attr("id")+'"] .check_capital').length>0){new RegExp("[A-Z]+","g").test(a.val())?$('[data-checkinput="'+a.attr("id")+'"] .check_capital').addClass("checked"):$('[data-checkinput="'+a.attr("id")+'"] .check_capital').removeClass("checked")}if($('[data-checkinput="'+a.attr("id")+'"] .check_number').length>0){new RegExp("[0-9]+","g").test(a.val())?$('[data-checkinput="'+a.attr("id")+'"] .check_number').addClass("checked"):$('[data-checkinput="'+a.attr("id")+'"] .check_number').removeClass("checked")}}}else if(void 0!==a.attr("minlength")){var i=a.attr("minlength");a.val().length<i?(a.parent().addClass("invalid"),a.parent().removeClass("valid")):(a.parent().addClass("valid"),a.parent().removeClass("invalid"))}else a.parent().addClass("valid"),a.parent().removeClass("invalid");e.validform()},this.validform=function(a){$.each($(this.target).find("form"),function(a,e){var i=!0,n=$(this);$.each(n.find("input"),function(a,t){$(this).attr("required")&&("checkbox"===$(this).attr("type")?$(this).is(":checked")?$('[data-checkboxrelative="'+$(this).attr("id")+'"]').css("display","block"):($('[data-checkboxrelative="'+$(this).attr("id")+'"]').css("display","none"),i=!1):"radio"===$(this).attr("type")||!$(this).parent().hasClass("valid")&&$(this).attr("required")&&(i=!1))}),i?(n.find('button[type="submit"], [data-action="submit"]').removeClass("btn-disabled"),t({form:n.attr("id"),status:"validated"})):(n.find('button[type="submit"], [data-action="submit"]').addClass("btn-disabled"),t({form:n.attr("id"),status:"invalid"}))})},this.validateEmail=function(a){return!!this.email_tester.test(a)},this.get_datas=function(){var t={};return $.each($(a).find("form").serializeArray(),function(a,e){t[e.name]=e.value}),$(a).find("input:checkbox, input:radio").map(function(){console.log(this),t[$(this).attr("name")]=$(this).is(":checked")}),$.each($(a).find(".array_list_inputs"),function(a,e){var e={};$.each($(this).find("input"),function(a,t){console.log();var i=$(this).attr("name"),n=$(this).val();"checkbox"!==$(this).attr("type")&&"radio"!==$(this).attr("type")||(n=$(this).is(":checked")),e[i]=n}),t[$(this).attr("data-name")]=e}),t}}function datepicker(a,t){this.years=[],this.month=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],this.days=[31,29,31,30,31,30,31,31,30,31,30,31],a.append(),$("#idkids_calendar").remove(),$("body").append('<div id="idkids_calendar" class="calendar"><div class="content"><div class="top_header">'+$('label[for="'+a.attr("id")+'"]').html()+'</div><div class="choices"><div class="selector"></div><div class="wrapper days"><ul class=""></ul></div><div class="wrapper months"><ul class=""></ul></div><div class="wrapper years"><ul class=""></ul></div></div><div class="bottom_footer"><div class="btn btn-lg btn-success" id="validate_and_close_calendar">Valider</div></div></div></div>'),$(".calendar .content").css({left:a.offset().left,top:a.offset().top-$("html, body").scrollTop()+40,width:a.width()}),parseInt($(".calendar .content").css("top").replace("px",""))+$(".calendar .content").outerHeight()>window.innerHeight&&$(".calendar .content").css("top",window.innerHeight-$(".calendar .content").outerHeight()),$("body").css("overflow","hidden");var e=0,i=this,n=2018,r=1890;a.attr("min")&&(r=new Date(a.attr("min")).getFullYear()),a.attr("max")&&(n=new Date(a.attr("max")).getFullYear());for(var s=n;s>r;s--)$(".calendar .years ul").append('<li data-index="'+e+'" data-value="'+s+'" class="'+(0==e?"selected":"")+'">'+s+"</li>"),e++;for(var s=0;s<this.month.length;s++)$(".calendar .months ul").append('<li data-index="'+s+'" data-value="'+(s+1<10?"0"+(s+1):s+1)+'" class="'+(0==s?"selected":"")+'">'+this.month[s]+"</li>");for(var s=1;s<32;s++)$(".calendar .days ul").append('<li data-index="'+(s-1)+'" data-value="'+(s<10?"0"+s:s)+'" class="'+(1==s?"selected":"")+'">'+(s<10?"0"+s:s)+"</li>");if(""!==a.val()){var d=new Date(a.val()),c=d.getFullYear(),l=d.getMonth(),o=d.getDate(),p=$('.calendar .wrapper.years [data-value="'+c+'"]').attr("data-index");$(".calendar .wrapper.days").scrollTop(40*(o-1)),$(".calendar .wrapper.months").scrollTop(40*l),$(".calendar .wrapper.years").scrollTop(40*p)}$.fn.scrollEnd=function(a,t){$(this).scroll(function(){var e=$(this);e.data("scrollTimeout")&&clearTimeout(e.data("scrollTimeout")),e.data("scrollTimeout",setTimeout(a,t))})},$(".calendar .wrapper.days").scrollEnd(function(a){var t=$(".calendar .wrapper.days"),e=Math.round(t.scrollTop()/40),n=40*e;t.find("li").removeClass("selected"),t.find("li").eq(e).addClass("selected"),t.animate({scrollTop:n},200),i.setDate()},500),$(".calendar .wrapper.months").scrollEnd(function(a){var t=$(".calendar .wrapper.months"),e=Math.round(t.scrollTop()/40),n=40*e;t.find("li").removeClass("selected"),t.find("li").eq(e).addClass("selected"),t.animate({scrollTop:n},200),i.setDate()},500),$(".calendar .wrapper.years").scrollEnd(function(a){var t=$(".calendar .wrapper.years"),e=Math.round(t.scrollTop()/40),n=40*e;t.find("li").removeClass("selected"),t.find("li").eq(e).addClass("selected"),t.animate({scrollTop:n},200),i.setDate()},500),$(".calendar .wrapper li").off("click").on("click",function(){$(this).parent().parent().animate({scrollTop:40*$(this).attr("data-index")},200)}),$("#validate_and_close_calendar").off("click").on("click",function(){i.setDate(),$("#idkids_calendar").remove(),$("body").css("overflow","scroll")}),this.setDate=function(){var t=$(".calendar .wrapper.days .selected").attr("data-value"),e=$(".calendar .wrapper.months .selected").attr("data-value"),n=$(".calendar .wrapper.years .selected").attr("data-value");console.log(i.days[parseInt(e)-1]),30===i.days[parseInt(e)-1]?($(".calendar .wrapper.days li").eq(30).addClass("disabled"),$(".calendar .wrapper.days li").eq(29).removeClass("disabled")):29===i.days[parseInt(e)-1]?($(".calendar .wrapper.days li").eq(29).addClass("disabled"),$(".calendar .wrapper.days li").eq(30).addClass("disabled")):$(".calendar .wrapper.days li").removeClass("disabled"),a.val(n+"-"+e+"-"+t),a.blur()}}function base64ToBlob(a,t){t=t||"";for(var e=window.atob(a),i=[],n=0,r=e.length;n<r;n+=1024){for(var s=e.slice(n,n+1024),d=new Array(s.length),c=0;c<s.length;c++)d[c]=s.charCodeAt(c);var l=new Uint8Array(d);i.push(l)}return new Blob(i,{type:t})}