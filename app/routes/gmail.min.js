function authorize(e,s){var t=e.installed.client_secret,i=e.installed.client_id,o=e.installed.redirect_uris[0],a=new googleAuth,r=new a.OAuth2(i,t,o);fs.readFile(TOKEN_PATH,function(e,t){e?getNewToken(r,s):(r.credentials=JSON.parse(t),s(r))})}function getNewToken(e,s){var t=e.generateAuthUrl({access_type:"offline",scope:SCOPES});console.log("Authorize this app by visiting this url: ",t);var i=readline.createInterface({input:process.stdin,output:process.stdout});i.question("Enter the code from that page here: ",function(t){i.close(),e.getToken(t,function(t,i){return t?void console.log("Error while trying to retrieve access token",t):(e.credentials=i,storeToken(i),void s(e))})})}function storeToken(e){try{fs.mkdirSync(TOKEN_DIR)}catch(s){if("EEXIST"!=s.code)throw s}fs.writeFile(TOKEN_PATH,JSON.stringify(e)),console.log("Token stored to "+TOKEN_PATH)}function listLabels(e){var s=google.gmail("v1");s.users.labels.list({auth:e,userId:"me"},function(e,s){if(e)return void console.log("The API returned an error: "+e);var t=s.labels;if(0==t.length)console.log("No labels found.");else{console.log("Labels:");for(var i=0;i<t.length;i++){var o=t[i];console.log("- %s",o.name)}}})}var express=require("express"),gmail=express.Router(),language_helper=require("../helpers/languages_helper"),uri_helper=require("../helpers/uri_helper"),auth_helper=require("../helpers/auth_helper"),lang=require("../public/languages/auth_lang"),machineId=require("node-machine-id"),Auth_model=require("../models/auth_model"),Members_model=require("../models/members_model"),Address_model=require("../models/address_model"),device_uid=machineId.machineIdSync({original:!0}),fs=require("fs"),readline=require("readline"),google=require("googleapis"),googleAuth=require("google-auth-library"),SCOPES=["https://www.googleapis.com/auth/gmail.readonly"],TOKEN_DIR=(process.env.HOME||process.env.HOMEPATH||process.env.USERPROFILE)+"/.credentials/",TOKEN_PATH=TOKEN_DIR+"gmail-nodejs-quickstart.json";gmail.use(function(e,s,t){s.setHeader("Access-Control-Allow-Origin","*"),s.setHeader("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),s.setHeader("Access-Control-Allow-Methods","GET, PUT, POST, DELETE"),s.setHeader("Content-Type","application/json");var i=e.query;("PUT"===e.method||"POST"===e.method||"DELETE"===e.method)&&(i=e.body),t()}),gmail.get("/",function(e,s,t){fs.readFile("client_secret.json",function(e,t){return e?(s.status(200).send({status:"error",err:e}).end(),void console.log("Error loading client secret file: "+e)):(s.status(200).send({status:"hello",content:t}).end(),void authorize(JSON.parse(t),listLabels))})}),module.exports=gmail;