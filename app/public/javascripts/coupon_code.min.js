$(function(){coupon_code.init()});
var coupon_code={init:function(){setTimeout(function(){coupon_code.create_coupon_form()},500)},create_coupon_form:function(){$("#coupon_code").off("blur, change, keyup").on("blur, change, keyup",function(a){3<=$("#coupon_code").val().length?($(".btn_coupon_code").prop("disabled",!1).html("&#10004;"),coupon_code.checkIt()):$(".btn_coupon_code").prop("disabled",!0).removeClass("error").html("&#10004;")});$("#coupon_code_form").off("submit").on("submit",function(a){a.preventDefault();a.stopPropagation();
coupon_code.checkIt()})},checkIt:function(){$(".btn_coupon_code").addClass("loading").html('<span class="loader"></span>');index.sdk.api.get("/coupon_code/valid",{code:$("#coupon_code").val().toUpperCase()},function(a){$(".coupon_datas").html("");if(0===a.datas.length)$(".btn_coupon_code").addClass("error").html("&#10008;");else{$(".coupon_datas").append('<div class="message">Ce code est valid pour t\u00e9l\u00e9charger :</div><ul class="coupon_list"></ul>');for(var b=0;b<a.datas.length;b++)"chansonspersonnalisees"===
a.datas[b].offer?a.datas[b].already_used?$(".coupon_list").append("<li> Coupon d\u00e9j\u00e0 utilis\u00e9</li>"):0===$('[data-offer="'+a.datas[b].offer+'"]').length&&$(".coupon_list").append('<li data-offer="'+a.datas[b].offer+'">'+a.datas[b].label+"<br>"+a.datas[b].description+'<br><a href="http://machanson.joyvox.fr">choisir une chanson personnalis\u00e9e</a></li>'):0===$('[data-offer="'+a.datas[b].offer+'"]').length&&$(".coupon_list").append('<li class="buyWithCoupon" data-offer="'+a.datas[b].offer+
'" data-productid="'+a.datas[b].product_id+'"  data-couponcode="'+a.datas[b].code+'"  data-couponid="'+a.datas[b]._id+'" data-amount="'+a.datas[b].amount+'">'+a.datas[b].label+"<br>"+a.datas[b].description+'<br><a href="/download">t\u00e9l\u00e9charger '+a.datas[b].label+"</a></li>"),$(".btn_coupon_code").removeClass("error").html("&#10004;")}$(".buyWithCoupon").off("click").on("click",function(){alert($(this).attr("data-productid")+$(this).attr("data-couponcode")+$(this).attr("data-couponid")+$(this).attr("data-amount"))})},
function(a){console.log(a)})},buyProductWithCoupon:function(a,b,c,d){index.sdk.api.post("/orders/buy_product_with_coupon_code",{product_id:a,coupon_code:b,coupon_id:c,amount:d},function(a){})}};
