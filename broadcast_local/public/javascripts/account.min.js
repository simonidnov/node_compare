"use strict";$(function(){account.init()});var account={user:null,sdk:null,init:function(){this.sdk=new idkids_jssdk({secret:"000-000-000",callback_url:"http://localhost:3000/account/",authorisation:{basket:!0,friends:!0,profile:!0,members:!0,email:!0,mobile:!0,address:!0,badges:!0,newsletter:!0,wallet:!0,loyalty_card:!0}},function(e,t){console.log(e,t)}),this.sdk.init(function(e){console.log("init status ",e)}),this.sdk.getLoginStatus(function(e){console.log("getLoginStatus ::: ",e),QRCode.toCanvas(document.getElementById("canvas"),e.id,function(e){e&&console.error(e),console.log("success!")})}),this.sdk.createAuthbutton("account_infos",function(){})}},idkids_jssdk=function(e,t){this.options=e,this.callback=t,this.inited=!1,this.api={user:null,options:null,get:function(e,t,s){this.save_account(),s(e,t)},post:function(e,t,s){},put:function(e,t,s){},"delete":function(e,t,s){},get_user_status:function(){return this.set_user(),null===this.user?{status:"not_connected",infos:"call api.get('me')"}:{status:"logged",token:this.user.token,id:this.user.id,device:this.user.device}},get_params:function(){},add_params:function(){var e=this.options;return e.from_origin=window.location.origin,e.user_token=this.user.token,e.user_id=this.user._id,e.user_secret=this.user.secret,e.user_device=this.user.current_device,e},reset_user:function(e){var t=new URL(window.location.href),s=t.searchParams.get("idkids-token");if(null!==s){var a={token:t.searchParams.get("idkids-token"),id:t.searchParams.get("idkids-id"),device:t.searchParams.get("idkids-device")};window.localStorage.setItem("idkids_local_user",JSON.stringify(a)),this.set_user(),e(a)}},set_user:function(){try{this.user=JSON.parse(window.localStorage.getItem("idkids_local_user"))}catch(e){console.log("error ::: ",e)}}},this.api.options=e,this.init=function(e){if(null!==document.getElementById("idkids-dsk"))return!0;var t=document.createElement("div");t.id="idkids-dsk",this.api.reset_user(function(e){console.log("reset user ",e)}),e({status:"inited"}),this.inited=!0},this.getLoginStatus=function(e){e(this.api.get_user_status())},this.createAuthbutton=function(e,t){null===document.getElementById(e)?t({status:"error",message:"TARGET_ID_TAG_ELEMENT_NOT_FOUND"}):document.getElementById(e).innerHTML='<div class="idkids-sdk"><a href="http://localhost:3000/auth?from='+window.location.origin.replace(new RegExp("/","g"),"R|")+"&redirect="+this.options.callback_url.replace(new RegExp("/","g"),"|")+"&secret="+this.options.secret+'" class="auth_button" data-action="login"><div class="avatar"></div><div class="label">CONNEXION</div></a></div>'},t({status:"sdk instance created"},this.options)};