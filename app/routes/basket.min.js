var express=require("express"),basket=express.Router(),Basket_controller=require("../controllers/basket_controller"),Userproducts_controller=require("../controllers/userproducts_controller");Auth_helper=require("../helpers/auth_helper"),language_helper=require("../helpers/languages_helper"),uri_helper=require("../helpers/uri_helper"),lang=require("../public/languages/auth_lang"),basket.use(function(t,e,s){e.setHeader("Access-Control-Allow-Origin","*"),e.setHeader("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),e.setHeader("Access-Control-Allow-Methods","GET, PUT, POST, DELETE"),Auth_helper.validate_admin(t,function(e){200===e.status?(t.body.isAdmin=!0,t.query.isAdmin=!0):(t.body.isAdmin=!1,t.query.isAdmin=!1)});var o=t.query;"PUT"!==t.method&&"POST"!==t.method&&"DELETE"!==t.method||(o=t.body),Auth_helper.validate_user(o,t.get("host"),function(t){200===t.status?s():e.status(t.status).send(t)})}),basket.get("/",function(t,e,s){Basket_controller.get(t,e,function(t){e.status(t.status).send(t.datas)})}).get("/amount",function(t,e,s){Basket_controller.getAmount(t,e,function(t){e.status(t.status).send(t.datas)})}).post("/",function(t,e,s){console.log("BEFORE Userproducts_controller.allreadyBuy ",t.body),void 0!==t.body.data&&(t.body=t.body.data),Userproducts_controller.allreadyBuy(t.body.options.user_id,t.body.product_id,function(o){console.log("Userproducts_controller.allreadyBuy ::::::::::: ",o,t.body.product_id),200===o.status?e.status(o.status).send({status:o.status,response_display:{title:"OUPS",message:"Vous avez déjà acheté ce produit, rendez-vous sur votre compte client pour le télécharger !",type:"modal",motion:{color:"blue",src:app.locals.settings.host+"/public/images/assets/account_1.svg"},buttons:[{class:"btn-success centered",label:"MON COMPTE",href:app.locals.settings.host+"/account/orders",target:"_blank",value:"/account/orders"}]}}):s()})},function(t,e,s){console.log("ADD BASKET ",t.body),Basket_controller.create(t.body.data,e,function(t){console.log("BASKET CREATE ",t),e.status(t.status).send({status:t.status,response_display:{title:"Ajouté",illus:{src:app.locals.settings.host+"/public/images/assets/basket.svg",color:"lightseagreen"},message:"Votre produit a bien été ajouté dans votre panier.",buttons:[{class:"btn-success centered",label:"MON PANIER",href:app.locals.settings.host+"/account/basket",target:"_blank",value:"/account/basket"}]}})})}).put("/",function(t,e,s){Basket_controller.update(t.body.data,e,function(t){e.status(t.status).send({status:t.status,infos:t.datas})})}).delete("/",function(t,e,s){Basket_controller.delete(t,e,function(t){e.status(t.status).send({status:t.status,infos:t.datas})})}),module.exports=basket;