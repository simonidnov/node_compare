var express=require("express"),checking_session=express.Router(),Auth_model=require("../models/auth_model"),auth_helper=require("../helpers/auth_helper"),language_helper=require("../helpers/languages_helper"),uri_helper=require("../helpers/uri_helper"),lang=require("../public/languages/auth_lang");
checking_session.use(function(a,b,c){b.setHeader("Access-Control-Allow-Origin","*");b.setHeader("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept");b.setHeader("Access-Control-Allow-Methods","GET, PUT, POST, DELETE");c()});
checking_session.get("/",function(a,b,c){"undefined"!==typeof a.query._id&&"undefined"!==typeof a.query.secret&&"undefined"!==typeof a.query.token?"undefined"===a.query._id?(b.redirect(307,"/auth"),b.end()):Auth_model.checking_session(a,a.query._id,function(a){console.log("checking session ",a);"undefined"!==typeof a.datas&&null!==a.datas?(console.log("checking session datas ",null!==a.datas),b.redirect(307,"/account?idkids-token="+a.datas.token+"&idkids-id="+a.datas._id+"&idkids-device="+a.datas.current_device)):
b.redirect(307,"/auth");b.end()}):(b.render("auth/checking_session",{}),b.end())});module.exports=checking_session;
