const db=require("mongoose"),config=require("../config/config"),address_datas={user_id:{type:"string"},label:{type:"string"},first_name:{type:"string"},last_name:{type:"string"},AddressLine1:{type:"string"},AddressLine2:{type:"string"},AddressLine3:{type:"string"},city:{type:"string"},country:{type:"string"},country_code:{type:"string"},cp:{type:"string"},cp_id:{type:"string"},phone:{type:"string"},uniq_encoder:{type:"string"},geocoder:{latitude:{type:"string"},longitude:{type:"string"},country:{type:"string"},countryCode:{type:"string"},city:{type:"string"},zipcode:{type:"string"},streetName:{type:"string"},streetNumber:{type:"string"},administrativeLevels:{level1long:{type:"string"},level1short:{type:"string"},level2long:{type:"string"},level2short:{type:"string"}},provider:{type:"string"}}},NodeGeocoder=require("node-geocoder"),options={provider:"google",httpAdapter:"https",apiKey:"AIzaSyB_MlYEDlRnNWYtrn-y63pbjrWecYaocqs",formatter:null},geocoder=NodeGeocoder(options);0===db.connection.readyState&&db.connect(config.database.users,{useMongoClient:!0});const addressSchemas=new db.Schema(address_datas),Address=db.model("Address",addressSchemas);module.exports={attributes:address_datas},module.exports.get=function(e,s,t){var o={};null!==e&&(o.user_id=e),null!==s&&(o.address_id=s),Address.find(o,function(e,s){t(e?{status:405,datas:e}:{status:200,datas:s})})},module.exports.create=function(e,s,t){s.user_id=e,geocoder.geocode(s.AddressLine1+" "+s.AddressLine2+" "+s.AddressLine3+" "+s.cp+" "+s.city+" "+s.country).then(function(e){new_address=new Address(s),new_address.save(function(e,s){t(e?{status:405,message:e}:{status:200,datas:s})})})["catch"](function(e){console.log("-------- geocoder ERROR ---------"),console.log("-------- geocoder ERROR ---------"),console.log("-------- geocoder ERROR ---------"),console.log(e),console.log("-------- geocoder ERROR ---------"),console.log("-------- geocoder ERROR ---------"),console.log("-------- geocoder ERROR ---------"),new_address=new Address(s),new_address.save(function(e,s){t(e?{status:405,message:e}:{status:200,datas:s})})})},module.exports.update=function(e,s,t,o){Address.updateOne({user_id:e,_id:s},{$set:t},function(e,s){o(e?{status:405,message:e}:{status:200,user:s})})},module.exports["delete"]=function(e,s,t){Address.deleteOne({user_id:e,_id:s},function(e,s){t(e?{status:405,message:e}:{status:200,user:s})})};