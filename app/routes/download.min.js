var express=require("express"),download=express.Router(),fs=require("fs"),path=require("path"),mime=require("mime"),Userproducts_controller=require("../controllers/userproducts_controller"),auth_helper=require("../helpers/auth_helper"),language_helper=require("../helpers/languages_helper"),uri_helper=require("../helpers/uri_helper"),lang=require("../public/languages/auth_lang");
download.use(function(b,c,d){c.setHeader("Access-Control-Allow-Origin","*");c.setHeader("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept");c.setHeader("Access-Control-Allow-Methods","GET, PUT, POST, DELETE");var a=b.query;if("PUT"===b.method||"POST"===b.method||"DELETE"===b.method)a=b.body;auth_helper.validate_user(a,b.get("host"),function(a){if(200===a.status)"undefined"!==typeof a.updated_token&&(b.query.updated_token=a.updated_token),d();else return c.status(a.status).send(a),
!1})});
download.get("/",function(b,c,d){Userproducts_controller.get(b,c,function(a){200===a.status?1<=a.datas.length?c.download(__dirname+"/../"+a.datas[0].meta_datas.medias[0][0].path,a.datas[0].meta_datas.label+"_"+a.datas[0].meta_datas.extra_category+"_"+a.datas[0].meta_datas.sub_category+"_joyvox.mp3"):c.status(201).send({status:201,message:"NOT_ALLOWED",response_display:{title:"T\u00e9l\u00e9chargement",message:"Vous n'avez pas les droits pour t\u00e9l\u00e9chrger ce fichier."}}):c.status(201).send({status:201,message:"NOT_ALLOWED",
response_display:{title:"T\u00e9l\u00e9chargement",message:"Vous n'avez pas les droits pour t\u00e9l\u00e9chrger ce fichier."}})})});module.exports=download;
