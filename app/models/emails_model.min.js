var db=require("mongoose"),emailing=require("express")(),path=require("path"),config=require("../config/config"),mailer=require("express-mailer"),email_datas={user_id:{type:"string"},email:{type:"string"},created:{type:"Date","default":Date.now},sended:{type:"Date","default":Date.now},updated:{type:"Date","default":Date.now},content:{type:"string"}};mailer.extend(emailing,config.emailing);emailing.set("views",path.join(__dirname,"../views"));emailing.set("view engine","pug");
0===db.connection.readyState&&db.connect(config.database.users,{useMongoClient:!0});var emailSchemas=new db.Schema(email_datas),Email=db.model("Emails",emailSchemas);module.exports={attributes:email_datas};
module.exports.send=function(a,c,b,d){data={user_id:c,email:b.email,content:a};new_email=new Email(data);new_email.save(function(b,a){b?d({status:405,message:"error email sending impossible"}):console.log("success entry")});emailing.mailer.send(a,b,function(a,c){a?d({status:405,response_display:{message:"Email ERROR",type:"modal"},err:a,datas:b,config:config}):d({status:200,response_display:{message:"Email SENDED",type:"toast"},datas:b,infos:c})})};
