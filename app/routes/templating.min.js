var express=require("express"),_und=require("underscore"),templating=express.Router(),Auth_controller=require("../controllers/auth_controller"),Basket_controller=require("../controllers/basket_controller"),Basket_model=require("../models/basket_model"),language_helper=require("../helpers/languages_helper"),uri_helper=require("../helpers/uri_helper"),lang=require("../public/languages/auth_lang"),machineId=require("node-machine-id"),device_uid=machineId.machineIdSync({original:!0});
templating.use(function(a,b,c){b.setHeader("Access-Control-Allow-Origin","*");b.setHeader("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept, authorization");b.setHeader("Access-Control-Allow-Methods","GET,POST,DELETE,PUT,OPTIONS");c()});
templating.get("/:template",function(a,b,c){a.datas_set={locale:language_helper.getlocale(a),lang:lang,query:a.query,_:_und};switch(a.params.template){case "notif_button":"undefined"!==typeof a.query.user?Basket_model.get({user_id:a.query.user._id},a,function(b){a.datas_set.basket=b.datas;c()}):c();break;case "auth_button":"undefined"!==typeof a.query.user?Auth_controller.getUserInfos(a,b,function(b){"undefined"!==typeof b.user&&(a.datas_set.user=b.user);c()}):c();break;default:"undefined"!==typeof a.session.Auth&&
(a.datas_set.user=a.session.Auth,"undefined"!==typeof a.query.member_id&&(a.datas_set.member=_und.where(a.datas_set.user.members,{_id:a.query.member_id})[0])),c()}},function(a,b,c){b.render("templates/"+a.params.template,a.datas_set);b.end()});module.exports=templating;
