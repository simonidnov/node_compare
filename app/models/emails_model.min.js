var db=require("mongoose"),emailing=require("express")(),path=require("path"),config=require("../config/config"),mailer=require("express-mailer"),email_datas={user_id:{type:"string"},email:{type:"string"},created:{type:"Date","default":Date.now},sended:{type:"Date","default":Date.now},updated:{type:"Date","default":Date.now},content:{type:"string"}};mailer.extend(emailing,config.emailing);emailing.set("views",path.join(__dirname,"../views"));emailing.set("view engine","pug");
0===db.connection.readyState&&db.connect(config.database.users,{useMongoClient:!0});var emailSchemas=new db.Schema(email_datas),Email=db.model("Emails",emailSchemas);module.exports={attributes:email_datas};
module.exports.send=function(b,c,a,d){data={user_id:c,email:a.email,content:b};new_email=new Email(data);new_email.save(function(a,b){a?console.log({status:405,message:"error saving sending impossible"}):console.log("success entry")});console.log("datas ",a);emailing.mailer.send(b,a,function(b,c){b?d({status:405,response_display:{message:"Email ERROR",type:"modal"},err:b,datas:a,config:config}):d({status:200,response_display:{message:"L'email \u00e0 bien \u00e9t\u00e9 envoy\u00e9",type:"modal"},datas:a,
infos:c})})};
