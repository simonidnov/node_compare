var express=require("express"),me=express.Router(),language_helper=require("../helpers/languages_helper"),uri_helper=require("../helpers/uri_helper"),auth_helper=require("../helpers/auth_helper"),lang=require("../public/languages/auth_lang"),machineId=require("node-machine-id"),Auth_model=require("../models/auth_model"),Members_model=require("../models/members_model"),Address_model=require("../models/address_model"),Userproducts_controller=require("../controllers/userproducts_controller"),device_uid=
null;
me.use(function(a,b,d){b.setHeader("Access-Control-Allow-Origin","*");b.setHeader("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept");b.setHeader("Access-Control-Allow-Methods","GET, PUT, POST, DELETE");b.setHeader("Content-Type","application/json");var c=a.query;if("PUT"===a.method||"POST"===a.method||"DELETE"===a.method)c=a.body;"undefined"!==typeof c.device_infos?device_uid=c.device_infos.device_uid:"undefined"!==typeof c.device_uid&&(device_uid=c.device_uid);auth_helper.validate_from(c,
a.get("origin"),function(e){e?-1===a.url.indexOf("/from")?auth_helper.validate_user(c,a.get("host"),function(c){if(200===c.status)"undefined"!==typeof c.updated_token&&(a.query.updated_token=c.updated_token),d();else return console.log("VALIDATE USER ",c),b.status(c.status).send(c),!1}):d():b.status(401).send({message:"your server was not authorised",secret:c.data,host:a.get("origin"),is_ok:""})})});
me.get("/",function(a,b,d){Auth_model.getPublicProfile(a.query.options.user_id,function(c){c.updated_token=a.query.updated_token;b.status(c.status).send(c).end()})}).post("/",function(a,b,d){b.send({message:"me post is under development redirect to /account/profile",updated_token:a.query.updated_token,host:a.get("host")});b.end()}).put("/",function(a,b,d){b.send({message:"me put is under development redirect to /account/profile",updated_token:a.query.updated_token,host:a.get("host")});b.end()})["delete"]("/",
function(a,b,d){b.send({message:"me delete is under development redirect to /account/profile",updated_token:a.query.updated_token,host:a.get("host")});b.end()}).get("/members",function(a,b,d){Members_model.get(a.query.options.user_id,null,function(c){c.updated_token=a.query.updated_token;b.status(c.status).send(Auth_helper.addParams(c,a));b.end()})}).post("/members",function(a,b,d){Members_model.create(a.body.data.options.user_id,a.body.data,function(c){Auth_model.reset_session(a,a.body.data.options.user_id,
function(){b.status(c.status).send(Auth_helper.addParams(c,a));b.end()})})}).put("/members",function(a,b,d){Members_model.update(a.body.options.user_id,a.body.member_id,a.body,function(c){Auth_model.reset_session(a,a.body.options.user_id,function(c){b.status(c.status).send(Auth_helper.addParams(c,a));b.end()})})})["delete"]("/members",function(a,b,d){Members_model["delete"](a.body.options.user_id,a.body.member_id,function(c){Auth_model.reset_session(a,a.body.options.user_id,function(){b.status(c.status).send(Auth_helper.addParams(c,
a));b.end()})})}).get("/friends",function(a,b,d){b.send({message:"friends get is under development",updated_token:a.query.updated_token,host:a.get("host")});b.end()}).post("/friends",function(a,b,d){b.send({message:"friends post is under development",updated_token:a.query.updated_token,host:a.get("host")});b.end()}).put("/friends",function(a,b,d){b.send({message:"friends put is under development",updated_token:a.query.updated_token,host:a.get("host")});b.end()})["delete"]("/friends",function(a,b,
d){b.send({message:"friends delete is under development",updated_token:a.query.updated_token,host:a.get("host")});b.end()}).get("/address",function(a,b,d){Address_model.get(a.query.options.user_id,null,function(a){b.status(a.status).send(Auth_helper.addParams(a));b.end()})}).post("/address",function(a,b,d){Address_model.create(a.body.options.user_id,a.body,function(c){Auth_model.reset_session(a,a.body.options.user_id,function(){b.status(c.status).send(Auth_helper.addParams(c));b.end()})})}).put("/address",
function(a,b,d){Address_model.update(a.body.options.user_id,a.body.address_id,a.body,function(c){Auth_model.reset_session(a,a.body.options.user_id,function(){b.status(c.status).send(Auth_helper.addParams(c,a));b.end()})})})["delete"]("/address",function(a,b,d){Address_model["delete"](a.body.options.user_id,a.body.address_id,function(c){Auth_model.reset_session(a,a.body.options.user_id,function(){b.status(c.status).send(Auth_helper.addParams(c,a));b.end()})})}).get("/services",function(a,b,d){Auth_model.getServices(a.query.options.user_id,
function(c){b.status(c.status).send(Auth_helper.addParams(c,a));b.end()})}).post("/services",function(a,b,d){b.send({message:"services post is under development redirect to /account/profile",updated_token:a.query.updated_token,host:a.get("host")});b.end()}).put("/services",function(a,b,d){b.send({message:"services put is under development redirect to /account/profile",updated_token:a.query.updated_token,host:a.get("host")});b.end()})["delete"]("/services",function(a,b,d){b.send({message:"services delete is under development redirect to /account/profile",
updated_token:a.query.updated_token,host:a.get("host")});b.end()}).get("/basket",function(a,b,d){b.send({message:"basket get is under development",updated_token:a.query.updated_token,host:a.get("host")});b.end()}).post("/basket",function(a,b,d){b.send({message:"basket post is under development",updated_token:a.query.updated_token,host:a.get("host")});b.end()}).put("/basket",function(a,b,d){b.send({message:"basket put is under development",updated_token:a.query.updated_token,host:a.get("host")});b.end()})["delete"]("/basket",
function(a,b,d){b.send({message:"basket delete is under development",updated_token:a.query.updated_token,host:a.get("host")});b.end()}).get("/orders",function(a,b,d){b.send({message:"basket get is under development",updated_token:a.query.updated_token,host:a.get("host")});b.end()}).post("/orders",function(a,b,d){b.send({message:"basket post is under development",updated_token:a.query.updated_token,host:a.get("host")});b.end()}).put("/orders",function(a,b,d){b.send({message:"basket put is under development",
updated_token:a.query.updated_token,host:a.get("host")});b.end()})["delete"]("/orders",function(a,b,d){b.send({message:"basket delete is under development",updated_token:a.query.updated_token,host:a.get("host")});b.end()}).get("/notifications",function(a,b,d){b.send({message:"notifications get is under development",updated_token:a.query.updated_token,host:a.get("host")});b.end()}).post("/notifications",function(a,b,d){b.send({message:"notifications post is under development",updated_token:a.query.updated_token,
host:a.get("host")});b.end()}).put("/notifications",function(a,b,d){b.send({message:"notifications put is under development",updated_token:a.query.updated_token,host:a.get("host")});b.end()})["delete"]("/notifications",function(a,b,d){b.send({message:"notifications delete is under development",updated_token:a.query.updated_token,host:a.get("host")});b.end()}).get("/products",function(a,b,d){Userproducts_controller.get(a,b,function(c){b.status(200).send(Auth_helper.addParams(c,a));b.end()})}).get("/from",
function(a,b,d){b.status(200).send(Auth_helper.addParams({status:"me from callback",origin:a.get("origin"),options:a.query.options.secret},a));b.end()});module.exports=me;
