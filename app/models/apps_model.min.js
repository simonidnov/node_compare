const db=require("mongoose"),config=require("../config/config"),jwt=require("jsonwebtoken"),apps_datas={icon:{type:"string"},logo:{type:"string"},splash:{type:"string"},color:{type:"string"},label:{type:"string"},name:{type:"string",unique:!0},short_name:{type:"string"},bundle:{type:"string",unique:!0},description:{type:"string"},short_desc:{type:"string"},host:{type:"string"},aliases:{type:"Array"},redirect_url:{type:"string"},tags:{type:"Array"},secret:{type:"string"},token:{type:"string"},authorizations:{user_public:{type:"boolean"},user_private:{type:"boolean"}},certificats:{apple:{type:"string"},android:{type:"string"},osx:{type:"string"},windows:{type:"string"}},terms_url:{type:"String"},created:{type:"Date","default":Date.now},updated:{type:"Date","default":Date.now}};0===db.connection.readyState&&db.connect(config.database.users,{useMongoClient:!0});const appsSchemas=new db.Schema(apps_datas),Apps=db.model("Apps",appsSchemas);module.exports={attributes:apps_datas},module.exports.get=function(e,a,t){var s={};Apps.find(s,function(e,a){t(e?{status:405,datas:e}:{status:200,datas:a})})},module.exports.create=function(e,a,t){a.secret=jwt.sign({secret:e},config.secrets.global.secret),a.token=jwt.sign({secret:e+Date.now()},config.secrets.global.secret),new_apps=new Apps(a),new_apps.save(function(e,a){t(e?{status:405,message:e}:{status:200,datas:a})})},module.exports.update=function(e,a,t,s){delete t.options,delete t._id,t.updated=Date.now(),Apps.updateOne({_id:a},{$set:t},function(e,a){s(e?{status:405,message:e}:{status:200,apps:a})})},module.exports["delete"]=function(e,a,t){Apps.deleteOne({_id:a},function(e,a){t(e?{status:405,message:e}:{status:200,apps:a})})};