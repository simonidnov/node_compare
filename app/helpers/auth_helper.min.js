const db=require("mongoose"),config=require("../config/config"),Auth_model=require("../models/auth_model"),Apps_model=require("../models/apps_model"),machineId=require("node-machine-id"),jwt=require("jsonwebtoken"),device_uid=machineId.machineIdSync({original:!0});module.exports={validate_from:function(s,e,o){return console.log("?????????????????????????????????????????? VALIDATE FROM ?????????????????????????????????????????"),void 0===s.options?(o(!1),!1):void 0===s.options.secret?(o(!1),!1):"http://localhost:3000"===s.options.from_origin||-1!==e||s.options.from_origin===app.locals.settings.host?(o(!0),!0):void Apps_model.validate(s.options.secret,e,function(s){o(0===s.datas.length?!1:!0)})},validate_origin:function(s,e,o){console.log("?????????????????????????????????????????? VALIDATE ORIGIN ?????????????????????????????????????????"),Apps_model.validate(s.options.secret,e,function(s){o(0===s.datas.length?!1:s.datas[0])})},validate_user:function(s,e,o){return console.log("?????????????????????????????????????????? VALIDATE USER ?????????????????????????????????????????"),void 0===s.options.user_id?(o({status:401,message:"UNAUTHARISED need valid user ID"}),!1):void 0===s.options.user_secret?(o({status:401,message:"UNAUTHARISED need valid user secret"}),!1):void 0===s.options.user_token?(o({status:401,message:"UNAUTHARISED need valid user token"}),!1):(s.options.device_uid=device_uid,void Auth_model.check_user(s,function(s){return o(s),!0}))},validate_session:function(s,e){console.log("?????????????????????????????????????????? VALIDATE SESSION ?????????????????????????????????????????"),void 0===s.session.Auth?(console.log("WHAT THE FCK"),e({status:401,message:"UNAUTHAURIZED"})):(console.log("GREAT SESSION"),e({status:200,message:"AUTHAURIZED"}))},validate_admin:function(s,e){console.log("?????????????????????????????????????????? VALIDATE ADMIN ?????????????????????????????????????????"),console.log("validate admin ",s.session.Auth.rights),void 0===s.session.Auth.rights?(console.log("not admin"),e({status:401,message:"UNAUTHAURIZED"})):"RWO"===s.session.Auth.rights.type?(console.log("IS ADMIN TRUE"),e({status:200,message:"AUTHAURIZED"})):(console.log("not admin"),e({status:401,message:"UNAUTHAURIZED"}))},check_session:function(s,e,o){console.log("?????????????????????????????????????????? CHECK SESSION ?????????????????????????????????????????"),Auth_model.reset_session(s,e,o)},has_media_right:function(s,e){if(console.log("?????????????????????????????????????????? HAS MEDIA RIGHT ?????????????????????????????????????????"),void 0===s.session.Auth||void 0===s.session.Auth.rights)e({status:401,message:"UNAUTHAURIZED"});else switch(s.session.Auth.rights.type){case"RWO":case"RW":e({status:200,message:"AUTHAURIZED"});break;default:e({status:401,message:"UNAUTHAURIZED"})}}};