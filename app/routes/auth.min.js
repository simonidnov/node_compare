var express=require("express"),auth=express.Router(),Auth_controller=require("../controllers/auth_controller"),language_helper=require("../helpers/languages_helper"),uri_helper=require("../helpers/uri_helper"),lang=require("../public/languages/auth_lang"),machineId=require("node-machine-id"),device_uid=machineId.machineIdSync({original:!0});auth.get("/",function(e,s,t){Auth_controller.login(e,e.query,function(t){var i={title:"Mon compte",datas:e.query,locale:language_helper.getlocale(),lang:lang,uri_params:uri_helper.get_params(e),response:t,js:["/public/javascripts/login.js","/public/javascripts/components/formular.js"],css:["/public/stylesheets/components/formular.css","/public/stylesheets/auth.css"]};i.user_session=e.session.Auth,"undefined"!=typeof t.user&&s.redirect(307,"/account?idkids-token="+t.user.token+"&idkids-id="+t.user._id+"&idkids-device="+t.user.current_device),s.render("auth/login",i)})}).get("/google/callback",function(e,s,t){}).get("/facebook/callback",function(e,s,t){}).get("/twitter/callback",function(e,s,t){}).post("/login",function(e,s,t){Auth_controller.register(e,function(t){"undefined"!=typeof t.user&&s.redirect(307,"/account/?idkids-token="+t.user.token+"&idkids-id="+t.user._id+"&idkids-device="+t.user.current_device);var r={title:"Mon compte",datas:e.query,locale:language_helper.getlocale(),lang:lang,uri_params:uri_helper.get_params(e),response:t,js:["/public/javascripts/login.js","/public/javascripts/components/formular.js"],css:["/public/stylesheets/components/formular.css","/public/stylesheets/auth.css"]};s.render("auth/login",r)})}).put("/login",function(e,s,t){Auth_controller.update(e,s,function(){s.send("login put params")})})["delete"]("/login",function(e,s,t){Auth_controller.unregister(e,s,function(){s.send("login delete params")})}).get("/:form_name/*",function(e,s,t){Auth_controller.login(e,e.query,function(t){var i={title:"Mon compte",datas:e.query,response:t,locale:language_helper.getlocale(),lang:lang,uri_params:uri_helper.get_params(e),form:e.params.form_name,js:["/public/javascripts/login.js","/public/javascripts/components/formular.js"],css:["/public/stylesheets/components/formular.css","/public/stylesheets/auth.css"]};"undefined"!=typeof t.idkids_user&&s.redirect(307,"/account?idkids-token="+t.idkids_user.datas.token+"&idkids-id="+t.idkids_user.datas._id+"&idkids-device="+t.idkids_user.datas.current_device+"&idkids-secret="+t.idkids_user.datas.secret),s.render("auth/login",i)})})["delete"]("/device",function(e,s,t){Auth_controller.delete_device(e,s,function(e){s.send(e)})}).get("/logout",function(e,s,t){console.log(e.headers.referer),Auth_controller.logout(e,s,function(t,i){s.redirect(307,e.headers.referer)})}).get("/account",function(e,s,t){s.render("account",{title:"account auth page"})}),module.exports=auth;