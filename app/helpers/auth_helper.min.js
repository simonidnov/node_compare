const db=require("mongoose"),config=require("../config/config"),Auth_model=require("../models/auth_model"),Apps_model=require("../models/apps_model"),machineId=require("node-machine-id"),jwt=require("jsonwebtoken"),device_uid=machineId.machineIdSync({original:true});module.exports={validate_from:function(b,a,c){if(typeof b.options==="undefined"){c(false);return false}if(typeof b.options.secret==="undefined"||typeof b.options.from_origin==="undefined"){c(false);return false}if(b.options.from_origin==="localhost:3000"||b.options.from_origin.indexOf("idkids-app.com")!==-1){c(true);return true}Apps_model.validate(b.options.secret,b.options.from_origin,function(d){if(d.datas.length===0){c(false)}else{c(true)}})},validate_user:function(b,a,c){if(typeof b.options.user_id==="undefined"){c({status:401,message:"UNAUTHARISED need valid user ID"});return false}if(typeof b.options.user_secret==="undefined"){c({status:401,message:"UNAUTHARISED need valid user secret"});return false}if(typeof b.options.user_token==="undefined"){c({status:401,message:"UNAUTHARISED need valid user token"});return false}db.connect(config.database.users,{useMongoClient:true});b.options.device_uid=device_uid;Auth_model.check_user(b,function(d){c(d);return true})},validate_session:function(a,b){if(typeof a.session.Auth==="undefined"){b({status:401,message:"UNAUTHAURIZED"})}else{b({status:200,message:"AUTHAURIZED"})}},validate_admin:function(a,b){if(typeof a.session.Auth.rights==="undefined"){b({status:401,message:"UNAUTHAURIZED"})}else{b({status:200,message:"AUTHAURIZED"})}},check_session:function(b,a,c){Auth_model.reset_session(b,a,c)}};