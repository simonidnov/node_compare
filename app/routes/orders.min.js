var express=require("express"),orders=express.Router(),Orders_controller=require("../controllers/orders_controller"),Auth_helper=require("../helpers/auth_helper"),language_helper=require("../helpers/languages_helper"),uri_helper=require("../helpers/uri_helper"),lang=require("../public/languages/auth_lang");
orders.use(function(c,a,d){a.setHeader("Access-Control-Allow-Origin","*");a.setHeader("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept");a.setHeader("Access-Control-Allow-Methods","GET, PUT, POST, DELETE");Auth_helper.validate_admin(c,function(a){200===a.status?(c.body.isAdmin=!0,c.query.isAdmin=!0):(c.body.isAdmin=!1,c.query.isAdmin=!1)});Auth_helper.validate_session(c,function(b){200===b.status?d():a.status(b.status).send(b.datas)})});
orders.get("/",function(c,a,d){Orders_controller.get(c,a,function(b){a.status(b.status).send(b.datas)})}).get("/transaction",function(c,a,d){a.render("order",{title:"User Account",user:c.session.Auth,locale:language_helper.getlocale(c),lang:lang,page:"transaction",js:["/public/javascripts/order.js","/public/javascripts/components/formular.js","/public/javascripts/components/popeye.js"],css:["/public/stylesheets/order.css","/public/stylesheets/ui.css","/public/stylesheets/components/formular.css"]});
a.end()}).get("/amount",function(c,a,d){Orders_controller.getAmount(c,a,function(b){a.status(b.status).send(b.datas)})}).post("/transaction",function(c,a,d){Orders_controller.createCharge(c,a,function(b){a.render("order",{title:"User Account",user:c.session.Auth,locale:language_helper.getlocale(c),lang:lang,page:"transaction",order_datas:b.datas,js:["/public/javascripts/order.js","/public/javascripts/components/formular.js","/public/javascripts/components/popeye.js"],css:["/public/stylesheets/order.css",
"/public/stylesheets/ui.css","/public/stylesheets/components/formular.css"]});a.end()})}).post("/",function(c,a,d){Orders_controller.create(c.body.data,a,function(b){200===b.status?a.status(b.status).send({status:b.status,response_display:{title:"Commande",message:"Votre commande est pr\u00eate \u00e0 \u00eatre r\u00e9gl\u00e9e.",buttons:["OK"]}}):a.status(b.status).send(b)})}).put("/",function(c,a,d){Orders_controller.update(c.body.data,a,function(b){a.status(b.status).send({status:b.status,infos:b.datas})})})["delete"]("/",
function(c,a,d){Orders_controller["delete"](c,a,function(b){a.status(b.status).send({status:b.status,infos:b.datas})})});module.exports=orders;
