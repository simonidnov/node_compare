var express=require("express"),orders=express.Router(),Orders_controller=require("../controllers/orders_controller"),Auth_helper=require("../helpers/auth_helper"),language_helper=require("../helpers/languages_helper"),uri_helper=require("../helpers/uri_helper"),lang=require("../public/languages/auth_lang");
orders.use(function(a,b,c){b.setHeader("Access-Control-Allow-Origin","*");b.setHeader("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept");b.setHeader("Access-Control-Allow-Methods","GET, PUT, POST, DELETE");Auth_helper.validate_admin(a,function(b){200===b.status?(a.body.isAdmin=!0,a.query.isAdmin=!0):(a.body.isAdmin=!1,a.query.isAdmin=!1)});var d=a.query;if("PUT"===a.method||"POST"===a.method||"DELETE"===a.method)d=a.body,"undefined"!==typeof a.body.data&&(d=a.body.data);
Auth_helper.validate_session(a,function(e){200===e.status?c():Auth_helper.validate_user(d,a.get("host"),function(a){200===a.status?c():b.status(a.status).send(a)})})});
orders.get("/",function(a,b,c){Orders_controller.get(a,b,function(a){b.status(a.status).send(a.datas)})}).get("/transaction",function(a,b,c){b.render("order",{title:"User Account",user:a.session.Auth,locale:language_helper.getlocale(a),lang:lang,page:"transaction",js:["/public/javascripts/order.js","/public/javascripts/components/formular.js","/public/javascripts/components/popeye.js"],css:["/public/stylesheets/order.css","/public/stylesheets/ui.css","/public/stylesheets/components/formular.css"]});
b.end()}).get("/amount",function(a,b,c){Orders_controller.getAmount(a,b,function(a){b.status(a.status).send(a.datas)})}).post("/transaction",function(a,b,c){Orders_controller.createCharge(a,b,function(d){b.render("order",{title:"User Account",user:a.session.Auth,locale:language_helper.getlocale(a),lang:lang,page:"transaction",order_datas:d.datas,js:["/public/javascripts/order.js","/public/javascripts/components/formular.js","/public/javascripts/components/popeye.js"],css:["/public/stylesheets/order.css",
"/public/stylesheets/ui.css","/public/stylesheets/components/formular.css"]});b.end()})}).post("/",function(a,b,c){Orders_controller.create(a.body.data,b,function(a){200===a.status?b.status(a.status).send({status:a.status,response_display:{title:"Commande",message:"Votre commande est pr\u00eate \u00e0 \u00eatre r\u00e9gl\u00e9e.",buttons:["OK"]}}):b.status(a.status).send(a)})}).put("/",function(a,b,c){Orders_controller.update(a.body.data,b,function(a){b.status(a.status).send({status:a.status,infos:a.datas})})})["delete"]("/",
function(a,b,c){Orders_controller["delete"](a,b,function(a){b.status(a.status).send({status:a.status,infos:a.datas})})}).post("/buy_product_with_coupon_code",function(a,b,c){Orders_controller.buy_with_coupon(a,b,function(a){b.status(a.status).send(a)})});module.exports=orders;
