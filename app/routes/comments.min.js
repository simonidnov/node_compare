var express=require("express"),comments=express.Router(),Comment_controller=require("../controllers/comments_controller"),Auth_helper=require("../helpers/auth_helper"),language_helper=require("../helpers/languages_helper"),uri_helper=require("../helpers/uri_helper"),lang=require("../public/languages/auth_lang");
comments.use(function(a,c,d){c.setHeader("Access-Control-Allow-Origin","*");c.setHeader("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept");c.setHeader("Access-Control-Allow-Methods","GET, PUT, POST, DELETE");Auth_helper.validate_admin(a,function(b){200===b.status?(a.body.isAdmin=!0,a.query.isAdmin=!0):(a.body.isAdmin=!1,a.query.isAdmin=!1)});var b=a.query;"PUT"===a.method||"POST"===a.method||"DELETE"===a.method?(b=a.body,Auth_helper.validate_user(b,a.get("host"),function(a){200===
a.status?d():c.status(a.status).send(a)})):d()});
comments.get("/",function(a,c,d){Comment_controller.get(a,c,function(b){c.status(b.status).send(Auth_helper.addParams(b.datas,a))})}).get("/stats",function(a,c,d){Comment_controller.getStats(a,c,function(b){c.status(b.status).send(Auth_helper.addParams(b.datas,a))})}).post("/",function(a,c,d){Comment_controller.create(a,c,function(b){console.log("POST COMMENT ",b);c.status(b.status).send(Auth_helper.addParams({status:b.status,datas:b.datas,response_display:{title:"COMMENTAIRE",message:"Votre commentaire a bien \u00e9t\u00e9 pris en compte et sera publi\u00e9 prochainement !<br>Merci !"}},
a))})}).put("/",function(a,c,d){Comment_controller.update(a,c,function(b){c.status(b.status).send(Auth_helper.addParams(b,a))})})["delete"]("/",function(a,c,d){Comment_controller["delete"](a,c,function(b){b.response_display={title:"COMMENTAIRE",message:"Votre commentaire a bien \u00e9t\u00e9 supprim\u00e9 !<br>Merci !"};c.status(b.status).send(Auth_helper.addParams(b,a))})});module.exports=comments;
