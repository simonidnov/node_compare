/*
 JavaScript Cookie v2.2.0
 https://github.com/js-cookie/js-cookie

 Copyright 2006, 2015 Klaus Hartl & Fagner Brack
 Released under the MIT license
*/
var idkids_jssdk=function(g,d){this.options=g;this.callback=d;this.inited=!1;-1===window.location.origin.indexOf("127.0.0.1")?g.is_debug=!1:g.is_debug=!0;this.logout=function(){this.api.store("idkids_local_user","");window.history.pushState({pageTitle:document.title},document.title,window.location.origin+window.location.pathname)};$("html, body, *").off("click").on("click",function(a){});this.api={user:null,parent:null,options:null,config:{url:"https://auth.joyvox.fr",debug_url:"http://127.0.0.1:3000"},
get:function(a,c,b,e,f){this.call("GET",a,c,b,e,f)},post:function(a,c,b,e,f){this.options.is_debug&&(this.config.url=this.config.debug_url);this.add_params(c,$.proxy(function(c){$.post(this.config.url+a,{Accept:"text/plain; charset=utf-8",method:"POST",xhrFields:{withCredentials:!1},contentType:"application/jsonp; charset=utf-8",dataType:"json",data:c}).done($.proxy(function(a){b(a)},this)).fail(function(a){"undefined"!==typeof e&&null!==e&&e(a)}).always($.proxy(function(a){"undefined"!==typeof f&&
null!==f&&f(a);this.hide_loader();this.check_response(a)},this))},this))},put:function(a,c,b,e,f){this.call("PUT",a,c,b,e,f)},deleting:function(a,c,b,e,f){this.call("DELETE",a,c,b,e,f)},call:function(a,c,b,e,f,g){this.options.is_debug&&(this.config.url=this.config.debug_url);this.show_loader();this.add_params(b,$.proxy(function(d){b=d;dataType="json";if("POST"===a||"PUT"===a||"DELETE"===a)dataType="json",b=JSON.stringify(b);jQuery.ajax(this.config.url+c,{method:a,contentType:"application/json",dataType:dataType,
data:b}).done($.proxy(function(a){"undefined"!==typeof a.updated_token&&(this.user.token=a.updated_token,this.store("idkids_local_user",this.user));e(a)},this)).fail(function(a){"undefined"!==typeof f&&null!==f&&f(a)}).always($.proxy(function(a){this.hide_loader();"undefined"!==typeof g&&null!==g&&g(a);this.check_response(a)},this))},this))},check_response:function(a){"undefined"!==typeof a.responseJSON&&(a=a.responseJSON);"undefined"!==typeof a.idkids_user&&this.store("idkids_local_user",{token:a.idkids_user.datas.token,
_id:a.idkids_user.datas._id,secret:a.idkids_user.datas.secret,device:a.idkids_user.datas.current_device});"undefined"!==typeof a.response_display&&(203===a.status?(d("logout"),this.store("idkids_local_user",""),"undefined"===typeof a.response_display.buttons&&(a.response_display.buttons=[{"class":"btn-success",label:"Me connecter",value:0,href:("undefined"!==typeof this.config.url?this.config.url:"")+"/auth?secret="+this.options.secret},{"class":"",label:"Cr\u00e9er un compte",value:1,href:("undefined"!==
typeof this.config.url?this.config.url:"")+"/auth/subscribe?secret="+this.options.secret}])):401===a.status&&(a.response_display.buttons=[{"class":"btn-success",label:"Me connecter",value:0,href:("undefined"!==typeof this.config.url?this.config.url:"")+"/auth?secret="+this.options.secret},{"class":"btn-warning",label:"Cr\u00e9er un compte",value:1,href:("undefined"!==typeof this.config.url?this.config.url:"")+"/auth/subscribe?secret="+this.options.secret}]),a.response_display.type="modal",(new popeye($("body"),
a.response_display,function(a){})).init())},get_user_status:function(){this.set_user();if(null===this.user||"undefined"===typeof this.user._id)return{status:"not_connected",infos:"call api.get('me')"};"undefined"!==typeof Unity&&Unity.call('{"status":"logged", "user":"'+JSON.stringify(this.user)+'", "token":"'+this.user.token+'", "id":"'+this.user.id+'", "device":"'+this.user.device+'"}');return{status:"logged",user:this.user,token:this.user.token,id:this.user.id,device:this.user.device}},get_params:function(){},
show_loader:function(){0===$(".idkids_jssdk.loader").length&&$("body").append('<div class="idkids_jssdk loader"><div class="centered"><svg version="1.1" id="Calque_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\t viewBox="0 0 256 256" style="enable-background:new 0 0 256 256;" xml:space="preserve"><style type="text/css">\t.st0{fill:none;stroke:#4F555A;stroke-width:28;stroke-miterlimit:10;}\t.st1{fill:#C93632;}</style><circle class="st0" cx="128" cy="128" r="53"/><circle class="st1" cx="128" cy="128" r="26"/></svg><span>Chargement</span></div></div>');
$(".idkids_jssdk.loader").addClass("showed").addClass("visible")},hide_loader:function(){setTimeout(function(){$(".idkids_jssdk.loader").removeClass("showed");setTimeout(function(){$(".idkids_jssdk.loader").removeClass("visible");$(".idkids_jssdk.loader").remove()},200)},100)},add_params:function(a,c){a.options=this.options;a.options.from_origin=window.location.origin;this.user&&(a.options.user_token=this.user.token,a.options.user_id=this.user._id,a.options.user_secret=this.user.secret,a.options.user_device=
this.user.current_device);this.get_device_uid(function(b){200!==b.status&&(a.need_fingerprint=!0);delete b.status;a.device_infos=b;c(a)})},reset_user:function(a){var c=new URL(window.location.href);if("undefined"!==typeof c.searchParams){var b=c.searchParams.get("idkids-token");null!==b&&""!==b&&"undefined"!==typeof b&&(b={token:c.searchParams.get("idkids-token"),_id:c.searchParams.get("idkids-id"),secret:c.searchParams.get("idkids-secret"),device:c.searchParams.get("idkids-device")},this.store("idkids_local_user",
b),this.set_user(),window.history.pushState({pageTitle:document.title},document.title,window.location.origin+window.location.pathname),a(b))}else c=getLocationParameters(window.location,"both"),b=c["idkids-token"],"undefined"!==typeof b&&null!==b&&"undefined"!==b&&(b={token:c["idkids-token"],_id:c["idkids-id"],secret:c["idkids-secret"],device:c["idkids-device"]},this.store("idkids_local_user",b),this.set_user(),window.history.pushState({pageTitle:document.title},document.title,window.location.origin+
window.location.pathname),a(b))},set_user:function(){this.getStore("idkids_local_user")},store:function(a,c){try{window.localStorage.setItem(a,JSON.stringify(c))}catch(b){Cookies.set(a,JSON.stringify(c),{expires:7})}},getStore:function(a){try{return"idkids_local_user"===a&&(this.user=JSON.parse(window.localStorage.getItem(a))),JSON.parse(window.localStorage.getItem(a))}catch(c){return"idkids_local_user"===a&&(this.user=JSON.parse(Cookies.get(a))),JSON.parse(JSON.parse(Cookies.get(a)))}},get_device_uid:function(a){$('[name="appCodeName"]').val(navigator.appCodeName);
$('[name="appName"]').val(navigator.appName);$('[name="appVersion"]').val(navigator.appVersion);$('[name="userAgent"]').val(navigator.userAgent);$('[name="vendor"]').val(navigator.vendor);"undefined"!==typeof Fingerprint2?(new Fingerprint2).get(function(c,b){$('[name="device_uid"]').val(c);a({status:200,device_uid:c})}):a({status:404,platform:navigator.platform,appCodeName:navigator.appCodeName,appName:navigator.appName,appVersion:navigator.appVersion,userAgent:navigator.userAgent,vendor:navigator.vendor})}};
this.api.parent=this;this.api.options=g;this.init=function(a){this.check_cookies();window.matchMedia("(display-mode: standalone)").matches&&console.log("Thank you for installing our app!");"undefined"===typeof Unity&&(Unity={call:function(a){var b=document.createElement("IFRAME");b.setAttribute("src","unity:"+a);document.documentElement.appendChild(b);document.documentElement.removeChild(b)}});this.api.get_device_uid(function(a){});this.api.reset_user(function(a){});this.api.get("/me/from",{secret:{}},
function(b){a(b)});var c=new URL(window.location.href);switch("undefined"!==typeof c.searchParams?c.searchParams.get("idkids-sdk-action"):getLocationParameters(window.location,"both")["idkids-sdk-action"]){case "logout":this.logout();break;default:console.log("IDKIDS SDK TOOLKIT has returned an action not defined in your javascript sdk version. please upgrade the latest version of idkids-js-sdk on your server then try again.")}this.reset_listeners()};this.isLogged=function(a){a(this.api.get_user_status())};
this.getPage=function(a,c,b){this.api.get(a,c,b,null,function(a){b(a)})};this.template=function(a,c,b){$.get(this.api.config.url+"/templating/"+a,c,function(a){b(a)})};this.createAuthbutton=function(a,c){null===document.getElementById(a)?c({status:"error",message:"TARGET_ID_TAG_ELEMENT_NOT_FOUND"}):this.template("auth_button",{user:this.api.user,options:this.options},function(b){document.getElementById(a).innerHTML=b;c({status:"success",message:"AUTH_BUTTON_CREATED"})})};this.createNotificationButton=
function(a,c){null===document.getElementById(a)?c({status:"error",message:"TARGET_ID_TAG_ELEMENT_NOT_FOUND"}):this.template("notif_button",{user:this.api.user,options:this.options},function(b){document.getElementById(a).innerHTML=b;c({status:"success",message:"AUTH_BUTTON_CREATED"})})};this.validInitedApp=function(a){this.api.get(this.api.config.url+"/api/apps/validate",{secret:this.options.secret},function(c){a(c)})};this.reset_listeners=function(){var a=this;$("[data-idkidssdk]").off("click").on("click",
function(c){switch($(this).attr("data-idkidssdk")){case "add_basket":a.api.post("/basket",{product_id:$(this).attr("data-productid"),quantity:$(this).attr("data-quantity"),url:window.location.href},function(b){200===b.status&&(b=parseInt($("#notifications .indice").html())+1,$("#notifications .indice").html(b),$("#total_basket").html("("+b+")"));a.callback({status:"ADD_BASKET"})});break;case "delete_basket_product":a.api.deleting("/basket",{basket_id:$(this).attr("data-basketid"),product_id:$(this).attr("data-productid")},
function(a){200===a.status&&window.location.reload()});break;default:console.log("action not reconized by idkids sdk, please upgrade your sdk version")}})};this.check_cookies=function(){var a=this.api.getStore("accept_cookies");console.log("ACCEPT COOKIES ",a);null===a&&($("body").append('<div class="idkids_cookies" id="idkids_cookies"><p>En poursuivant votre navigation sur ce site, vous acceptez l\u2019utilisation de cookies \u00e0 des fins de partage sur les r\u00e9seaux sociaux et de statistiques de visites, afin de b\u00e9n\u00e9ficier d\'une navigation et d\'offres personnalis\u00e9es \u00e0 vos besoins. Pour en savoir plus cliquez ici et pour param\u00e9trer les cookies <a href="https://auth.joyvox.fr/uses-of-cookies">cliquez ici.</a></p><div class="btn btn-danger centered" id="accept_cookies">J\'accepte</div></div>'),
$("#accept_cookies").on("click",$.proxy(function(a){this.api.store("accept_cookies",{status:"checked"});$("#idkids_cookies").remove()},this)))};this.connect=function(){window.location.href=this.api.config.url+"/auth?secret="+this.options.secret}};function decodeUriComponentWithSpace(g){return decodeURIComponent(g.replace(/\+/g,"%20"))}
function getLocationParameters(g,d){if("hash"!==d&&"search"!==d&&"both"!==d)throw'getLocationParameters expect argument 2 "type" to be "hash", "search" or "both"';var a="undefined"===typeof g.search?"":g.search.substr(1),c="undefined"===typeof g.hash?"":g.hash.substr(1),b=[];if("search"===d||"both"===d)b=b.concat(a.split("&"));if("hash"===d||"both"===d)b=b.concat(c.split("&"));for(var a={},e=0;e<b.length;e++)""!==b[e]&&(c=b[e].split("="),a[this.decodeUriComponentWithSpace(c[0])]=this.decodeUriComponentWithSpace(c[1]));
return a}
(function(g){var d=!1;"function"===typeof define&&define.amd&&(define(g),d=!0);"object"===typeof exports&&(module.exports=g(),d=!0);if(!d){var a=window.Cookies,c=window.Cookies=g();c.noConflict=function(){window.Cookies=a;return c}}})(function(){function g(){for(var a=0,c={};a<arguments.length;a++){var b=arguments[a],e;for(e in b)c[e]=b[e]}return c}function d(a){function c(b,e,f){var d;if("undefined"!==typeof document){if(1<arguments.length){f=g({path:"/"},c.defaults,f);if("number"===typeof f.expires){var k=new Date;
k.setMilliseconds(k.getMilliseconds()+864E5*f.expires);f.expires=k}f.expires=f.expires?f.expires.toUTCString():"";try{d=JSON.stringify(e),/^[\{\[]/.test(d)&&(e=d)}catch(n){}e=a.write?a.write(e,b):encodeURIComponent(String(e)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent);b=encodeURIComponent(String(b));b=b.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent);b=b.replace(/[\(\)]/g,escape);d="";for(var l in f)f[l]&&(d+="; "+l,!0!==f[l]&&(d+="="+f[l]));return document.cookie=
b+"="+e+d}b||(d={});l=document.cookie?document.cookie.split("; "):[];for(var p=/(%[0-9A-Z]{2})+/g,m=0;m<l.length;m++){var q=l[m].split("="),h=q.slice(1).join("=");this.json||'"'!==h.charAt(0)||(h=h.slice(1,-1));try{k=q[0].replace(p,decodeURIComponent);h=a.read?a.read(h,k):a(h,k)||h.replace(p,decodeURIComponent);if(this.json)try{h=JSON.parse(h)}catch(n){}if(b===k){d=h;break}b||(d[k]=h)}catch(n){}}return d}}c.set=c;c.get=function(a){return c.call(c,a)};c.getJSON=function(){return c.apply({json:!0},
[].slice.call(arguments))};c.defaults={};c.remove=function(a,d){c(a,"",g(d,{expires:-1}))};c.withConverter=d;return c}return d(function(){})});
