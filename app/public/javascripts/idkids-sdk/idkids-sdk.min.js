var idkids_jssdk=function(d,e){this.options=d;this.callback=e;this.inited=!1;-1===window.location.origin.indexOf("127.0.0.1")?d.is_debug=!1:d.is_debug=!0;this.api={user:null,options:null,config:{url:"https://www.idkids-app.com",debug_url:"http://127.0.0.1:3000"},get:function(a,b,c){this.call("GET",a,b,c)},post:function(a,b,c){this.options.is_debug&&(this.config.url=this.config.debug_url);this.add_params(b,$.proxy(function(b){$.post(this.config.url+a,{Accept:"text/plain; charset=utf-8",method:"POST",
xhrFields:{withCredentials:!1},contentType:"application/jsonp; charset=utf-8",dataType:"json",data:b}).done($.proxy(function(a){c(a)},this)).fail(function(a){console.log("fail ",a)}).always($.proxy(function(a){this.hide_loader();this.check_response(a)},this))},this));this.call("POST",a,b,c)},put:function(a,b,c){this.call("PUT",a,b,c)},deleting:function(a,b,c){this.call("DELETE",a,b,c)},call:function(a,b,c,d){this.options.is_debug&&(this.config.url=this.config.debug_url);this.show_loader();this.add_params(c,
$.proxy(function(e){c=e;dataType="json";if("POST"===a||"PUT"===a||"DELETE"===a)dataType="json",c=JSON.stringify(c);jQuery.ajax(this.config.url+b,{method:a,contentType:"application/json",dataType:dataType,data:c}).done($.proxy(function(a){"undefined"!==typeof a.updated_token&&(this.user.token=a.updated_token,this.store("idkids_local_user",this.user));d(a)},this)).fail(function(a){console.log("fail ",a)}).always($.proxy(function(a){this.hide_loader();this.check_response(a)},this))},this))},check_response:function(a){"undefined"!==
typeof a.response_display&&(a.response_display.type="modal",(new popeye($("body"),a.response_display,function(a){})).init())},get_user_status:function(){this.set_user();if(null===this.user||"undefined"===typeof this.user._id)return{status:"not_connected",infos:"call api.get('me')"};"undefined"!==typeof Unity&&Unity.call('{"status":"logged", "user":"'+JSON.stringify(this.user)+'", "token":"'+this.user.token+'", "id":"'+this.user.id+'", "device":"'+this.user.device+'"}');return{status:"logged",user:this.user,
token:this.user.token,id:this.user.id,device:this.user.device}},get_params:function(){},show_loader:function(){0===$(".idkids_jssdk.loader").length&&$("body").append('<div class="idkids_jssdk loader"><div class="centered"><svg version="1.1" id="Calque_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\t viewBox="0 0 256 256" style="enable-background:new 0 0 256 256;" xml:space="preserve"><style type="text/css">\t.st0{fill:none;stroke:#4F555A;stroke-width:28;stroke-miterlimit:10;}\t.st1{fill:#C93632;}</style><circle class="st0" cx="128" cy="128" r="53"/><circle class="st1" cx="128" cy="128" r="26"/></svg></div></div>');
setTimeout(function(){$(".idkids_jssdk.loader").addClass("showed")},200)},hide_loader:function(){$(".idkids_jssdk.loader").remove()},add_params:function(a,b){a.options=this.options;a.options.from_origin=window.location.origin;this.user&&(a.options.user_token=this.user.token,a.options.user_id=this.user._id,a.options.user_secret=this.user.secret,a.options.user_device=this.user.current_device);this.get_device_uid(function(c){200!==c.status&&(a.need_fingerprint=!0);delete c.status;a.device_infos=c;b(a)})},
reset_user:function(a){var b=new URL(window.location.href);null!==b.searchParams.get("idkids-token")&&(b={token:b.searchParams.get("idkids-token"),_id:b.searchParams.get("idkids-id"),secret:b.searchParams.get("idkids-secret"),device:b.searchParams.get("idkids-device")},this.store("idkids_local_user",b),this.set_user(),window.history.pushState({pageTitle:document.title},document.title,window.location.origin+window.location.pathname),a(b))},set_user:function(){this.getStore("idkids_local_user")},store:function(a,
b){try{window.localStorage.setItem(a,JSON.stringify(b))}catch(c){console.log("error ::: ",c)}},getStore:function(a){try{this.user=JSON.parse(window.localStorage.getItem(a))}catch(b){console.log("error ::: ",b)}},get_device_uid:function(a){$('[name="appCodeName"]').val(navigator.appCodeName);$('[name="appName"]').val(navigator.appName);$('[name="appVersion"]').val(navigator.appVersion);$('[name="userAgent"]').val(navigator.userAgent);$('[name="vendor"]').val(navigator.vendor);"undefined"!==typeof Fingerprint2?
(new Fingerprint2).get(function(b,c){$('[name="device_uid"]').val(b);a({status:200,device_uid:b})}):a({status:404,platform:navigator.platform,appCodeName:navigator.appCodeName,appName:navigator.appName,appVersion:navigator.appVersion,userAgent:navigator.userAgent,vendor:navigator.vendor})}};this.logout=function(){this.api.store("idkids_local_user","");window.location.href=window.location.origin+window.location.pathname};this.api.options=d;this.init=function(a){"undefined"===typeof Unity&&(Unity={call:function(a){var b=
document.createElement("IFRAME");b.setAttribute("src","unity:"+a);document.documentElement.appendChild(b);document.documentElement.removeChild(b)}});this.api.get_device_uid(function(a){console.log("device uid ",a)});this.api.reset_user(function(a){});this.api.get("/me/from",{secret:{}},function(b){a(b)});switch((new URL(window.location.href)).searchParams.get("idkids-sdk-action")){case "logout":this.logout();break;default:console.log("IDKIDS SDK TOOLKIT has returned an action not defined in your javascript sdk version. please upgrade the latest version of idkids-js-sdk on your server then try again.")}this.reset_listeners()};
this.isLogged=function(a){a(this.api.get_user_status())};this.template=function(a,b,c){$.get(this.api.config.url+"/templating/"+a,b,function(a){c(a)})};this.createAuthbutton=function(a,b){null===document.getElementById(a)?b({status:"error",message:"TARGET_ID_TAG_ELEMENT_NOT_FOUND"}):this.template("auth_button",{user:this.api.user,options:this.options},function(c){document.getElementById(a).innerHTML=c;b({status:"success",message:"AUTH_BUTTON_CREATED"})})};this.createNotificationButton=function(a,
b){null===document.getElementById(a)?b({status:"error",message:"TARGET_ID_TAG_ELEMENT_NOT_FOUND"}):this.template("notif_button",{user:this.api.user,options:this.options},function(c){document.getElementById(a).innerHTML=c;b({status:"success",message:"AUTH_BUTTON_CREATED"})})};this.validInitedApp=function(a){this.api.get(this.api.config.url+"/api/apps/validate",{secret:this.options.secret},function(b){a(b)})};this.reset_listeners=function(){var a=this;$("[data-idkidssdk]").off("click").on("click",function(b){switch($(this).attr("data-idkidssdk")){case "add_basket":a.api.post("/basket",
{product_id:$(this).attr("data-productid"),quantity:$(this).attr("data-quantity")},function(a){console.log("AJOUT AU PANIER AVEC SUCCES ? ",a)});break;default:console.log("action not reconized by idkids sdk, please upgrade your sdk version")}})}};
