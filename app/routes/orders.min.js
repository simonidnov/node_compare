var express=require("express"),orders=express.Router(),Orders_controller=require("../controllers/orders_controller"),Auth_helper=require("../helpers/auth_helper"),language_helper=require("../helpers/languages_helper"),uri_helper=require("../helpers/uri_helper"),lang=require("../public/languages/auth_lang");orders.use(function(e,s,t){s.setHeader("Access-Control-Allow-Origin","*"),s.setHeader("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),s.setHeader("Access-Control-Allow-Methods","GET, PUT, POST, DELETE"),Auth_helper.validate_admin(e,function(s){200===s.status?(e.body.isAdmin=!0,e.query.isAdmin=!0):(e.body.isAdmin=!1,e.query.isAdmin=!1)});var r=e.query;"PUT"!==e.method&&"POST"!==e.method&&"DELETE"!==e.method||(r=e.body,void 0!==e.body.data&&(r=e.body.data)),Auth_helper.validate_session(e,function(o){200===o.status?t():Auth_helper.validate_user(r,e.get("host"),function(e){200===e.status?t():s.status(e.status).send(e)})})}),orders.get("/",function(e,s,t){Orders_controller.get(e,s,function(e){s.status(e.status).send(e.datas)})}).get("/transaction",function(e,s,t){console.log("TRANSACTION"),s.render("order",{title:"User Account",user:e.session.Auth,locale:language_helper.getlocale(e),lang:lang,page:"transaction",js:["/public/javascripts/order.js","/public/javascripts/components/formular.js","/public/javascripts/components/popeye.js"],css:["/public/stylesheets/order.css","/public/stylesheets/ui.css","/public/stylesheets/components/formular.css"]}),s.end()}).get("/amount",function(e,s,t){Orders_controller.getAmount(e,s,function(e){s.status(e.status).send(e.datas)})}).post("/transaction",function(e,s,t){console.log("CREATE CHARGE"),Orders_controller.createCharge(e,s,function(t){s.render("order",{title:"User Account",user:e.session.Auth,locale:language_helper.getlocale(e),lang:lang,page:"transaction",order_datas:t.datas,js:["/public/javascripts/order.js","/public/javascripts/components/formular.js","/public/javascripts/components/popeye.js"],css:["/public/stylesheets/order.css","/public/stylesheets/ui.css","/public/stylesheets/components/formular.css"]}),s.end()})}).post("/refund",function(e,s,t){Auth_helper.validate_admin(e,function(e){200===e.status?t():s.status(e.status).send(e)})},function(e,s,t){Orders_controller.refundCharge(e,s,function(e){s.status(e.status).send(e),s.end()})}).post("/",function(e,s,t){Orders_controller.create(e.body.data,s,function(e){200===e.status?s.status(e.status).send({status:e.status,response_display:{title:"Commande",message:"Votre commande est prête à être réglée.",buttons:["OK"]}}):s.status(e.status).send(e)})}).put("/",function(e,s,t){Orders_controller.update(e.body.data,s,function(e){s.status(e.status).send({status:e.status,infos:e.datas})})}).delete("/",function(e,s,t){Orders_controller.delete(e,s,function(e){s.status(e.status).send({status:e.status,infos:e.datas})})}).post("/buy_product_with_coupon_code",function(e,s,t){Orders_controller.buy_with_coupon(e,s,function(e){s.status(e.status).send(e)})}),module.exports=orders;