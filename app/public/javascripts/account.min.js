var $jscomp={scope:{},findInternal:function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6-impl","es3");$(function(){account.init()});
var account={user:null,sdk:null,coupons:[],init:function(){this.create_forms();this.set_listeners()},set_listeners:function(){$("#request_validation_code").off("click").on("click",function(){index.sdk.api.post("/api/request_validation_code",{user_id:$(this).attr("data-userid"),user_email:$(this).attr("data-useremail")},function(a){})});$(".account_validation .cross_button").off("click").on("click",function(){$("#account_validation").remove()});$("[data-action]").on("click",function(){switch($(this).attr("data-action")){case "delete":var a=
{};a[$(this).attr("data-type")]=$(this).attr("data-value");index.sdk.api.call("DELETE",$(this).attr("data-post"),a,function(a){window.location.reload()});break;case "edit":0<$("#"+$(this).attr("data-edittemplate")).length&&$("#"+$(this).attr("data-edittemplate")).remove();$(".editable").removeClass("editable");var b=$(this).parent().parent();index.sdk.template($(this).attr("data-edittemplate"),{member_id:$(this).attr("data-value")},function(a){b.append(a);account.member_edit_form=(new formular("#member_edit_form",
function(a){if("undefined"!==typeof a.action)switch(a.action){case "cancel":b.removeClass("editable");$("#member_edit_form").remove();break;case "save":var c={member_id:$("#member_edit_form").attr("data-memberid")};$.each($("#member_edit_form form").serializeArray(),function(a,b){c[b.name]=b.value});"undefined"!==typeof $("#member_edit_form #child_avatar").attr("data-path")&&(c.avatar=$("#member_edit_form #child_avatar").attr("data-path"));index.sdk.api.put("/me/members",c,function(a){200===a.status&&
(b.removeClass("editable"),$("#member_edit_form").remove())})}})).init();b.addClass("editable")})}});this.init_map()},init_map:function(){var a=this,b=new google.maps.Map(document.getElementById("map_preview"),{zoom:1,center:{lat:40,lng:1}});new google.maps.Geocoder;new google.maps.InfoWindow;$("#postalCode, #city, #address, #addressCountry").off("blur").on("blur",function(){"undefined"!==typeof a.marker&&a.marker.setMap(null);if(""===$("#address").val()&&""===$("#city").val()&&""===$("#postalCode").val())return!1;
$.get("https://maps.googleapis.com/maps/api/geocode/json?address="+$("#address").val()+"+"+$("#city").val()+"+"+$("#postalCode").val()+"+"+$("#addressCountry").val()+"&key=AIzaSyB_MlYEDlRnNWYtrn-y63pbjrWecYaocqs",function(c){a.marker=new google.maps.Marker({position:c.results[0].geometry.location,map:b});b.setZoom(16);b.setCenter(a.marker.getPosition())})})},check_amount:function(){index.sdk.api.get("/basket/amount",{coupon_code:account.coupons},function(a){$(".coupons_infos .message").html("Nouveau montant \u00e0 r\u00e9gler :");
$(".coupons_infos .amount").html((a.new_amount/100).toFixed(2)+" \u20ac");$(".coupons_infos").addClass("showed");for(var b="",c=0;c<account.coupons.length;c++)b+=account.coupons[c].code+" ";$("#coupons_code").val(JSON.stringify(account.coupons));"undefined"!==typeof a.wallet_infos&&$(".wallet_infos .message").html("En validant votre panier avec vos "+account.coupons.length+" coupons de r\u00e9duction, un coupon de r\u00e9duction "+a.wallet_infos.label+" sera cr\u00e9dit\u00e9 sur votre porte monnaie d'une valeur de "+
a.dif_amount/100+"\u20ac, vous pourrez l'utiliser plus tard avec votre compte client.<br><br>");$("#order_transaction").attr("data-amount",a.new_amount);$(".wallet_infos .message").append("En validant, vous utiliserez les coupons suivants :<br><b>"+b+"</b>");$(".wallet_infos").addClass("showed")})},create_forms:function(){this.bill_adress_form=new formular("#bill_address",function(a){"checkbox"===a.status&&index.sdk.api.put("/basket",{basket_id:$("#bill_address").attr("data-basketid"),address_id:$('input[name="bill_adress"]:checked').val()},
function(a){})});this.bill_adress_form.init();this.checkout_form=new formular("#checkout_form",function(a){"blur"===a.status&&3<=$("#coupon_code").val().length&&index.sdk.api.get("/coupon_code/valid",{code:$("#coupon_code").val()},function(a){1<=a.datas.length?(0===$('[data-code="'+a.datas[0].code+'"]').length&&$("#coupons_list").append('<li data-code="'+a.datas[0].code+'" data-amount="'+a.datas[0].amount+'"><div class="code">coupon code : '+a.datas[0].code+'</div><div class="amount">'+a.datas[0].label+
" : "+a.datas[0].amount/100+" \u20ac</div></li>"),$("#coupon_code").val("").parent().removeClass("notempty").removeClass("valid"),account.coupons.push(a.datas[0]),account.check_amount(),$("#coupon_code").parent().find(".input_error").remove()):$("#coupon_code").parent().removeClass("valid").addClass("invalid").append('<div class="input_error">'+$("#coupon_code").attr("data-errormessage")+"</div>")});if("hitted"===a.status&&"submit"===a.action){a=$("#order_transaction");var b=a.parents("form");a=$.extend({},
a.data(),{token:function(a){b.append($("<input>").attr({type:"hidden",name:"stripeToken",value:a.id})).submit()}});0===parseFloat($("#order_transaction").attr("data-amount"))?index.sdk.api.post("/orders/buy_product_with_coupon_code",{product_id:$("[data-productid]").eq(0).attr("data-productid"),coupon_code:account.coupons[0].code,coupon_id:account.coupons[0]._id,amount:account.coupons[0].amount},function(a){200===a.status&&index.sdk.api.deleting("/basket",{basket_id:$("[data-basketid]").eq(0).attr("data-basketid"),
product_id:$("[data-productid]").eq(0).attr("data-productid")},function(a){})}):StripeCheckout.open(a)}});this.checkout_form.init();this.public_form=new formular("#public_datas",function(a){"hitted"===a.status&&"submit"===a.action&&(a=account.public_form.get_datas(),index.sdk.api.put("/account/profile/",a,function(a){}))});this.public_form.init();this.private_form=new formular("#private_datas",function(a){"hitted"===a.status&&"submit"===a.action&&(a=account.private_form.get_datas(),a.gender=$("input[name=gender]:checked").val(),
index.sdk.api.put("/account/profile/",a,function(a){}))});this.private_form.init();this.kid_form=(new formular("#add_kid",function(a){if("hitted"===a.status&&"submit"===a.action){var b={};$.each($("#add_kid form").serializeArray(),function(a,d){b[d.name]=d.value});index.sdk.api.post("/me/members",b,function(a){window.location.reload()})}})).init();this.security_form=(new formular("#security_form",function(a){"hitted"===a.status&&"submit"===a.action&&index.sdk.api.put("/api/change_password/",{user_id:$("#security_form #user_id").val(),
password:$("#security_form #change_password_old").val(),new_password:$("#security_form #change_password_new").val(),retype_new_password:$("#security_form #retype_change_password_new").val()},function(a){})})).init();this.address_form=new formular("#address_form",function(a){"validated"===a.status&&($("#addressLine1").val(),$("#postalCode").val(),$("#city").val(),$("#addressCountry").val());"hitted"===a.status&&"submit"===a.action&&(a=account.address_form.get_datas(),"PUT"===$("#address_form form").attr("method")?
index.sdk.api.put("/address/",a,function(a){}):index.sdk.api.post("/address/",a,function(a){window.location.reload()}))});this.address_form.init();this.services_form=new formular("#services_form",function(a){"hitted"===a.status&&"submit"===a.action&&(a=account.services_form.get_datas(),index.sdk.api.put("/account/profile/",a,function(a){}))});this.services_form.init();0<$("#member_datas").length&&(this.member_form=(new formular("#member_datas",function(a){if("undefined"!==typeof a.action)switch(a.action){case "save":var b=
{member_id:$("#member_datas").attr("data-memberid")};$.each($("#member_datas form").serializeArray(),function(a,d){b[d.name]=d.value});index.sdk.api.put("/me/members",b,function(a){window.location.reload()})}})).init());$(".delete_device").off("click").on("click",function(){var a=$(this);index.sdk.api.call("DELETE","/auth/device",{uid:$(this).attr("data-device_uid")},function(b){a.parent().parent().remove()})})},init_apple_pay:function(){document.getElementById("apple-pay-button").addEventListener("click",
function(a){a.preventDefault();Stripe.applePay.buildSession({requiredBillingContactFields:["postalAddress"],requiredShippingContactFields:["phone"],countryCode:"FR",currencyCode:"EUR",total:{label:"joyvox.fr",amount:"4.99"}},function(a,c){c(!0)}).begin();return!1})}};
