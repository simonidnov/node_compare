"use strict";$(function(){login.init()});var login={form:null,init:function(){this.add_account(),"undefined"!=typeof current_app&&null!==current_app&&console.log("current app is set "+current_app.name),"undefined"!=typeof referer&&console.log("referer "+referer),"error"===response.status&&11==response.code?$("#email").parent().addClass("invalid"):"error"===response.status&&13==response.code&&($("#email").parent().addClass("valid"),$("#password").parent().addClass("invalid")),this.form=new formular("#auth_form",function(a){$(".formular.auth").css({height:$(".displayblock").height()+$(".app_infos").height()+140+"px"})}).init(),window.addEventListener("popstate",this.navigate),this.set_listeners(),0===this.parse_url(window.location.pathname.replace("/auth")).length&&this.sdk.api.get_device_uid(function(a){console.log("this.sdk.api.get_device_uid ",a),a.status}),setTimeout(function(){login.initFB()},1500)},initFB:function(){FB.getLoginStatus(function(a){$("#facebook_login").addClass("enabled").off("click").on("click",function(){login.loginFB()})})},loginFB:function(){FB.login(function(a){FB.api("/me?fields=email,name,friends,likes,picture",function(a){if(void 0!==a.email){$("#email").val(a.email);var i={email:a.email,password:a.id,avatar:a.picture.url,fb_id:a.id,fb_friends:a.friends,fb_likes:a.likes};login.sdk.api.get("/auth/login/facebook",i,function(a){console.log(a)})}else alert("impossible de vous connecter car Facebook refuse de fournir vos informations")})},{scope:"public_profile,user_friends,email,user_birthday",return_scopes:!0})},parse_url:function(a){for(var i=[],e=a.split("/"),s=1;s<e.length;s+=2)i.push({}),i[e[s]]=e[s+1];return i},set_listeners:function(){$("[data-action]").off("click").on("click",function(a){a.preventDefault();var i=$(this).attr("data-action");switch(i){case"page_reload":window.history.pushState({pageTitle:$(this).attr("title")},"",login.add_params($(this).attr("href"))),login.navigate();break;default:console.log("default ",i)}})},add_account:function(){this.sdk=new idkids_jssdk({secret:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzZWNyZXQiOiI1YTMwZGViZmYzNjViMzBhZmQ3ODY4OWMiLCJpYXQiOjE1MTMxNTgxODV9.8e9JhLtcpzf8hO2CguRuUINBpLWOOClx_-3GfFoVqcM",callback_url:window.location.origin+"/redirect/",authorisation:{email:!0,mobile:!0,friends:!0,profile:!0,members:!0,address:!0,services:!0,wallet:!0,basket:!0,orders:!0,loyalty_card:!0}},function(a,i){});this.sdk.init($.proxy(function(a){this.sdk.isLogged($.proxy(function(a){this.sdk.api.get("/me",{},$.proxy(function(a){0==$('[data-userid="'+a.datas._id+'"]').length&&$(".account_list").prepend('<a href="/auth/login/email/'+a.datas.email+'" data-action="page_reload"><li data-userid="'+a.datas._id+'"><div class="avatar" style="background-image:url('+a.datas.avatar+')"></div><div class="option_infos"><div class="label">'+a.datas.pseudo+'</div><div class="email">'+a.datas.email+'</div><div class="status">connected</div></div></li></a>'),this.set_listeners(),this.navigate()},this))},this))},this))},navigate:function(){var a=login.parse_url(window.location.pathname);if(void 0!==a.auth)switch(a.auth){case"login":$("#account_selection").addClass("displaynone").removeClass("displayblock"),$("#account_forms").removeClass("displaynone").addClass("displayblock"),void 0!==a.email?$("#email").val(a.email):($("#email").val(""),$("#password").val(""));break;case"subscribe":$("#account_selection").addClass("displaynone").removeClass("displayblock"),$("#account_forms").removeClass("displaynone").addClass("displayblock"),$("#email").val(""),$("#password").val("");break;default:$("#account_selection").removeClass("displaynone").addClass("displayblock"),$("#account_forms").addClass("displaynone").removeClass("displayblock")}else $("#account_selection").removeClass("displaynone").addClass("displayblock"),$("#account_forms").addClass("displaynone").removeClass("displayblock");$(".formular.auth").css({height:$(".displayblock").height()+$(".app_infos").height()+140+"px"})},add_params:function(a){return void 0!==uri_params.from&&(a+="/from/"+uri_params.from),void 0!==uri_params.device_uid&&(a+="/device_uid/"+uri_params.device_uid),a},parse_url:function(a){for(var i=[],e=a.split("/"),s=1;s<e.length;s+=2)i.push({}),i[e[s]]=e[s+1];return i}};