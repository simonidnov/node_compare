var express=require("express"),_=require("underscore"),admin=express.Router(),Auth_model=require("../models/auth_model"),Auth_helper=require("../helpers/auth_helper"),Apps_controller=require("../controllers/apps_controller"),Coupon_controller=require("../controllers/coupon_controller"),Basket_controller=require("../controllers/basket_controller"),Contact_controller=require("../controllers/contact_controller"),Metas_controller=require("../controllers/metas_controller"),Orders_controller=require("../controllers/orders_controller"),
Pages_controller=require("../controllers/pages_controller"),Products_controller=require("../controllers/products_controller"),language_helper=require("../helpers/languages_helper"),uri_helper=require("../helpers/uri_helper"),lang=require("../public/languages/auth_lang");
admin.use(function(a,b,d){b.setHeader("Access-Control-Allow-Origin","*");b.setHeader("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept");b.setHeader("Access-Control-Allow-Methods","GET, PUT, POST, DELETE");Auth_helper.validate_session(a,function(c){200===c.status?Auth_helper.validate_admin(a,function(a){200===a.status?d():b.redirect(307,"/auth?message=NO_ACCESS_RIGHTS_ADMIN")}):b.redirect(307,"/auth?message=NO_SESSION_ADMIN")})});
admin.get("/",function(a,b,d){b.render("admin/dashboard",{title:"Admin Dashboard",user:a.session.Auth,locale:language_helper.getlocale(a),lang:lang,page:"dashboard",js:["/public/javascripts/admin/dashboard.js","/public/javascripts/components/formular.js","/node_modules/qrcode/build/qrcode.min.js"],css:["/public/stylesheets/admin/admin.css","/public/stylesheets/admin/dashboard.css","/public/stylesheets/components/formular.css"]});b.end()}).get("/dashboard",function(a,b,d){b.render("admin/dashboard",
{title:"Admin Dashboard",user:a.session.Auth,locale:language_helper.getlocale(a),lang:lang,page:"dashboard",js:["/public/javascripts/admin/dashboard.js","/public/javascripts/components/formular.js","/node_modules/qrcode/build/qrcode.min.js"],css:["/public/stylesheets/admin/admin.css","/public/stylesheets/admin/dashboard.css","/public/stylesheets/components/formular.css"]});b.end()}).get("/apps",function(a,b,d){var c=[];Apps_controller.get(a,{},function(d){c=d.datas;b.status(d.status).render("admin/apps",
{title:"Admin Dashboard",user:a.session.Auth,locale:language_helper.getlocale(a),lang:lang,page:"apps",applications:c,js:["/public/javascripts/components/jquery-ui/jquery-ui.min.js","/public/javascripts/admin/apps.js","/node_modules/cropperjs/dist/cropper.min.js","/public/javascripts/components/formular.js","/node_modules/qrcode/build/qrcode.min.js"],css:["/public/stylesheets/admin/admin.css","/node_modules/cropperjs/dist/cropper.min.css","/public/stylesheets/admin/apps.css","/public/stylesheets/components/formular.css"]});
b.end()})}).get("/apps/:page",function(a,b,d){var c=null;Apps_controller.get(a,{},function(d){c=d.datas;b.render("admin/apps",{title:"Application",user:a.session.Auth,locale:language_helper.getlocale(a),lang:lang,page:a.params.page,applications:c,js:["/public/javascripts/components/jquery-ui/jquery-ui.min.js","/public/javascripts/admin/apps.js","/node_modules/cropperjs/dist/cropper.min.js","/public/javascripts/components/formular.js","/node_modules/qrcode/build/qrcode.min.js"],css:["/public/stylesheets/admin/admin.css",
"/node_modules/cropperjs/dist/cropper.min.css","/public/stylesheets/admin/apps.css","/public/stylesheets/components/formular.css"]});b.end()})}).get("/apps/:page/:_id",function(a,b,d){var c=null,e=null;Apps_controller.get(a,{},function(d){c=d.datas;e=_.where(JSON.parse(JSON.stringify(c)),{_id:a.params._id})[0];b.render("admin/apps",{title:"Admin Dashboard",user:a.session.Auth,locale:language_helper.getlocale(a),lang:lang,page:a.params.page,applications:c,app_id:a.params._id,edit_application:e,_:_,
js:["/public/javascripts/components/jquery-ui/jquery-ui.min.js","/public/javascripts/admin/apps.js","/node_modules/cropperjs/dist/cropper.min.js","/public/javascripts/components/formular.js","/node_modules/qrcode/build/qrcode.min.js"],css:["/public/stylesheets/admin/admin.css","/node_modules/cropperjs/dist/cropper.min.css","/public/stylesheets/admin/apps.css","/public/stylesheets/components/formular.css"]});b.end()})}).get("/users",function(a,b,d){require("../controllers/auth_controller").get(a,b,
function(c){b.render("admin/users",{title:"Admin Users",user:a.session.Auth,locale:language_helper.getlocale(a),lang:lang,page:"users",users:c.users,js:["/public/javascripts/admin/users.js","/public/javascripts/components/formular.js","/node_modules/qrcode/build/qrcode.min.js","/public/javascripts/farnientejs/farnientejs.min.js"],css:["/public/stylesheets/admin/admin.css","/public/stylesheets/ui.css","/public/stylesheets/admin/users.css","/public/stylesheets/components/formular.css"]});b.end()})}).get("/notifications",
function(a,b,d){b.render("admin/notifications",{title:"Admin Notifications",user:a.session.Auth,locale:language_helper.getlocale(a),lang:lang,page:"notifications",js:["/public/javascripts/admin/notifications.js","/public/javascripts/components/formular.js","/node_modules/qrcode/build/qrcode.min.js"],css:["/public/stylesheets/admin/admin.css","/public/stylesheets/admin/notifications.css","/public/stylesheets/components/formular.css"]});b.end()}).get("/settings",function(a,b,d){b.render("admin/settings",
{title:"Admin Settings",user:a.session.Auth,locale:language_helper.getlocale(a),lang:lang,page:"settings",js:["/public/javascripts/admin/settings.js","/public/javascripts/components/formular.js","/node_modules/cropperjs/dist/cropper.min.js","/node_modules/qrcode/build/qrcode.min.js"],css:["/public/stylesheets/admin/admin.css","/public/stylesheets/admin/settings.css","/node_modules/cropperjs/dist/cropper.min.css","/public/stylesheets/components/formular.css"]});b.end()}).get("/translations",function(a,
b,d){b.render("admin/translations",{title:"Admin translations",user:a.session.Auth,locale:language_helper.getlocale(a),lang:lang,page:"translations",js:["/public/javascripts/admin/translations.js","/public/javascripts/components/formular.js","/node_modules/qrcode/build/qrcode.min.js"],css:["/public/stylesheets/admin/admin.css","/public/stylesheets/admin/translations.css","/public/stylesheets/components/formular.css"]});b.end()}).get("/pages",function(a,b,d){Pages_controller.get(a,b,function(c){pages=
c.datas;b.render("admin/pages",{title:"Admin Pages",user:a.session.Auth,locale:language_helper.getlocale(a),lang:lang,page:"pages",js:["/public/javascripts/admin/pages.js","/public/javascripts/components/formular.js","/node_modules/qrcode/build/qrcode.min.js"],css:["/public/stylesheets/admin/admin.css","/public/stylesheets/admin/pages.css","/public/stylesheets/components/formular.css"]});b.end()})}).get("/pages/:page",function(a,b,d){Pages_controller.get(a,b,function(c){pages=c.datas;b.render("admin/pages",
{title:"Admin Pages",user:a.session.Auth,locale:language_helper.getlocale(a),lang:lang,page:a.params.page,pages:pages,js:["/public/javascripts/admin/pages.js","/public/javascripts/components/formular.js","/node_modules/qrcode/build/qrcode.min.js"],css:["/public/stylesheets/admin/admin.css","/public/stylesheets/admin/pages.css","/public/stylesheets/components/formular.css"]});b.end()})}).get("/pages/:page/:_id",function(a,b,d){var c=null;Pages_controller.get(a,b,function(d){c=d.datas;edit_page=_.where(JSON.parse(JSON.stringify(c)),
{_id:a.params._id})[0];b.render("admin/pages",{title:"Admin Pages",user:a.session.Auth,locale:language_helper.getlocale(a),lang:lang,page:a.params.page,pages:c,page_id:a.params._id,edit_page:edit_page,_:_,js:"/public/javascripts/admin/pages.js /public/javascripts/components/pager/pager.js /node_modules/cropperjs/dist/cropper.min.js /public/javascripts/components/formular.js /public/javascripts/components/jquery-ui.min.js /node_modules/qrcode/build/qrcode.min.js".split(" "),css:["/public/stylesheets/admin/admin.css",
"/node_modules/cropperjs/dist/cropper.min.css","/public/stylesheets/admin/pages.css","/public/stylesheets/components/formular.css","/public/stylesheets/components/pager/pager.css"]});b.end()})}).get("/products",function(a,b,d){Products_controller.get(a,b,function(c){products=c.datas;b.render("admin/products",{title:"Admin Products",user:a.session.Auth,locale:language_helper.getlocale(a),lang:lang,page:"products",products:products,js:["/public/javascripts/admin/products.js","/public/javascripts/components/formular.js"],
css:["/public/stylesheets/admin/admin.css","/public/stylesheets/admin/products.css","/public/stylesheets/components/formular.css"]});b.end()})}).get("/products/:page",function(a,b,d){Products_controller.get(a,b,function(c){products=c.datas;b.render("admin/products",{title:"Admin Products",user:a.session.Auth,locale:language_helper.getlocale(a),lang:lang,page:a.params.page,products:products,js:["/public/javascripts/admin/products.js","/public/javascripts/components/formular.js","/node_modules/dropzone/dist/dropzone.js"],
css:["/public/stylesheets/admin/admin.css","/public/stylesheets/admin/products.css","/public/stylesheets/components/formular.css","/node_modules/dropzone/dist/dropzone.css"]});b.end()})}).get("/products/:page/:_id",function(a,b,d){Products_controller.get(a,b,function(c){products=c.datas;a.body._id=a.params._id;Products_controller.get({product_id:a.body._id},a,function(c){product_datas=c.datas[0];b.render("admin/products",{title:"Admin Products",user:a.session.Auth,locale:language_helper.getlocale(a),
lang:lang,page:a.params.page,products:products,edit_product:product_datas,js:["/public/javascripts/admin/products.js","/public/javascripts/components/formular.js","/node_modules/cropperjs/dist/cropper.min.js","/node_modules/dropzone/dist/dropzone.js"],css:["/public/stylesheets/admin/admin.css","/public/stylesheets/admin/products.css","/node_modules/cropperjs/dist/cropper.min.css","/public/stylesheets/components/formular.css","/node_modules/dropzone/dist/dropzone.css"]});b.end()})})}).get("/orders",
function(a,b,d){Orders_controller.get(a,b,function(c){orders=c.datas;b.render("admin/orders",{title:"Admin Orders",user:a.session.Auth,locale:language_helper.getlocale(a),lang:lang,page:"orders",orders:orders,js:["/public/javascripts/admin/orders.js","/public/javascripts/components/formular.js","/node_modules/qrcode/build/qrcode.min.js"],css:["/public/stylesheets/admin/admin.css","/public/stylesheets/admin/orders.css","/public/stylesheets/components/formular.css"]});b.end()})}).get("/coupons",function(a,
b,d){Coupon_controller.getOffers(a,b,function(c){b.render("admin/coupons",{title:"Admin Coupons",user:a.session.Auth,locale:language_helper.getlocale(a),lang:lang,page:"coupons",offers:c.datas,js:["/public/javascripts/admin/baskets.js","/public/javascripts/components/formular.js","/node_modules/qrcode/build/qrcode.min.js"],css:["/public/stylesheets/admin/admin.css","/public/stylesheets/admin/baskets.css","/public/stylesheets/components/formular.css"]});b.end()})}).get("/coupons/new_offer",function(a,
b,d){Coupon_controller.getOffers(a,b,function(c){b.render("admin/coupons",{title:"Admin Coupons",user:a.session.Auth,locale:language_helper.getlocale(a),lang:lang,page:"new_offer",offers:c.datas,js:["/public/javascripts/admin/coupons.js","/public/javascripts/components/formular.js","/node_modules/qrcode/build/qrcode.min.js"],css:["/public/stylesheets/admin/admin.css","/public/stylesheets/admin/coupons.css","/public/stylesheets/components/formular.css"]});b.end()})}).get("/coupons/show_offer/:offer",
function(a,b,d){Coupon_controller.getOffers(a,b,function(c){var d=c.datas;Coupon_controller.get(a,b,function(c){b.render("admin/coupons",{title:"Admin Coupons",user:a.session.Auth,locale:language_helper.getlocale(a),lang:lang,coupons:c.datas,page:"show_offer",offers:d,js:["/public/javascripts/admin/coupons.js","/public/javascripts/components/formular.js","/node_modules/qrcode/build/qrcode.min.js"],css:["/public/stylesheets/admin/admin.css","/public/stylesheets/admin/coupons.css","/public/stylesheets/components/formular.css"]});
b.end()})})}).get("/baskets",function(a,b,d){Basket_controller.getStats(a,b,function(c){baskets=c.datas;b.render("admin/baskets",{title:"Admin Baskets",user:a.session.Auth,locale:language_helper.getlocale(a),lang:lang,page:"baskets",baskets:baskets,js:["/public/javascripts/admin/baskets.js","/public/javascripts/components/formular.js","/node_modules/qrcode/build/qrcode.min.js"],css:["/public/stylesheets/admin/admin.css","/public/stylesheets/admin/baskets.css","/public/stylesheets/components/formular.css"]});
b.end()})}).get("/emails",function(a,b,d){Contact_controller.get(a,b,function(b){a.emails=b.datas;d()})},function(a,b,d){a.query.key="request_name_chansonpersonnalisee";Metas_controller.get(a,b,function(b){a.wish_record=b.datas;d()})},function(a,b,d){b.render("admin/emails",{title:"Admin Emails",emails:a.emails,wish_records:a.wish_record,user:a.session.Auth,locale:language_helper.getlocale(a),lang:lang,page:"emails",js:["/public/javascripts/admin/emails.js","/public/javascripts/components/formular.js",
"/node_modules/qrcode/build/qrcode.min.js"],css:["/public/stylesheets/admin/emails.css","/public/stylesheets/admin/dashboard.css","/public/stylesheets/components/formular.css"]});b.end()});module.exports=admin;
