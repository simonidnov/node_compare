"use strict";$(function(){login.init()});var login={form:null,init:function(){"error"===response.status&&11==response.code?$("#email").parent().addClass("invalid"):"error"===response.status&&13==response.code&&($("#email").parent().addClass("valid"),$("#password").parent().addClass("invalid")),this.add_account(),this.form=new formular("#auth_form",function(e){$(".formular.auth").css({height:$(".displayblock").height()+140+"px"})}).init(),window.addEventListener("popstate",this.navigate),this.set_listeners()},set_listeners:function(){$("[data-action]").off("click").on("click",function(e){e.preventDefault();var s=$(this).attr("data-action");switch(s){case"page_reload":window.history.pushState({pageTitle:$(this).attr("title")},"",login.add_params($(this).attr("href"))),login.navigate();break;default:console.log("default ",s)}})},add_account:function(){this.sdk=new idkids_jssdk({secret:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzZWNyZXQiOiI1YTMwZGViZmYzNjViMzBhZmQ3ODY4OWMiLCJpYXQiOjE1MTMxNTgxODV9.8e9JhLtcpzf8hO2CguRuUINBpLWOOClx_-3GfFoVqcM",callback_url:window.location.origin+"/redirect/",authorisation:{email:!0,mobile:!0,friends:!0,profile:!0,members:!0,address:!0,services:!0,wallet:!0,basket:!0,orders:!0,loyalty_card:!0}},function(e,s){});this.sdk.init($.proxy(function(e){this.sdk.isLogged($.proxy(function(e){this.sdk.api.get("/me",{},$.proxy(function(e){0==$('[data-userid="'+e.datas._id+'"]').length&&$(".account_list").prepend('<a href="/auth/login/email/'+e.datas.email+'" data-action="page_reload"><li data-userid="'+e.datas._id+'"><div class="avatar" style="background-image:url('+e.datas.avatar+')"></div><div class="option_infos"><div class="label">'+e.datas.pseudo+'</div><div class="email">'+e.datas.email+'</div><div class="status">connected</div></div></li></a>'),this.set_listeners(),this.navigate()},this))},this))},this))},navigate:function(){var e=login.parse_url(window.location.pathname);if("undefined"!=typeof e.auth)switch(e.auth){case"login":$("#account_selection").addClass("displaynone").removeClass("displayblock"),$("#account_forms").removeClass("displaynone").addClass("displayblock"),"undefined"!=typeof e.email?$("#email").val(e.email):$("#email").val("");break;case"subscribe":$("#account_selection").addClass("displaynone").removeClass("displayblock"),$("#account_forms").removeClass("displaynone").addClass("displayblock"),$("#email").val("");break;default:$("#account_selection").removeClass("displaynone").addClass("displayblock"),$("#account_forms").addClass("displaynone").removeClass("displayblock")}else $("#account_selection").removeClass("displaynone").addClass("displayblock"),$("#account_forms").addClass("displaynone").removeClass("displayblock");$(".formular.auth").css({height:$(".displayblock").height()+140+"px"})},add_params:function(e){return"undefined"!=typeof uri_params.from&&(e+="/from/"+uri_params.from),"undefined"!=typeof uri_params.device_uid&&(e+="/device_uid/"+uri_params.device_uid),e},parse_url:function(e){for(var s=[],t=e.split("/"),o=1;o<t.length;o+=2)s.push({}),s[t[o]]=t[o+1];return s}};